From 9d6d3767e45537618e257e1aed8d24c279bd541b Mon Sep 17 00:00:00 2001
From: Sam Nazarko <email@samnazarko.co.uk>
Date: Fri, 21 Aug 2015 13:11:09 +0100
Subject: [PATCH] Do not use external protobuffer

Signed-off-by: Sam Nazarko <email@samnazarko.co.uk>
---
 dependencies/CMakeLists.txt       | 14 --------------
 libsrc/protoserver/CMakeLists.txt |  3 +--
 2 files changed, 1 insertion(+), 16 deletions(-)

diff --git a/dependencies/CMakeLists.txt b/dependencies/CMakeLists.txt
index 17747bd..f05b400 100644
--- a/dependencies/CMakeLists.txt
+++ b/dependencies/CMakeLists.txt
@@ -5,27 +5,13 @@ add_subdirectory(build/serial)
 add_subdirectory(build/tinkerforge)
 
 if(ENABLE_PROTOBUF)
-	set(BUILD_SHARED_LIBS OFF CACHE BOOL "Build shared protobuf library")
-	add_subdirectory(external/protobuf)
 
 	if(CMAKE_CROSSCOMPILING)
 		# when crosscompiling import the protoc executable targets from a file generated by a native build
 		option(IMPORT_PROTOC "Protoc export file (protoc_export.cmake) from a native build" "IMPORT_PROTOC-FILE_NOT_FOUND")
 		include(${IMPORT_PROTOC})
-	else()
-		# export the protoc compiler so it can be used when cross compiling
-		export(TARGETS protoc_compiler FILE "${CMAKE_BINARY_DIR}/protoc_export.cmake")
 	endif()
 
-	# define the include for the protobuf library at the parent scope
-	set(PROTOBUF_INCLUDE_DIRS "${CMAKE_CURRENT_SOURCE_DIR}/external/protobuf/src")
-	set(PROTOBUF_INCLUDE_DIRS ${PROTOBUF_INCLUDE_DIRS} PARENT_SCOPE)
-
-	# define the protoc executable at the parent scope
-	get_property(PROTOBUF_PROTOC_EXECUTABLE TARGET protoc_compiler PROPERTY LOCATION)
-	set(PROTOBUF_PROTOC_EXECUTABLE ${PROTOBUF_PROTOC_EXECUTABLE} PARENT_SCOPE)
-	message(STATUS "Using protobuf compiler: " ${PROTOBUF_PROTOC_EXECUTABLE})
-
 	#=============================================================================
 	# Copyright 2009 Kitware, Inc.
 	# Copyright 2009-2011 Philip Lowman <philip@yhbt.com>
diff --git a/libsrc/protoserver/CMakeLists.txt b/libsrc/protoserver/CMakeLists.txt
index 6a9b6d1..fda7ed1 100644
--- a/libsrc/protoserver/CMakeLists.txt
+++ b/libsrc/protoserver/CMakeLists.txt
@@ -46,8 +46,7 @@ add_library(protoserver
 	${ProtoServer_PROTO_HDRS}
 )
 
-target_link_libraries(protoserver
-	hyperion
+target_link_libraries(hyperion
 	hyperion-utils
 	protobuf
 	${QT_LIBRARIES}
-- 
2.1.0

