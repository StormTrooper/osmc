From 7228b2fe6f6f97752f1a169aa974711bfe5aa882 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Tue, 25 Jun 2019 22:04:40 +0200
Subject: [PATCH 01/12] [depends] bump automake to 1.16.1

---
 tools/depends/Makefile.include.in      | 4 ++--
 tools/depends/native/automake/Makefile | 2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/tools/depends/Makefile.include.in b/tools/depends/Makefile.include.in
index 3d31962c90fb..d3fdbbc8f349 100644
--- a/tools/depends/Makefile.include.in
+++ b/tools/depends/Makefile.include.in
@@ -37,8 +37,8 @@ BASE_URL=$(KODI_MIRROR)/build-deps/sources
 endif
 RETRIEVE_TOOL_FLAGS=-Ls --create-dirs -f -O
 ARCHIVE_TOOL_FLAGS=--strip-components=1 -xf
-CONFIG_SUB=@prefix@/@tool_dir@/share/automake-1.15/config.sub
-CONFIG_GUESS=@prefix@/@tool_dir@/share/automake-1.15/config.guess
+CONFIG_SUB=@prefix@/@tool_dir@/share/automake-1.16/config.sub
+CONFIG_GUESS=@prefix@/@tool_dir@/share/automake-1.16/config.guess
 
 USE_CCACHE=@use_ccache@
 
diff --git a/tools/depends/native/automake/Makefile b/tools/depends/native/automake/Makefile
index 6ef6a1cd2c09..3dfa1c1130a4 100644
--- a/tools/depends/native/automake/Makefile
+++ b/tools/depends/native/automake/Makefile
@@ -4,7 +4,7 @@ DEPS= ../../Makefile.include Makefile
 
 # lib name, version
 LIBNAME=automake
-VERSION=1.15.1
+VERSION=1.16.1
 SOURCE=$(LIBNAME)-$(VERSION)
 ARCHIVE=$(SOURCE).tar.gz
 

From 75967d6cef02d5f1513a8321a0d26f430702ef57 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Tue, 25 Jun 2019 22:04:40 +0200
Subject: [PATCH 02/12] [depends] bump cmake to 3.14.5

---
 tools/depends/native/cmake/Makefile | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/tools/depends/native/cmake/Makefile b/tools/depends/native/cmake/Makefile
index 24e251d72c75..426ebe062875 100644
--- a/tools/depends/native/cmake/Makefile
+++ b/tools/depends/native/cmake/Makefile
@@ -3,7 +3,7 @@ PLATFORM=$(NATIVEPLATFORM)
 DEPS= ../../Makefile.include Makefile
 
 APPNAME=cmake
-VERSION=3.12.2
+VERSION=3.14.5
 SOURCE=$(APPNAME)-$(VERSION)
 ARCHIVE=$(SOURCE).tar.gz
 

From 5bffd21fe3f887436e7c1cec2f725ea646b0cdba Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Tue, 25 Jun 2019 22:04:40 +0200
Subject: [PATCH 03/12] [depends] bump dpkg to 1.19.7

---
 tools/depends/native/dpkg/Makefile | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/tools/depends/native/dpkg/Makefile b/tools/depends/native/dpkg/Makefile
index 755ac12c4464..5e286771caf7 100644
--- a/tools/depends/native/dpkg/Makefile
+++ b/tools/depends/native/dpkg/Makefile
@@ -5,7 +5,7 @@ DEPS= ../../Makefile.include Makefile 01-no-gnu-patch.patch 02-perl-min-version.
 
 # lib name, version
 LIBNAME=dpkg
-VERSION=1.19.6
+VERSION=1.19.7
 SOURCE=$(LIBNAME)_$(VERSION)
 ARCHIVE=$(SOURCE).tar.xz
 

From 7ddaf52e33f51c08164a0e6f96b44688b360fdc0 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Tue, 25 Jun 2019 22:04:40 +0200
Subject: [PATCH 04/12] [depends] bump giflib to 5.2.1

---
 tools/depends/native/giflib/01-static-lib.patch | 12 ++++++++++++
 tools/depends/native/giflib/Makefile            | 15 ++++++++-------
 2 files changed, 20 insertions(+), 7 deletions(-)
 create mode 100644 tools/depends/native/giflib/01-static-lib.patch

diff --git a/tools/depends/native/giflib/01-static-lib.patch b/tools/depends/native/giflib/01-static-lib.patch
new file mode 100644
index 000000000000..a5b0ebce3ba9
--- /dev/null
+++ b/tools/depends/native/giflib/01-static-lib.patch
@@ -0,0 +1,12 @@
+--- a/Makefile
++++ b/Makefile
+@@ -99,9 +99,6 @@
+ install-lib:
+ 	$(INSTALL) -d "$(DESTDIR)$(LIBDIR)"
+ 	$(INSTALL) -m 644 libgif.a "$(DESTDIR)$(LIBDIR)/libgif.a"
+-	$(INSTALL) -m 755 libgif.so "$(DESTDIR)$(LIBDIR)/libgif.so.$(LIBVER)"
+-	ln -sf libgif.so.$(LIBVER) "$(DESTDIR)$(LIBDIR)/libgif.so.$(LIBMAJOR)"
+-	ln -sf libgif.so.$(LIBMAJOR) "$(DESTDIR)$(LIBDIR)/libgif.so"
+ install-man:
+ 	$(INSTALL) -d "$(DESTDIR)$(MANDIR)/man1"
+ 	$(INSTALL) -m 644 doc/*.1 "$(DESTDIR)$(MANDIR)/man1"
diff --git a/tools/depends/native/giflib/Makefile b/tools/depends/native/giflib/Makefile
index f8a8c509dd90..0f7cf353f80c 100644
--- a/tools/depends/native/giflib/Makefile
+++ b/tools/depends/native/giflib/Makefile
@@ -1,18 +1,18 @@
 include ../../Makefile.include
-DEPS= ../../Makefile.include Makefile
+DEPS= ../../Makefile.include Makefile 01-static-lib.patch
 PREFIX=$(NATIVEPREFIX)
 PLATFORM=$(NATIVEPLATFORM)
 
 # lib name, version
 LIBNAME=giflib
-VERSION=5.1.4
+VERSION=5.2.1
 SOURCE=$(LIBNAME)-$(VERSION)
-ARCHIVE=$(SOURCE).tar.bz2
+ARCHIVE=$(SOURCE).tar.gz
 
 # configuration settings
 CONFIGURE=./configure --prefix=$(PREFIX)
 
-LIBDYLIB=$(PLATFORM)/lib/.libs/libgif.a
+LIBDYLIB=$(PLATFORM)/libgif.a
 
 all: .installed-$(PLATFORM)
 
@@ -22,13 +22,14 @@ $(TARBALLS_LOCATION)/$(ARCHIVE):
 $(PLATFORM): $(TARBALLS_LOCATION)/$(ARCHIVE) $(DEPS)
 	-rm -rf $(PLATFORM); mkdir -p $(PLATFORM)
 	cd $(PLATFORM); $(ARCHIVE_TOOL) $(ARCHIVE_TOOL_FLAGS) $(TARBALLS_LOCATION)/$(ARCHIVE)
-	cd $(PLATFORM); $(CONFIGURE)
+	cd $(PLATFORM); patch -p1 -i ../01-static-lib.patch
 
 $(LIBDYLIB): $(PLATFORM)
-	$(MAKE) -C $(PLATFORM)
+	$(MAKE) -C $(PLATFORM) libgif.a CFLAGS="$(NATIVE_CFLAGS)" LDFLAGS="$(NATIVE_LDFLAGS)"
 
 .installed-$(PLATFORM): $(LIBDYLIB)
-	$(MAKE) -C $(PLATFORM) install
+	$(MAKE) -C $(PLATFORM) install-include PREFIX="$(PREFIX)"
+	$(MAKE) -C $(PLATFORM) install-lib PREFIX="$(PREFIX)"
 	touch $@
 clean:
 	$(MAKE) -C $(PLATFORM) clean

From cb8e6a77650875f90cd61b13c2856ace015a34cc Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Tue, 25 Jun 2019 22:04:40 +0200
Subject: [PATCH 05/12] [depends] bump meson to 0.51.0

---
 tools/depends/native/Makefile            |  7 ++--
 tools/depends/native/libffi/Makefile     | 43 ++++++++++++++++++++++++
 tools/depends/native/meson/Makefile      |  2 +-
 tools/depends/native/python3/Makefile    |  2 +-
 tools/depends/native/setuptools/Makefile | 30 +++++++++++++++++
 tools/depends/target/cross-file.meson.in |  2 +-
 6 files changed, 80 insertions(+), 6 deletions(-)
 create mode 100644 tools/depends/native/libffi/Makefile
 create mode 100644 tools/depends/native/setuptools/Makefile

diff --git a/tools/depends/native/Makefile b/tools/depends/native/Makefile
index f0077a6bc865..5324b91eed1b 100644
--- a/tools/depends/native/Makefile
+++ b/tools/depends/native/Makefile
@@ -23,7 +23,7 @@ endif
 
 ifeq ($(OS),linux)
   ifeq ($(TARGET_PLATFORM),$(filter $(TARGET_PLATFORM),raspberry-pi gbm))
-    NATIVE += meson ninja python3
+    NATIVE += libffi meson ninja python3 setuptools
   endif
 endif
 
@@ -44,14 +44,15 @@ dpkg: automake gettext libtool pkg-config tar
 flatbuffers: cmake
 libtool: automake
 libpng: zlib
-meson: python3
+meson: python3 setuptools
 ninja: python3
 swig: pcre
 distribute: python27
 distutilscross: python27 distribute
 tar: xz automake
 python27: zlib
-python3: $(EXPAT) zlib
+python3: $(EXPAT) libffi pkg-config zlib
+setuptools: python3
 wayland-scanner: expat
 waylandpp-scanner: cmake
 
diff --git a/tools/depends/native/libffi/Makefile b/tools/depends/native/libffi/Makefile
new file mode 100644
index 000000000000..462bc6e4c792
--- /dev/null
+++ b/tools/depends/native/libffi/Makefile
@@ -0,0 +1,43 @@
+include ../../Makefile.include
+PREFIX=$(NATIVEPREFIX)
+PLATFORM=$(NATIVEPLATFORM)
+DEPS= ../../Makefile.include Makefile
+
+# lib name, version
+LIBNAME=libffi
+VERSION=3.2.1
+SOURCE=$(LIBNAME)-$(VERSION)
+ARCHIVE=$(SOURCE).tar.gz
+
+# configuration settings
+CONFIGURE= CFLAGS="-fPIC" ./configure --prefix=$(NATIVEPREFIX) --disable-shared --disable-builddir
+
+
+LIBDYLIB=$(PLATFORM)/.libs/$(LIBNAME).a
+
+all: .installed-$(PLATFORM)
+
+$(TARBALLS_LOCATION)/$(ARCHIVE):
+	cd $(TARBALLS_LOCATION); $(RETRIEVE_TOOL) $(RETRIEVE_TOOL_FLAGS) $(BASE_URL)/$(ARCHIVE)
+
+$(PLATFORM): $(TARBALLS_LOCATION)/$(ARCHIVE) $(DEPS)
+	rm -rf $(PLATFORM); mkdir -p $(PLATFORM)
+	cd $(PLATFORM); $(ARCHIVE_TOOL) $(ARCHIVE_TOOL_FLAGS) $(TARBALLS_LOCATION)/$(ARCHIVE)
+	cd $(PLATFORM); $(CONFIGURE)
+
+$(LIBDYLIB): $(PLATFORM)
+	$(MAKE) -j 1 -C $(PLATFORM)
+	touch $@
+
+.installed-$(PLATFORM): $(LIBDYLIB)
+	$(MAKE) -C $(PLATFORM) install
+	mkdir -p $(NATIVEPREFIX)/include/ffi
+	cp $(NATIVEPREFIX)/lib/$(SOURCE)/include/* $(NATIVEPREFIX)/include/ffi/
+	touch $@
+
+clean:
+	$(MAKE) -C $(PLATFORM) clean
+	rm -f .installed-$(PLATFORM)
+
+distclean::
+	rm -rf $(PLATFORM) .installed-$(PLATFORM)
diff --git a/tools/depends/native/meson/Makefile b/tools/depends/native/meson/Makefile
index 7b0506369c3f..832f1a9f4307 100644
--- a/tools/depends/native/meson/Makefile
+++ b/tools/depends/native/meson/Makefile
@@ -4,7 +4,7 @@ DEPS=../../Makefile.include Makefile
 
 # lib name, version
 LIBNAME=meson
-VERSION=0.45.1
+VERSION=0.51.0
 SOURCE=$(LIBNAME)-$(VERSION)
 ARCHIVE=$(SOURCE).tar.gz
 
diff --git a/tools/depends/native/python3/Makefile b/tools/depends/native/python3/Makefile
index 5902fb8692d4..039fa8d07743 100644
--- a/tools/depends/native/python3/Makefile
+++ b/tools/depends/native/python3/Makefile
@@ -8,7 +8,7 @@ VERSION=3.6.4
 SOURCE=$(LIBNAME)-$(VERSION)
 ARCHIVE=$(SOURCE).tar.xz
 
-CONFIGURE=./configure --prefix=$(NATIVEPREFIX) --disable-shared --disable-framework --without-ensurepip --without-pymalloc
+CONFIGURE=./configure --prefix=$(NATIVEPREFIX) --disable-shared --disable-framework --without-ensurepip --without-pymalloc --with-system-ffi
 ifeq ($(TARGET_PLATFORM),wayland)
   CONFIGURE += --with-system-expat
 endif
diff --git a/tools/depends/native/setuptools/Makefile b/tools/depends/native/setuptools/Makefile
new file mode 100644
index 000000000000..376a72e54abd
--- /dev/null
+++ b/tools/depends/native/setuptools/Makefile
@@ -0,0 +1,30 @@
+include ../../Makefile.include
+PREFIX=$(NATIVEPREFIX)
+PLATFORM=$(NATIVEPLATFORM)
+DEPS= ../../Makefile.include Makefile
+
+# lib name, version
+LIBNAME=setuptools
+VERSION=41.0.1
+ARCHIVE=$(LIBNAME)-$(VERSION).tar.gz
+
+all: .installed-$(PLATFORM)
+
+$(TARBALLS_LOCATION)/$(ARCHIVE):
+	cd $(TARBALLS_LOCATION); $(RETRIEVE_TOOL) $(RETRIEVE_TOOL_FLAGS) $(BASE_URL)/$(ARCHIVE)
+	cd $(TARBALLS_LOCATION); chmod +x $(ARCHIVE)
+
+$(PLATFORM): $(TARBALLS_LOCATION)/$(ARCHIVE) $(DEPS)
+	-rm -rf $(PLATFORM)/*; mkdir -p $(PLATFORM)
+	cd $(PLATFORM); $(ARCHIVE_TOOL) $(ARCHIVE_TOOL_FLAGS) $(TARBALLS_LOCATION)/$(ARCHIVE)
+	cd $(PLATFORM); $(PREFIX)/bin/python3 bootstrap.py
+
+.installed-$(PLATFORM): $(PLATFORM)
+	cd $(PLATFORM); $(PREFIX)/bin/python3 setup.py install --prefix=$(PREFIX)
+	touch $@
+
+clean:
+	rm -f .installed-$(PLATFORM)
+
+distclean::
+	rm -rf $(PLATFORM) .installed-$(PLATFORM)
diff --git a/tools/depends/target/cross-file.meson.in b/tools/depends/target/cross-file.meson.in
index cab0664a9ca6..14fc434a1aa1 100644
--- a/tools/depends/target/cross-file.meson.in
+++ b/tools/depends/target/cross-file.meson.in
@@ -7,7 +7,7 @@ pkgconfig = '@prefix@/@tool_dir@/bin/pkg-config'
 
 [properties]
 cargs = ['@platform_cflags@', '@platform_includes@', '-isystem @prefix@/@deps_dir@/include']
-c_link_args = ['-L@prefix@/@deps_dir@/lib', '-L@prefix@/@deps_dir@/lib64', '@platform_ldflags@']
+c_link_args = ['-L@prefix@/@deps_dir@/lib -L@prefix@/@deps_dir@/lib64 @platform_ldflags@']
 
 [host_machine]
 system = ''

From 7afc525b75d4df7fe55e444f27014daa2c532b17 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Tue, 25 Jun 2019 22:04:40 +0200
Subject: [PATCH 06/12] [depends] bump ninja to 1.9.0

---
 tools/depends/native/ninja/Makefile | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/tools/depends/native/ninja/Makefile b/tools/depends/native/ninja/Makefile
index 449462866404..f0733d40cf84 100644
--- a/tools/depends/native/ninja/Makefile
+++ b/tools/depends/native/ninja/Makefile
@@ -4,7 +4,7 @@ DEPS= ../../Makefile.include Makefile
 
 # lib name, version
 LIBNAME=ninja
-VERSION=1.8.2
+VERSION=1.9.0
 SOURCE=$(LIBNAME)-$(VERSION)
 ARCHIVE=$(SOURCE).tar.gz
 

From 3f6c715d2b213b276e29a05fe57ebb16f6f7fced Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Tue, 25 Jun 2019 22:04:40 +0200
Subject: [PATCH 07/12] [depends] bump pkg-config to 0.29.2

---
 tools/depends/native/pkg-config/Makefile | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/tools/depends/native/pkg-config/Makefile b/tools/depends/native/pkg-config/Makefile
index 6a481579a092..e8ec7477505b 100644
--- a/tools/depends/native/pkg-config/Makefile
+++ b/tools/depends/native/pkg-config/Makefile
@@ -6,7 +6,7 @@ DEPS= ../../Makefile.include Makefile
 # lib name, version
 # lib name, version
 LIBNAME=pkg-config
-VERSION=0.28
+VERSION=0.29.2
 SOURCE=$(LIBNAME)-$(VERSION)
 ARCHIVE=$(SOURCE).tar.gz
 

From d8b5397d06fdf1a24d1d4be477c72ad7c5ca5129 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Tue, 25 Jun 2019 22:04:40 +0200
Subject: [PATCH 08/12] [depends] bump python3 to 3.7.3

---
 tools/depends/native/python3/Makefile | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/tools/depends/native/python3/Makefile b/tools/depends/native/python3/Makefile
index 039fa8d07743..e7863afa7914 100644
--- a/tools/depends/native/python3/Makefile
+++ b/tools/depends/native/python3/Makefile
@@ -4,7 +4,7 @@ DEPS= ../../Makefile.include Makefile
 
 # lib name, version
 LIBNAME=Python
-VERSION=3.6.4
+VERSION=3.7.3
 SOURCE=$(LIBNAME)-$(VERSION)
 ARCHIVE=$(SOURCE).tar.xz
 

From b635574f763fc46c3ebb52ad98d6e4e21c7e701a Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Tue, 25 Jun 2019 22:04:40 +0200
Subject: [PATCH 09/12] [depends] bump swig to 4.0.0

---
 tools/depends/native/swig/Makefile | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/tools/depends/native/swig/Makefile b/tools/depends/native/swig/Makefile
index e0cb3b81502d..991d4b19e504 100644
--- a/tools/depends/native/swig/Makefile
+++ b/tools/depends/native/swig/Makefile
@@ -6,7 +6,7 @@ DEPS= ../../Makefile.include Makefile
 
 # lib name, version
 LIBNAME=swig
-VERSION=3.0.12
+VERSION=4.0.0
 SOURCE=$(LIBNAME)-$(VERSION)
 ARCHIVE=$(SOURCE).tar.gz
 

From 3dc8e544e56ffea40c7e72899b40fef6a356ffd1 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Tue, 25 Jun 2019 22:04:40 +0200
Subject: [PATCH 10/12] [depends] bump xz to 5.2.4

---
 tools/depends/native/xz/Makefile | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/tools/depends/native/xz/Makefile b/tools/depends/native/xz/Makefile
index c6c2bf7a8b7f..8d4cf2b6d27e 100644
--- a/tools/depends/native/xz/Makefile
+++ b/tools/depends/native/xz/Makefile
@@ -5,7 +5,7 @@ DEPS= ../../Makefile.include Makefile
 
 # app name, version
 APPNAME=xz
-VERSION=5.0.5
+VERSION=5.2.4
 SOURCE=$(APPNAME)-$(VERSION)
 ARCHIVE=$(SOURCE).tar.bz2
 

From 3519c660822f48d387e617bc4649276a9f5620b4 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Tue, 25 Jun 2019 22:04:40 +0200
Subject: [PATCH 11/12] [depends] bump yasm to 1.3.0

---
 tools/depends/native/yasm/Makefile | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/tools/depends/native/yasm/Makefile b/tools/depends/native/yasm/Makefile
index 373efc3b080f..f75934a02809 100644
--- a/tools/depends/native/yasm/Makefile
+++ b/tools/depends/native/yasm/Makefile
@@ -4,7 +4,7 @@ PLATFORM=$(NATIVEPLATFORM)
 DEPS= ../../Makefile.include Makefile
 
 APPNAME=yasm
-VERSION=1.1.0
+VERSION=1.3.0
 SOURCE=$(APPNAME)-$(VERSION)
 ARCHIVE=$(SOURCE).tar.gz
 

From 6b5ae130f95d6d17b8a053aae502264765a3007e Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Tue, 25 Jun 2019 22:04:40 +0200
Subject: [PATCH 12/12] [depends] bump zlib to 1.2.11

---
 tools/depends/native/zlib/Makefile         | 2 +-
 tools/depends/native/zlib/visibility.patch | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/tools/depends/native/zlib/Makefile b/tools/depends/native/zlib/Makefile
index d4750b565419..af84c6528be7 100644
--- a/tools/depends/native/zlib/Makefile
+++ b/tools/depends/native/zlib/Makefile
@@ -5,7 +5,7 @@ DEPS= ../../Makefile.include Makefile visibility.patch
 
 # lib name, version
 LIBNAME=zlib
-VERSION=1.2.7
+VERSION=1.2.11
 SOURCE=$(LIBNAME)-$(VERSION)
 ARCHIVE=$(SOURCE).tar.gz
 # configuration settings
diff --git a/tools/depends/native/zlib/visibility.patch b/tools/depends/native/zlib/visibility.patch
index 0b4ac78a74b2..3257f7fedb64 100644
--- a/tools/depends/native/zlib/visibility.patch
+++ b/tools/depends/native/zlib/visibility.patch
@@ -1,6 +1,6 @@
 --- a/zconf.h.in
 +++ b/zconf.h.in
-@@ -348,7 +348,11 @@
+@@ -374,7 +374,11 @@
  #endif
  
  #ifndef ZEXTERN
