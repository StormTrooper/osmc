From 2cdd27cf58b11dc05e7ad6323a09a8b65ce3c6ac Mon Sep 17 00:00:00 2001
From: ronie <ronie@kodi.tv>
Date: Sun, 29 Mar 2020 23:09:59 +0200
Subject: [PATCH] add ListItem.TvShowDBID infolabel

---
 xbmc/GUIInfoManager.cpp              | 18 ++++++++++++++++++
 xbmc/guilib/guiinfo/GUIInfoLabels.h  |  4 +++-
 xbmc/guilib/guiinfo/VideoGUIInfo.cpp |  8 ++++++++
 3 files changed, 29 insertions(+), 1 deletion(-)

diff --git a/xbmc/GUIInfoManager.cpp b/xbmc/GUIInfoManager.cpp
index 05198d09ee47..c23ee81d85fd 100644
--- a/xbmc/GUIInfoManager.cpp
+++ b/xbmc/GUIInfoManager.cpp
@@ -3568,6 +3568,14 @@ const infomap musicplayer[] =    {{ "title",            MUSICPLAYER_TITLE },
 ///     @skinning_v19 **[New Infolabel]** \link VideoPlayer_UniqueID `VideoPlayer.UniqueID(name)`\endlink
 ///     <p>
 ///   }
+///   \table_row3{   <b>`VideoPlayer.TvShowDBID`</b>,
+///                  \anchor VideoPlayer_TvShowDBID
+///                  _string_,
+///     @return The database id of the TvShow for the currently playing Episode
+///     <p><hr>
+///     @skinning_v19 **[New Infolabel]** \link VideoPlayer_TvShowDBID `VideoPlayer.TvShowDBID`\endlink
+///     <p>
+///   }
 /// \table_end
 ///
 /// -----------------------------------------------------------------------------
@@ -3639,6 +3647,7 @@ const infomap videoplayer[] =    {{ "title",            VIDEOPLAYER_TITLE },
                                   { "episodename",      VIDEOPLAYER_EPISODENAME },
                                   { "dbid",             VIDEOPLAYER_DBID },
                                   { "uniqueid",         VIDEOPLAYER_UNIQUEID },
+                                  { "tvshowdbid",       VIDEOPLAYER_TVSHOWDBID },
 };
 
 /// \page modules__infolabels_boolean_conditions
@@ -6384,6 +6393,14 @@ const infomap container_str[]  = {{ "property",         CONTAINER_PROPERTY },
 ///     @skinning_v19 **[New Infolabel]** \link ListItem_No_Of_Channels `ListItem.NoOfChannels`\endlink
 ///     <p>
 ///   }
+///   \table_row3{   <b>`ListItem.TvShowDBID`</b>,
+///                  \anchor ListItem_TvShowDBID
+///                  _string_,
+///     @return The database id of the TvShow for the currently selected Season or Episode.
+///     <p><hr>
+///     @skinning_v19 **[New Infolabel]** \link ListItem_TvShowDBID `ListItem.TvShowDBID`\endlink
+///     <p>
+///   }
 /// \table_end
 ///
 /// -----------------------------------------------------------------------------
@@ -6590,6 +6607,7 @@ const infomap listitem_labels[]= {{ "thumb",            LISTITEM_THUMB },
                                   { "ispremiere",       LISTITEM_IS_PREMIERE },
                                   { "isfinale",         LISTITEM_IS_FINALE },
                                   { "islive",           LISTITEM_IS_LIVE },
+                                  { "tvshowdbid",       LISTITEM_TVSHOWDBID },
 };
 
 /// \page modules__infolabels_boolean_conditions
diff --git a/xbmc/guilib/guiinfo/GUIInfoLabels.h b/xbmc/guilib/guiinfo/GUIInfoLabels.h
index e037f1904d99..251ab08e324e 100644
--- a/xbmc/guilib/guiinfo/GUIInfoLabels.h
+++ b/xbmc/guilib/guiinfo/GUIInfoLabels.h
@@ -235,10 +235,11 @@
 #define VIDEOPLAYER_IMDBNUMBER        276
 #define VIDEOPLAYER_USER_RATING       277
 #define VIDEOPLAYER_DBID              278
+#define VIDEOPLAYER_TVSHOWDBID        279
 
 // Range of videoplayer infolabels that work with offset and position
 #define VIDEOPLAYER_OFFSET_POSITION_FIRST VIDEOPLAYER_TITLE
-#define VIDEOPLAYER_OFFSET_POSITION_LAST VIDEOPLAYER_DBID
+#define VIDEOPLAYER_OFFSET_POSITION_LAST VIDEOPLAYER_TVSHOWDBID
 
 #define VIDEOPLAYER_AUDIO_BITRATE     281
 #define VIDEOPLAYER_VIDEO_BITRATE     282
@@ -916,6 +917,7 @@
 #define LISTITEM_IS_PREMIERE        (LISTITEM_START + 200)
 #define LISTITEM_IS_FINALE          (LISTITEM_START + 201)
 #define LISTITEM_IS_LIVE            (LISTITEM_START + 202)
+#define LISTITEM_TVSHOWDBID         (LISTITEM_START + 203)
 
 #define LISTITEM_END                (LISTITEM_START + 2500)
 
diff --git a/xbmc/guilib/guiinfo/VideoGUIInfo.cpp b/xbmc/guilib/guiinfo/VideoGUIInfo.cpp
index 97ec5785a073..fec8190096ed 100644
--- a/xbmc/guilib/guiinfo/VideoGUIInfo.cpp
+++ b/xbmc/guilib/guiinfo/VideoGUIInfo.cpp
@@ -146,6 +146,14 @@ bool CVideoGUIInfo::GetLabel(std::string& value, const CFileItem *item, int cont
           return true;
         }
         break;
+      case VIDEOPLAYER_TVSHOWDBID:
+      case LISTITEM_TVSHOWDBID:
+        if (tag->m_iIdShow > -1)
+        {
+          value = StringUtils::Format("%i", tag->m_iIdShow);
+          return true;
+        }
+        break;
       case VIDEOPLAYER_UNIQUEID:
       case LISTITEM_UNIQUEID:
         if (!info.GetData3().empty())
