From 3ce9ab5a051c7ab1189c34524698f55fb843983c Mon Sep 17 00:00:00 2001
From: ronie <ronie@kodi.tv>
Date: Sun, 15 Mar 2020 23:11:48 +0100
Subject: [PATCH] [json-rpc] favourites - add support for androidapp

---
 xbmc/interfaces/json-rpc/FavouritesOperations.cpp | 14 +++++++++++++-
 xbmc/interfaces/json-rpc/schema/methods.json      |  2 +-
 xbmc/interfaces/json-rpc/schema/types.json        |  2 +-
 xbmc/interfaces/json-rpc/schema/version.txt       |  2 +-
 4 files changed, 16 insertions(+), 4 deletions(-)

diff --git a/xbmc/interfaces/json-rpc/FavouritesOperations.cpp b/xbmc/interfaces/json-rpc/FavouritesOperations.cpp
index 08e74923ad9a..3eb5b15164dc 100644
--- a/xbmc/interfaces/json-rpc/FavouritesOperations.cpp
+++ b/xbmc/interfaces/json-rpc/FavouritesOperations.cpp
@@ -86,6 +86,12 @@ JSONRPC_STATUS CFavouritesOperations::GetFavourites(const std::string &method, I
       if (fields.find("path") !=  fields.end())
         object["path"] = parameters[0];
     }
+    else if (StringUtils::EqualsNoCase(function, "StartAndroidActivity"))
+    {
+      object["type"] = "androidapp";
+      if (fields.find("path") !=  fields.end())
+        object["path"] = parameters[0];
+    }
     else
       object["type"] = "unknown";
 
@@ -106,7 +112,7 @@ JSONRPC_STATUS CFavouritesOperations::AddFavourite(const std::string &method, IT
   if (type.compare("unknown") == 0)
     return InvalidParams;
 
-  if ((type.compare("media") == 0 || type.compare("script") == 0) && !ParameterNotNull(parameterObject, "path"))
+  if ((type.compare("media") == 0 || type.compare("script") == 0 || type.compare("androidapp") == 0) && !ParameterNotNull(parameterObject, "path"))
   {
     result["method"] = "Favourites.AddFavourite";
     result["stack"]["message"] = "Missing parameter";
@@ -142,6 +148,12 @@ JSONRPC_STATUS CFavouritesOperations::AddFavourite(const std::string &method, IT
       path = "script://" + path;
     item = CFileItem(path, false);
   }
+  else if (type.compare("androidapp") == 0)
+  {
+    if (!URIUtils::IsAndroidApp(path))
+      path = "androidapp://" + path;
+    item = CFileItem(path, false);
+  }
   else if (type.compare("media") == 0)
   {
     item = CFileItem(path, false);
diff --git a/xbmc/interfaces/json-rpc/schema/methods.json b/xbmc/interfaces/json-rpc/schema/methods.json
index 1e32c2f4e729..00721b6af799 100644
--- a/xbmc/interfaces/json-rpc/schema/methods.json
+++ b/xbmc/interfaces/json-rpc/schema/methods.json
@@ -2555,7 +2555,7 @@
     "params": [
       { "name": "title", "type": "string", "required": true },
       { "name": "type", "$ref": "Favourite.Type", "required": true },
-      { "name": "path", "$ref": "Optional.String", "description": "Required for media and script favourites types" },
+      { "name": "path", "$ref": "Optional.String", "description": "Required for media, script and androidapp favourites types" },
       { "name": "window", "$ref": "Optional.String", "description": "Required for window favourite type" },
       { "name": "windowparameter", "$ref": "Optional.String" },
       { "name": "thumbnail", "$ref": "Optional.String" }
diff --git a/xbmc/interfaces/json-rpc/schema/types.json b/xbmc/interfaces/json-rpc/schema/types.json
index 5de34c55ac7c..192b9e2cd7fe 100644
--- a/xbmc/interfaces/json-rpc/schema/types.json
+++ b/xbmc/interfaces/json-rpc/schema/types.json
@@ -1708,7 +1708,7 @@
   },
   "Favourite.Type": {
     "type": "string",
-    "enum": [ "media", "window", "script", "unknown" ]
+    "enum": [ "media", "window", "script", "androidapp", "unknown" ]
   },
   "Favourite.Details.Favourite": {
     "type": "object",
diff --git a/xbmc/interfaces/json-rpc/schema/version.txt b/xbmc/interfaces/json-rpc/schema/version.txt
index b97b0d70ffa2..e0e0d11ff9f6 100644
--- a/xbmc/interfaces/json-rpc/schema/version.txt
+++ b/xbmc/interfaces/json-rpc/schema/version.txt
@@ -1 +1 @@
-JSONRPC_VERSION 11.4.0
+JSONRPC_VERSION 11.5.0
