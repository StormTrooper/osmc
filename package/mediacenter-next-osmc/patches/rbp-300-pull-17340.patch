From 1a95c1f6faf341781baaa6082dfd3a85795aba4a Mon Sep 17 00:00:00 2001
From: ronie <ronie@kodi.tv>
Date: Fri, 7 Feb 2020 16:21:31 +0100
Subject: [PATCH] [guilib] add listitem.uniqueid() infolabel

---
 xbmc/GUIInfoManager.cpp              | 24 ++++++++++++++++++++++--
 xbmc/guilib/guiinfo/GUIInfoLabels.h  |  2 ++
 xbmc/guilib/guiinfo/VideoGUIInfo.cpp |  5 +++++
 3 files changed, 29 insertions(+), 2 deletions(-)

diff --git a/xbmc/GUIInfoManager.cpp b/xbmc/GUIInfoManager.cpp
index c8f24dd201e3..26c67d9e3044 100644
--- a/xbmc/GUIInfoManager.cpp
+++ b/xbmc/GUIInfoManager.cpp
@@ -3092,6 +3092,15 @@ const infomap musicplayer[] =    {{ "title",            MUSICPLAYER_TITLE },
 ///     @skinning_v17 **[New Infolabel]** \link VideoPlayer_DBID `VideoPlayer.DBID`\endlink
 ///     <p>
 ///   }
+///   \table_row3{   <b>`VideoPlayer.UniqueID(name)`</b>,
+///                  \anchor VideoPlayer_UniqueID
+///                  _string_,
+///     @return The scraped metadata id of current movie\, if it's in the database.
+///     @param name - the name of the metadata provider.
+///     <p><hr>
+///     @skinning_v19 **[New Infolabel]** \link VideoPlayer_UniqueID `VideoPlayer.UniqueID(name)`\endlink
+///     <p>
+///   }
 /// \table_end
 ///
 /// -----------------------------------------------------------------------------
@@ -3161,7 +3170,8 @@ const infomap videoplayer[] =    {{ "title",            VIDEOPLAYER_TITLE },
                                   { "canresumelivetv",  VIDEOPLAYER_CAN_RESUME_LIVE_TV },
                                   { "imdbnumber",       VIDEOPLAYER_IMDBNUMBER },
                                   { "episodename",      VIDEOPLAYER_EPISODENAME },
-                                  { "dbid",             VIDEOPLAYER_DBID }
+                                  { "dbid",             VIDEOPLAYER_DBID },
+                                  { "uniqueid",         VIDEOPLAYER_UNIQUEID },
 };
 
 /// \page modules__infolabels_boolean_conditions
@@ -5851,6 +5861,14 @@ const infomap container_str[]  = {{ "property",         CONTAINER_PROPERTY },
 ///     @return The BPM of a song.
 ///     <p><hr>
 ///     @skinning_v19 **[New Infolabel]** \link ListItem_BPM `ListItem.BPM`\endlink
+///   \table_row3{   <b>`ListItem.UniqueID(name)`</b>,
+///                  \anchor ListItem_UniqueID
+///                  _string_,
+///     @return The scraped metadata id of the currently selected item in a container\,
+///     for use in dialogvideoinfo.xml.
+///     @param name - the name of the metadata provider.
+///     <p><hr>
+///     @skinning_v19 **[New Infolabel]** \link ListItem_UniqueID `ListItem.UniqueID(name)`\endlink
 ///     <p>
 ///   }
 /// \table_end
@@ -6052,6 +6070,7 @@ const infomap listitem_labels[]= {{ "thumb",            LISTITEM_THUMB },
                                   { "releasedate",      LISTITEM_RELEASEDATE },
                                   { "originaldate",     LISTITEM_ORIGINALDATE },
                                   { "bpm",              LISTITEM_BPM },
+                                  { "uniqueid",         LISTITEM_UNIQUEID },
 };
 
 /// \page modules__infolabels_boolean_conditions
@@ -9361,7 +9380,8 @@ int CGUIInfoManager::TranslateListItem(const Property& cat, const Property& prop
              prop.name == "art" ||
              prop.name == "rating" ||
              prop.name == "votes" ||
-             prop.name == "ratingandvotes")
+             prop.name == "ratingandvotes" ||
+             prop.name == "uniqueid")
     {
       data3 = prop.param();
     }
diff --git a/xbmc/guilib/guiinfo/GUIInfoLabels.h b/xbmc/guilib/guiinfo/GUIInfoLabels.h
index e693d5cd668f..520cdb4fa415 100644
--- a/xbmc/guilib/guiinfo/GUIInfoLabels.h
+++ b/xbmc/guilib/guiinfo/GUIInfoLabels.h
@@ -277,6 +277,7 @@
 #define VIDEOPLAYER_EPISODENAME       318
 #define VIDEOPLAYER_USER_RATING       319
 #define VIDEOPLAYER_DBID              320
+#define VIDEOPLAYER_UNIQUEID          321
 
 #define RETROPLAYER_VIDEO_FILTER      330
 #define RETROPLAYER_STRETCH_MODE      331
@@ -899,6 +900,7 @@
 #define LISTITEM_RELEASEDATE        (LISTITEM_START + 193)
 #define LISTITEM_ORIGINALDATE       (LISTITEM_START + 194)
 #define LISTITEM_BPM                (LISTITEM_START + 195)
+#define LISTITEM_UNIQUEID           (LISTITEM_START + 196)
 
 #define LISTITEM_END                (LISTITEM_START + 2500)
 
diff --git a/xbmc/guilib/guiinfo/VideoGUIInfo.cpp b/xbmc/guilib/guiinfo/VideoGUIInfo.cpp
index b86885295da1..dc2647f92d5c 100644
--- a/xbmc/guilib/guiinfo/VideoGUIInfo.cpp
+++ b/xbmc/guilib/guiinfo/VideoGUIInfo.cpp
@@ -139,6 +139,11 @@ bool CVideoGUIInfo::GetLabel(std::string& value, const CFileItem *item, int cont
           return true;
         }
         break;
+      case VIDEOPLAYER_UNIQUEID:
+      case LISTITEM_UNIQUEID:
+        if (!info.GetData3().empty())
+          value = tag->GetUniqueID(info.GetData3());
+        return true;
       case VIDEOPLAYER_RATING:
       case LISTITEM_RATING:
       {
