From 11eceae19867f61fe2a761d556a2df1f8f978f64 Mon Sep 17 00:00:00 2001
From: Dimitry Ishenko <dimitry.ishenko@gmail.com>
Date: Fri, 6 Sep 2019 14:08:09 -0400
Subject: [PATCH] TexturePacker: fix for 32-bit systems

---
 tools/depends/native/TexturePacker/CMakeLists.txt        | 2 +-
 tools/depends/native/TexturePacker/src/TexturePacker.cpp | 4 +++-
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/tools/depends/native/TexturePacker/CMakeLists.txt b/tools/depends/native/TexturePacker/CMakeLists.txt
index 68200a5cff24..97dc1d324494 100644
--- a/tools/depends/native/TexturePacker/CMakeLists.txt
+++ b/tools/depends/native/TexturePacker/CMakeLists.txt
@@ -51,4 +51,4 @@ target_link_libraries(TexturePacker
                               ${PNG_LIBRARIES}
                               ${JPEG_LIBRARIES}
                               ${LZO2_LIBRARIES})
-target_compile_options(TexturePacker PRIVATE ${ARCH_DEFINES})
+target_compile_options(TexturePacker PRIVATE ${ARCH_DEFINES} ${SYSTEM_DEFINES})
diff --git a/tools/depends/native/TexturePacker/src/TexturePacker.cpp b/tools/depends/native/TexturePacker/src/TexturePacker.cpp
index b2de24bf1b20..f977e5675651 100644
--- a/tools/depends/native/TexturePacker/src/TexturePacker.cpp
+++ b/tools/depends/native/TexturePacker/src/TexturePacker.cpp
@@ -80,7 +80,7 @@ void CreateSkeletonHeaderImpl(CXBTFWriter& xbtfWriter, std::string fullPath, std
 
   if (dirp)
   {
-    while ((dp = readdir(dirp)) != NULL)
+    for (errno = 0; (dp = readdir(dirp)); errno = 0)
     {
       if (strcmp(dp->d_name, ".") == 0 || strcmp(dp->d_name, "..") == 0)
       {
@@ -118,6 +118,8 @@ void CreateSkeletonHeaderImpl(CXBTFWriter& xbtfWriter, std::string fullPath, std
         }
       }
     }
+    if (errno)
+      fprintf(stderr, "Error reading directory %s (%s)\n", fullPath.c_str(), strerror(errno));
 
     closedir(dirp);
   }
