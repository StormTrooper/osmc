From a1f8ba30f5a986d52179d5391bb57fc35680ed02 Mon Sep 17 00:00:00 2001
From: Lukas Rusak <lorusak@gmail.com>
Date: Fri, 10 May 2019 11:32:08 -0700
Subject: [PATCH] [cmake] remove _LINUX define

---
 cmake/platform/android/defines.txt    |  2 +-
 cmake/platform/freebsd/defines.txt    |  2 +-
 cmake/platform/ios/defines.txt        |  2 +-
 cmake/platform/linux/defines.txt      |  2 +-
 cmake/platform/osx/defines.txt        |  2 +-
 cmake/scripts/android/ArchSetup.cmake |  2 +-
 cmake/scripts/freebsd/ArchSetup.cmake |  2 +-
 cmake/scripts/ios/ArchSetup.cmake     |  2 +-
 cmake/scripts/linux/ArchSetup.cmake   |  2 +-
 cmake/scripts/osx/ArchSetup.cmake     |  2 +-
 tools/depends/m4/xbmc_arch.m4         | 44 +++++++++++++--------------
 xbmc/pictures/ExifParse.cpp           |  7 +++--
 xbmc/pictures/IptcParse.cpp           | 10 ++++--
 xbmc/pictures/JpegParse.cpp           |  6 ++--
 xbmc/pictures/libexif.cpp             |  8 +++--
 15 files changed, 53 insertions(+), 42 deletions(-)

diff --git a/cmake/platform/android/defines.txt b/cmake/platform/android/defines.txt
index fa103d0060e6..4b70e5959a67 100644
--- a/cmake/platform/android/defines.txt
+++ b/cmake/platform/android/defines.txt
@@ -1 +1 @@
--DTARGET_POSIX -DTARGET_LINUX -D_LINUX -DTARGET_ANDROID
+-DTARGET_POSIX -DTARGET_LINUX -DTARGET_ANDROID
diff --git a/cmake/platform/freebsd/defines.txt b/cmake/platform/freebsd/defines.txt
index 94835971a332..bd23e57fae64 100644
--- a/cmake/platform/freebsd/defines.txt
+++ b/cmake/platform/freebsd/defines.txt
@@ -1 +1 @@
--DTARGET_POSIX -DTARGET_FREEBSD -D_LINUX
+-DTARGET_POSIX -DTARGET_FREEBSD
diff --git a/cmake/platform/ios/defines.txt b/cmake/platform/ios/defines.txt
index d0989ea1ce99..48491004e3c6 100644
--- a/cmake/platform/ios/defines.txt
+++ b/cmake/platform/ios/defines.txt
@@ -1 +1 @@
--DTARGET_POSIX -DTARGET_DARWIN -DTARGET_DARWIN_IOS -D_LINUX
+-DTARGET_POSIX -DTARGET_DARWIN -DTARGET_DARWIN_IOS
diff --git a/cmake/platform/linux/defines.txt b/cmake/platform/linux/defines.txt
index 3fe9c5caad39..88d2e6e88a28 100644
--- a/cmake/platform/linux/defines.txt
+++ b/cmake/platform/linux/defines.txt
@@ -1 +1 @@
--DTARGET_POSIX -DTARGET_LINUX -D_LINUX -fPIC
+-DTARGET_POSIX -DTARGET_LINUX -fPIC
diff --git a/cmake/platform/osx/defines.txt b/cmake/platform/osx/defines.txt
index 33b009e3a738..8ebb2baa6b2d 100644
--- a/cmake/platform/osx/defines.txt
+++ b/cmake/platform/osx/defines.txt
@@ -1 +1 @@
--DTARGET_POSIX -DTARGET_DARWIN -DTARGET_DARWIN_OSX -D_LINUX
+-DTARGET_POSIX -DTARGET_DARWIN -DTARGET_DARWIN_OSX
diff --git a/cmake/scripts/android/ArchSetup.cmake b/cmake/scripts/android/ArchSetup.cmake
index 69bb88d471f1..449d08a057de 100644
--- a/cmake/scripts/android/ArchSetup.cmake
+++ b/cmake/scripts/android/ArchSetup.cmake
@@ -2,7 +2,7 @@ if(NOT CMAKE_TOOLCHAIN_FILE)
   message(FATAL_ERROR "CMAKE_TOOLCHAIN_FILE required for android. See ${CMAKE_SOURCE_DIR}/cmake/README.md")
 endif()
 
-set(ARCH_DEFINES -DTARGET_POSIX -DTARGET_LINUX -D_LINUX -DTARGET_ANDROID)
+set(ARCH_DEFINES -DTARGET_POSIX -DTARGET_LINUX -DTARGET_ANDROID)
 set(SYSTEM_DEFINES -D__STDC_CONSTANT_MACROS -D_LARGEFILE64_SOURCE
                    -D_FILE_OFFSET_BITS=64 -D__USE_FILE_OFFSET64=1)
 
diff --git a/cmake/scripts/freebsd/ArchSetup.cmake b/cmake/scripts/freebsd/ArchSetup.cmake
index 3d5599c986b5..2869079a2075 100644
--- a/cmake/scripts/freebsd/ArchSetup.cmake
+++ b/cmake/scripts/freebsd/ArchSetup.cmake
@@ -1,4 +1,4 @@
-set(ARCH_DEFINES -D_LINUX -DTARGET_POSIX -DTARGET_FREEBSD)
+set(ARCH_DEFINES -DTARGET_POSIX -DTARGET_FREEBSD)
 set(SYSTEM_DEFINES -D__STDC_CONSTANT_MACROS -D_LARGEFILE64_SOURCE
                    -D_FILE_OFFSET_BITS=64)
 set(PLATFORM_DIR platform/linux)
diff --git a/cmake/scripts/ios/ArchSetup.cmake b/cmake/scripts/ios/ArchSetup.cmake
index b6c626fb49da..eefd04fcd4a5 100644
--- a/cmake/scripts/ios/ArchSetup.cmake
+++ b/cmake/scripts/ios/ArchSetup.cmake
@@ -4,7 +4,7 @@ endif()
 
 set(CORE_MAIN_SOURCE ${CMAKE_SOURCE_DIR}/xbmc/platform/darwin/ios/XBMCApplication.mm)
 
-set(ARCH_DEFINES -D_LINUX -DTARGET_POSIX -DTARGET_DARWIN -DTARGET_DARWIN_IOS)
+set(ARCH_DEFINES -DTARGET_POSIX -DTARGET_DARWIN -DTARGET_DARWIN_IOS)
 set(SYSTEM_DEFINES -D_REENTRANT -D_FILE_OFFSET_BITS=64 -D_LARGEFILE64_SOURCE
                    -D__STDC_CONSTANT_MACROS)
 set(PLATFORM_DIR platform/linux)
diff --git a/cmake/scripts/linux/ArchSetup.cmake b/cmake/scripts/linux/ArchSetup.cmake
index 30da42d7c448..61ad0158f12e 100644
--- a/cmake/scripts/linux/ArchSetup.cmake
+++ b/cmake/scripts/linux/ArchSetup.cmake
@@ -1,5 +1,5 @@
 # we always want to use GNU features if available, so set _GNU_SOURCE
-set(ARCH_DEFINES -D_LINUX -DTARGET_POSIX -DTARGET_LINUX -D_GNU_SOURCE)
+set(ARCH_DEFINES -DTARGET_POSIX -DTARGET_LINUX -D_GNU_SOURCE)
 set(SYSTEM_DEFINES -D__STDC_CONSTANT_MACROS -D_FILE_OFFSET_BITS=64)
 set(PLATFORM_DIR platform/linux)
 set(CMAKE_SYSTEM_NAME Linux)
diff --git a/cmake/scripts/osx/ArchSetup.cmake b/cmake/scripts/osx/ArchSetup.cmake
index 74f2ed4b3e96..103986ffdf11 100644
--- a/cmake/scripts/osx/ArchSetup.cmake
+++ b/cmake/scripts/osx/ArchSetup.cmake
@@ -6,7 +6,7 @@ set(CORE_MAIN_SOURCE ${CMAKE_SOURCE_DIR}/xbmc/platform/posix/main.cpp
                      ${CMAKE_SOURCE_DIR}/xbmc/platform/darwin/osx/SDLMain.mm
                      ${CMAKE_SOURCE_DIR}/xbmc/platform/darwin/osx/SDLMain.h)
 
-set(ARCH_DEFINES -D_LINUX -DTARGET_POSIX -DTARGET_DARWIN -DTARGET_DARWIN_OSX)
+set(ARCH_DEFINES -DTARGET_POSIX -DTARGET_DARWIN -DTARGET_DARWIN_OSX)
 set(SYSTEM_DEFINES -D_REENTRANT -D_FILE_OFFSET_BITS=64 -D_LARGEFILE64_SOURCE
                    -D__STDC_CONSTANT_MACROS)
 set(PLATFORM_DIR platform/linux)
diff --git a/tools/depends/m4/xbmc_arch.m4 b/tools/depends/m4/xbmc_arch.m4
index d28f2630028b..ce3467114b8c 100644
--- a/tools/depends/m4/xbmc_arch.m4
+++ b/tools/depends/m4/xbmc_arch.m4
@@ -3,28 +3,28 @@ AC_DEFUN([XBMC_SETUP_ARCH_DEFINES],[
 # build detection and setup - this is the native arch
 case $build in
   i*86*-linux-gnu*|i*86*-*-linux-uclibc*)
-     AC_SUBST(NATIVE_ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX -D_LINUX")
+     AC_SUBST(NATIVE_ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX")
      ;;
   x86_64-*-linux-gnu*|x86_64-*-linux-uclibc*)
-     AC_SUBST(NATIVE_ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX -D_LINUX")
+     AC_SUBST(NATIVE_ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX")
      ;;
   i386-*-freebsd*)
-     AC_SUBST(NATIVE_ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_FREEBSD -D_LINUX")
+     AC_SUBST(NATIVE_ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_FREEBSD")
      ;;
   amd64-*-freebsd*)
-     AC_SUBST(NATIVE_ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_FREEBSD -D_LINUX")
+     AC_SUBST(NATIVE_ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_FREEBSD")
      ;;
   *86*-apple-darwin*)
-     AC_SUBST(NATIVE_ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_DARWIN -DTARGET_DARWIN_OSX -D_LINUX")
+     AC_SUBST(NATIVE_ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_DARWIN -DTARGET_DARWIN_OSX")
      ;;
   powerpc-*-linux-gnu*|powerpc-*-linux-uclibc*)
-     AC_SUBST(NATIVE_ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX -D_LINUX -D_POWERPC")
+     AC_SUBST(NATIVE_ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX -D_POWERPC")
      ;;
   powerpc64-*-linux-gnu*|powerpc64-*-linux-uclibc*)
-     AC_SUBST(NATIVE_ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX -D_LINUX -D_POWERPC64")
+     AC_SUBST(NATIVE_ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX -D_POWERPC64")
      ;;
   arm*-*-linux-gnu*|arm*-*-linux-uclibc*)
-     AC_SUBST(NATIVE_ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX -D_LINUX")
+     AC_SUBST(NATIVE_ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX")
      ;;
   *)
      AC_MSG_ERROR(unsupported native build platform: $build)
@@ -34,50 +34,50 @@ esac
 # host detection and setup - this is the target arch
 case $host in
   i*86*-linux-gnu*|i*86*-*-linux-uclibc*)
-     AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX -D_LINUX")
+     AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX")
      ;;
   x86_64-*-linux-gnu*|x86_64-*-linux-uclibc*)
-     AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX -D_LINUX")
+     AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX")
      ;;
   i386-*-freebsd*)
-     AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_FREEBSD -D_LINUX")
+     AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_FREEBSD")
      ;;
   amd64-*-freebsd*)
-     AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_FREEBSD -D_LINUX")
+     AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_FREEBSD")
      ;;
   arm-apple-darwin*)
-     AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_DARWIN -DTARGET_DARWIN_IOS -D_LINUX")
+     AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_DARWIN -DTARGET_DARWIN_IOS")
      ;;
   *86*-apple-darwin*)
-     AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_DARWIN -DTARGET_DARWIN_OSX -D_LINUX")
+     AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_DARWIN -DTARGET_DARWIN_OSX")
      ;;
   powerpc-apple-darwin*)
-     AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_DARWIN -DTARGET_DARWIN_OSX -D_LINUX")
+     AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_DARWIN -DTARGET_DARWIN_OSX")
      ;;
   powerpc-*-linux-gnu*|powerpc-*-linux-uclibc*)
-     AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX -D_LINUX -D_POWERPC")
+     AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX -D_POWERPC")
      ;;
   powerpc64*-*-linux-gnu*|powerpc64*-*-linux-uclibc*)
-     AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX -D_LINUX -D_POWERPC64")
+     AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX -D_POWERPC64")
      ;;
   arm*-*-linux-gnu*|arm*-*-linux-uclibc*|aarch64*-*-linux-gnu*|aarch64*-*-linux-uclibc*)
-     AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX -D_LINUX")
+     AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX")
      ;;
   mips*-*-linux-gnu*|mips*-*-linux-uclibc*)
-     AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX -D_LINUX")
+     AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX")
      ;;
   *-*linux-android*)
-     AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX -D_LINUX -DTARGET_ANDROID")
+     AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX -DTARGET_ANDROID")
      ;;
   *)
      AC_MSG_ERROR(unsupported build target: $host)
 esac
 
 if test "$target_platform" = "target_android" ; then
-  AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX -D_LINUX -DTARGET_ANDROID")
+  AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX -DTARGET_ANDROID")
 fi
 
 if test "$target_platform" = "target_raspberry_pi" ; then
-  AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX -D_LINUX -D_ARMEL -DTARGET_RASPBERRY_PI")
+  AC_SUBST(ARCH_DEFINES, "-DTARGET_POSIX -DTARGET_LINUX -D_ARMEL -DTARGET_RASPBERRY_PI")
 fi
 ])
diff --git a/xbmc/pictures/ExifParse.cpp b/xbmc/pictures/ExifParse.cpp
index 98f4b99d6958..156ad0090084 100644
--- a/xbmc/pictures/ExifParse.cpp
+++ b/xbmc/pictures/ExifParse.cpp
@@ -16,15 +16,18 @@
 
 // Note: Jhead supports TAG_MAKER_NOTE exif field,
 //       but that is ommited for now - to make porting easier and addition smaller
-#ifndef _LINUX
+
+#include "ExifParse.h"
+
+#ifdef TARGET_WINDOWS
 #include <windows.h>
 #else
 #include <memory.h>
 #include <cstring>
 #endif
+
 #include <math.h>
 #include <stdio.h>
-#include "ExifParse.h"
 
 #ifndef min
 #define min(a,b) (a)>(b)?(b):(a)
diff --git a/xbmc/pictures/IptcParse.cpp b/xbmc/pictures/IptcParse.cpp
index 3c9d01408814..dc66f2772d8c 100644
--- a/xbmc/pictures/IptcParse.cpp
+++ b/xbmc/pictures/IptcParse.cpp
@@ -13,14 +13,18 @@
 //--------------------------------------------------------------------------
 //  Process IPTC data.
 //--------------------------------------------------------------------------
-#ifndef _LINUX
+
+#include "IptcParse.h"
+
+#include "ExifParse.h"
+
+#ifdef TARGET_WINDOWS
 #include <windows.h>
 #else
 #include <string.h>
 #endif
+
 #include <stdio.h>
-#include "IptcParse.h"
-#include "ExifParse.h"
 
 #ifndef min
 #define min(a,b) (a)>(b)?(b):(a)
diff --git a/xbmc/pictures/JpegParse.cpp b/xbmc/pictures/JpegParse.cpp
index c967b8dae7ee..ea38cb85f9d3 100644
--- a/xbmc/pictures/JpegParse.cpp
+++ b/xbmc/pictures/JpegParse.cpp
@@ -17,15 +17,17 @@
 // pairs (where both description and value fields are of CStdString types).
 //--------------------------------------------------------------------------
 
+#include "JpegParse.h"
+
 #include "filesystem/File.h"
-#ifndef _LINUX
+
+#ifdef TARGET_WINDOWS
 #include <windows.h>
 #else
 #include <memory.h>
 #include <cstring>
 typedef unsigned char BYTE;
 #endif
-#include "JpegParse.h"
 
 #ifndef min
 #define min(a,b) (a)>(b)?(b):(a)
diff --git a/xbmc/pictures/libexif.cpp b/xbmc/pictures/libexif.cpp
index b2d29dbe2e54..3ee75b975f03 100644
--- a/xbmc/pictures/libexif.cpp
+++ b/xbmc/pictures/libexif.cpp
@@ -1,14 +1,16 @@
 // libexif.cpp : Defines the entry point for the console application.
 //
 
-#ifndef _LINUX
+#include "libexif.h"
+
+#include "JpegParse.h"
+
+#ifdef TARGET_WINDOWS
 #include <windows.h>
 #else
 #include <memory.h>
 #include <cstring>
 #endif
-#include "JpegParse.h"
-#include "libexif.h"
 
 #ifdef __cplusplus
 extern "C" {
