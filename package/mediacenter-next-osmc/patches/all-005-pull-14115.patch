From 26d356dfe0dd9c5b5dcae601a0ee786a7f99aa86 Mon Sep 17 00:00:00 2001
From: kib <edeklerk@gmail.com>
Date: Wed, 27 Jun 2018 21:10:12 +0200
Subject: [PATCH] allow reading build date from a BUILDDATE file for
 environments where date information is incorrect (like Launchpad)

---
 cmake/scripts/common/Macros.cmake | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/cmake/scripts/common/Macros.cmake b/cmake/scripts/common/Macros.cmake
index fa06870115f6..0d89dd32574f 100644
--- a/cmake/scripts/common/Macros.cmake
+++ b/cmake/scripts/common/Macros.cmake
@@ -662,7 +662,11 @@ function(core_find_git_rev stamp)
       string(REPLACE "\"" "" DATE ${DATE})
       string(REPLACE "-" "" DATE ${DATE})
     else()
-      string(TIMESTAMP DATE "%Y%m%d" UTC)
+      if(EXISTS ${CMAKE_SOURCE_DIR}/BUILDDATE)
+        file(STRINGS ${CMAKE_SOURCE_DIR}/BUILDDATE DATE LIMIT_INPUT 8)
+      else()
+        string(TIMESTAMP DATE "%Y%m%d" UTC)
+      endif()
       if(EXISTS ${CMAKE_SOURCE_DIR}/VERSION)
         file(STRINGS ${CMAKE_SOURCE_DIR}/VERSION HASH LIMIT_INPUT 16)
       else()
