From 220c45c955900e6240f30d5d577bcf2db228fc23 Mon Sep 17 00:00:00 2001
From: enen92 <92enen@gmail.com>
Date: Wed, 22 Apr 2020 12:58:12 +0100
Subject: [PATCH] [docs][python] Improve documentation for xbmc.sleep and
 xbmc.Monitor().waitForAbort

---
 xbmc/interfaces/legacy/ModuleXbmc.h | 14 +++++++++++---
 xbmc/interfaces/legacy/Monitor.h    | 12 ++++++++++++
 2 files changed, 23 insertions(+), 3 deletions(-)

diff --git a/xbmc/interfaces/legacy/ModuleXbmc.h b/xbmc/interfaces/legacy/ModuleXbmc.h
index 7e6e2c82acf1..c17a3d2d4339 100644
--- a/xbmc/interfaces/legacy/ModuleXbmc.h
+++ b/xbmc/interfaces/legacy/ModuleXbmc.h
@@ -212,14 +212,22 @@ namespace XBMCAddon
     /// \ingroup python_xbmc
     /// @brief \python_func{ xbmc.sleep(time) }
     ///-----------------------------------------------------------------------
-    /// Sleeps for 'time' msec.
+    /// Sleeps for 'time' (msec).
+    /// \anchor xbmc_Sleep
     ///
     /// @param time                 integer - number of msec to sleep.
     ///
     /// @throws PyExc_TypeError     If time is not an integer.
     ///
-    /// @note This is useful if you have for example a Player class that is
-    ///       waiting for onPlayBackEnded() calls.
+    /// @warning This is useful if you need to sleep for a small amount of time
+    /// (milisecond range) somewhere in your addon logic. Please note that Kodi
+    /// will attempt to stop any running scripts when signaled to exit and wait for a maximum
+    /// of 5 seconds before trying to force stop your script. If your addon makes use
+    /// of \ref xbmc_Sleep "xbmc.sleep()" incorrectly (long periods of time, e.g. that exceed
+    /// the force stop waiting time) it may lead to Kodi hanging on shutdown.
+    /// In case your addon needs long sleep/idle periods use
+    /// \ref xbmc_Monitor_waitForAbort "xbmc.Monitor().waitForAbort(secs)"
+    /// instead.
     ///
     ///
     /// ------------------------------------------------------------------------
diff --git a/xbmc/interfaces/legacy/Monitor.h b/xbmc/interfaces/legacy/Monitor.h
index 49762025d555..b8ea1fd34a78 100644
--- a/xbmc/interfaces/legacy/Monitor.h
+++ b/xbmc/interfaces/legacy/Monitor.h
@@ -257,6 +257,7 @@ namespace XBMCAddon
       /// @brief \python_func{ waitForAbort([timeout]) }
       ///-----------------------------------------------------------------------
       /// Wait for Abort
+      /// \anchor xbmc_Monitor_waitForAbort
       ///
       /// Block until abort is requested, or until timeout occurs. If an
       /// abort requested have already been made, return immediately.
@@ -272,6 +273,17 @@ namespace XBMCAddon
       ///-----------------------------------------------------------------------
       /// @python_v14 New function added.
       ///
+      /// **Example:**
+      /// ~~~~~~~~~~~~~{.py}
+      /// ..
+      /// monitor = xbmc.Monitor()
+      /// # do something
+      /// monitor.waitForAbort(10) # sleeps for 10 secs or returns early if kodi aborts
+      /// if monitor.abortRequested():
+      ///     # abort was requested to Kodi (e.g. shutdown), do your cleanup logic
+      /// ..
+      /// ~~~~~~~~~~~~~
+      ///
       waitForAbort(...);
 #else
       bool waitForAbort(double timeout = -1);
