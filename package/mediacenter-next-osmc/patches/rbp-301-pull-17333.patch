From 0db40fda7b5d9aabc9dfbce1ca54b449c80e160b Mon Sep 17 00:00:00 2001
From: Lukas Rusak <lorusak@gmail.com>
Date: Mon, 10 Jun 2019 21:51:37 -0700
Subject: [PATCH] cmake: move iso9660 from cdio to iso9660pp

---
 cmake/modules/FindCdio.cmake      | 38 ++++++++-----------------------
 cmake/modules/FindIso9660pp.cmake | 15 ++++++++----
 2 files changed, 20 insertions(+), 33 deletions(-)

diff --git a/cmake/modules/FindCdio.cmake b/cmake/modules/FindCdio.cmake
index 91ba7bc59189..465ecc69f96f 100644
--- a/cmake/modules/FindCdio.cmake
+++ b/cmake/modules/FindCdio.cmake
@@ -8,47 +8,27 @@
 # CDIO_FOUND - system has cdio
 # CDIO_INCLUDE_DIRS - the cdio include directory
 # CDIO_LIBRARIES - the cdio libraries
-#
-# and the following imported targets::
-#
-#   CDIO::CDIO - The cdio library
 
 if(PKG_CONFIG_FOUND)
-  pkg_check_modules(PC_CDIO libcdio>=0.78 libiso9660 QUIET)
+  pkg_check_modules(PC_CDIO libcdio>=0.80 QUIET)
 endif()
 
 find_path(CDIO_INCLUDE_DIR NAMES cdio/cdio.h
-                           PATHS ${PC_CDIO_libcdio_INCLUDEDIR}
-                                 ${PC_CDIO_libiso9660_INCLUDEDIR})
-find_library(CDIO_LIBRARY NAMES cdio libcdio
-                          PATHS ${CDIO_libcdio_LIBDIR} ${CDIO_libiso9660_LIBDIR})
+                           PATHS ${PC_CDIO_INCLUDEDIR})
 
-if(NOT WIN32)
-  find_path(ISO9660_INCLUDE_DIR NAMES cdio/iso9660.h
-                                PATHS ${PC_CDIO_libcdio_INCLUDEDIR}
-                                      ${PC_CDIO_libiso9660_INCLUDEDIR})
-  find_library(ISO9660_LIBRARY NAMES iso9660
-                               PATHS ${CDIO_libcdio_LIBDIR} ${CDIO_libiso9660_LIBDIR})
-  list(APPEND ISO9660_VARS ISO9660_INCLUDE_DIR ISO9660_LIBRARY)
-endif()
+find_library(CDIO_LIBRARY NAMES cdio libcdio
+                          PATHS ${PC_CDIO_LIBDIR})
 
-set(CDIO_VERSION ${PC_CDIO_libcdio_VERSION})
+set(CDIO_VERSION ${PC_CDIO_VERSION})
 
 include(FindPackageHandleStandardArgs)
 find_package_handle_standard_args(Cdio
-                                  REQUIRED_VARS CDIO_LIBRARY CDIO_INCLUDE_DIR ${ISO9660_VARS}
+                                  REQUIRED_VARS CDIO_LIBRARY CDIO_INCLUDE_DIR
                                   VERSION_VAR CDIO_VERSION)
 
 if(CDIO_FOUND)
-  set(CDIO_LIBRARIES ${CDIO_LIBRARY} ${ISO9660_LIBRARY})
-  set(CDIO_INCLUDE_DIRS ${CDIO_INCLUDE_DIR} ${ISO9660_INCLUDE_DIR})
-
-  if(NOT TARGET CDIO::CDIO)
-    add_library(CDIO::CDIO UNKNOWN IMPORTED)
-    set_target_properties(CDIO::CDIO PROPERTIES
-                                     IMPORTED_LOCATION "${CDIO_LIBRARY}"
-                                     INTERFACE_INCLUDE_DIRECTORIES "${CDIO_INCLUDE_DIR}")
-  endif()
+  set(CDIO_LIBRARIES ${CDIO_LIBRARY})
+  set(CDIO_INCLUDE_DIRS ${CDIO_INCLUDE_DIR})
 endif()
 
-mark_as_advanced(CDIO_INCLUDE_DIR CDIO_LIBRARY ISO9660_INCLUDE_DIR ISO9660_LIBRARY)
+mark_as_advanced(CDIO_INCLUDE_DIR CDIO_LIBRARY)
diff --git a/cmake/modules/FindIso9660pp.cmake b/cmake/modules/FindIso9660pp.cmake
index 4c553c7d099a..5f84b559fe96 100644
--- a/cmake/modules/FindIso9660pp.cmake
+++ b/cmake/modules/FindIso9660pp.cmake
@@ -12,6 +12,7 @@
 
 if(PKG_CONFIG_FOUND)
   pkg_check_modules(PC_ISO9660PP libiso9660++>=2.1.0 QUIET)
+  pkg_check_modules(PC_ISO9660 libiso9660>=2.1.0 QUIET)
 endif()
 
 find_path(ISO9660PP_INCLUDE_DIR NAMES cdio++/iso9660.hpp
@@ -20,17 +21,23 @@ find_path(ISO9660PP_INCLUDE_DIR NAMES cdio++/iso9660.hpp
 find_library(ISO9660PP_LIBRARY NAMES libiso9660++ iso9660++
                                PATHS ${PC_ISO9660PP_LIBDIR})
 
+find_path(ISO9660_INCLUDE_DIR NAMES cdio/iso9660.h
+                              PATHS ${PC_ISO9660_INCLUDEDIR})
+
+find_library(ISO9660_LIBRARY NAMES libiso9660 iso9660
+                             PATHS ${PC_ISO9660_LIBDIR})
+
 set(ISO9660PP_VERSION ${PC_ISO9660PP_VERSION})
 
 include(FindPackageHandleStandardArgs)
 find_package_handle_standard_args(Iso9660pp
-                                  REQUIRED_VARS ISO9660PP_INCLUDE_DIR ISO9660PP_LIBRARY
+                                  REQUIRED_VARS ISO9660PP_LIBRARY ISO9660PP_INCLUDE_DIR ISO9660_LIBRARY ISO9660_INCLUDE_DIR
                                   VERSION_VAR ISO9660PP_VERSION)
 
 if(ISO9660PP_FOUND)
-  set(ISO9660PP_LIBRARIES ${ISO9660PP_LIBRARY})
-  set(ISO9660PP_INCLUDE_DIRS ${ISO9660PP_INCLUDE_DIR})
+  set(ISO9660PP_LIBRARIES ${ISO9660PP_LIBRARY} ${ISO9660_LIBRARY})
+  set(ISO9660PP_INCLUDE_DIRS ${ISO9660PP_INCLUDE_DIR} ${ISO9660_INCLUDE_DIR})
   set(ISO9660PP_DEFINITIONS -DHAS_ISO9660PP=1)
 endif()
 
-mark_as_advanced(ISO9660PP_INCLUDE_DIR ISO9660PP_LIBRARY)
+mark_as_advanced(ISO9660PP_INCLUDE_DIR ISO9660PP_LIBRARY ISO9660_INCLUDE_DIR ISO9660_LIBRARY)
