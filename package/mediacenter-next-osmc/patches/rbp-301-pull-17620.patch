From 31ccf1140ecee558b20573f9ca9881f096120f0a Mon Sep 17 00:00:00 2001
From: phunkyfish <phunkyfish@gmail.com>
Date: Sun, 5 Apr 2020 20:04:38 +0100
Subject: [PATCH 1/4] [inputstream] remove unused functions CanPauseStream and
 CanSeekStream from API

---
 .../include/kodi/addon-instance/Inputstream.h | 33 -------------------
 1 file changed, 33 deletions(-)

diff --git a/xbmc/addons/kodi-addon-dev-kit/include/kodi/addon-instance/Inputstream.h b/xbmc/addons/kodi-addon-dev-kit/include/kodi/addon-instance/Inputstream.h
index a32e289c38f2..09e2a8ca7b02 100644
--- a/xbmc/addons/kodi-addon-dev-kit/include/kodi/addon-instance/Inputstream.h
+++ b/xbmc/addons/kodi-addon-dev-kit/include/kodi/addon-instance/Inputstream.h
@@ -349,10 +349,6 @@ extern "C"
     // IPosTime
     bool(__cdecl* pos_time)(const AddonInstance_InputStream* instance, int ms);
 
-    // Seekable (mandatory)
-    bool(__cdecl* can_pause_stream)(const AddonInstance_InputStream* instance);
-    bool(__cdecl* can_seek_stream)(const AddonInstance_InputStream* instance);
-
     int(__cdecl* read_stream)(const AddonInstance_InputStream* instance,
                               uint8_t* buffer,
                               unsigned int bufferSize);
@@ -565,20 +561,6 @@ class CInstanceInputStream : public IAddonInstance
   */
   virtual bool SeekChapter(int ch) { return false; };
 
-  /*!
-     * Check if the backend support pausing the currently playing stream
-     * This will enable/disable the pause button in Kodi based on the return value
-     * @return false if the InputStream addon/backend does not support pausing, true if possible
-     */
-  virtual bool CanPauseStream() { return false; }
-
-  /*!
-     * Check if the backend supports seeking for the currently playing stream
-     * This will enable/disable the rewind/forward buttons in Kodi based on the return value
-     * @return false if the InputStream addon/backend does not support seeking, true if possible
-     */
-  virtual bool CanSeekStream() { return false; }
-
   /*!
      * Read from an open stream.
      * @param buffer The buffer to store the data in.
@@ -699,9 +681,6 @@ class CInstanceInputStream : public IAddonInstance
     m_instanceData->toAddon.get_times = ADDON_GetTimes;
     m_instanceData->toAddon.pos_time = ADDON_PosTime;
 
-    m_instanceData->toAddon.can_pause_stream = ADDON_CanPauseStream;
-    m_instanceData->toAddon.can_seek_stream = ADDON_CanSeekStream;
-
     m_instanceData->toAddon.read_stream = ADDON_ReadStream;
     m_instanceData->toAddon.seek_stream = ADDON_SeekStream;
     m_instanceData->toAddon.position_stream = ADDON_PositionStream;
@@ -862,18 +841,6 @@ class CInstanceInputStream : public IAddonInstance
     return static_cast<CInstanceInputStream*>(instance->toAddon.addonInstance)->SeekChapter(ch);
   }
 
-  // Seekable (mandatory)
-  inline static bool ADDON_CanPauseStream(const AddonInstance_InputStream* instance)
-  {
-    return static_cast<CInstanceInputStream*>(instance->toAddon.addonInstance)->CanPauseStream();
-  }
-
-  inline static bool ADDON_CanSeekStream(const AddonInstance_InputStream* instance)
-  {
-    return static_cast<CInstanceInputStream*>(instance->toAddon.addonInstance)->CanSeekStream();
-  }
-
-
   inline static int ADDON_ReadStream(const AddonInstance_InputStream* instance,
                                      uint8_t* buffer,
                                      unsigned int bufferSize)

From 999508d48afe890a8d83b6634d3e0c7e9ba0d7f7 Mon Sep 17 00:00:00 2001
From: phunkyfish <phunkyfish@gmail.com>
Date: Tue, 7 Apr 2020 22:05:09 +0100
Subject: [PATCH 2/4] [inputstream] Update comment on PauseStream() to clarify
 purpose

---
 .../include/kodi/addon-instance/Inputstream.h                 | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/xbmc/addons/kodi-addon-dev-kit/include/kodi/addon-instance/Inputstream.h b/xbmc/addons/kodi-addon-dev-kit/include/kodi/addon-instance/Inputstream.h
index 09e2a8ca7b02..3127243659eb 100644
--- a/xbmc/addons/kodi-addon-dev-kit/include/kodi/addon-instance/Inputstream.h
+++ b/xbmc/addons/kodi-addon-dev-kit/include/kodi/addon-instance/Inputstream.h
@@ -598,7 +598,9 @@ class CInstanceInputStream : public IAddonInstance
   virtual int GetBlockSize() { return 0; }
 
   /*!
-     * @brief Notify the InputStream addon that Kodi (un)paused the currently playing stream
+     * @brief Notify the InputStream addon that Kodi (un)paused the currently playing stream.
+     * Only called when an inpustream DOES NOT have its own demuxer.
+     * @param time The time that Kodi (un)paused the stream
      */
   virtual void PauseStream(double time) {}
 

From a8a214484fcb2e827b9da32194d8757b37fce3ab Mon Sep 17 00:00:00 2001
From: phunkyfish <phunkyfish@gmail.com>
Date: Tue, 7 Apr 2020 22:05:51 +0100
Subject: [PATCH 3/4] [inputstream] increase max stream properties to 30

---
 .../include/kodi/addon-instance/Inputstream.h                   | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/xbmc/addons/kodi-addon-dev-kit/include/kodi/addon-instance/Inputstream.h b/xbmc/addons/kodi-addon-dev-kit/include/kodi/addon-instance/Inputstream.h
index 3127243659eb..fac16db9e5d8 100644
--- a/xbmc/addons/kodi-addon-dev-kit/include/kodi/addon-instance/Inputstream.h
+++ b/xbmc/addons/kodi-addon-dev-kit/include/kodi/addon-instance/Inputstream.h
@@ -69,7 +69,7 @@ extern "C"
    */
   struct INPUTSTREAM
   {
-    static const unsigned int MAX_INFO_COUNT = 8;
+    static const unsigned int MAX_INFO_COUNT = 30;
 
     const char* m_strURL;
 

From f9e86b095768f4744347d41c45acb354396d5f56 Mon Sep 17 00:00:00 2001
From: phunkyfish <phunkyfish@gmail.com>
Date: Tue, 7 Apr 2020 22:06:27 +0100
Subject: [PATCH 4/4] [inputstream] bump API to v2.1.0

---
 xbmc/addons/kodi-addon-dev-kit/include/kodi/versions.h | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/xbmc/addons/kodi-addon-dev-kit/include/kodi/versions.h b/xbmc/addons/kodi-addon-dev-kit/include/kodi/versions.h
index 66601b0aa81a..e2c36f4c2c89 100644
--- a/xbmc/addons/kodi-addon-dev-kit/include/kodi/versions.h
+++ b/xbmc/addons/kodi-addon-dev-kit/include/kodi/versions.h
@@ -85,8 +85,8 @@
 #define ADDON_INSTANCE_VERSION_IMAGEDECODER_XML_ID    "kodi.binary.instance.imagedecoder"
 #define ADDON_INSTANCE_VERSION_IMAGEDECODER_DEPENDS   "addon-instance/ImageDecoder.h"
 
-#define ADDON_INSTANCE_VERSION_INPUTSTREAM            "2.0.12"
-#define ADDON_INSTANCE_VERSION_INPUTSTREAM_MIN        "2.0.7"
+#define ADDON_INSTANCE_VERSION_INPUTSTREAM            "2.1.0"
+#define ADDON_INSTANCE_VERSION_INPUTSTREAM_MIN        "2.1.0"
 #define ADDON_INSTANCE_VERSION_INPUTSTREAM_XML_ID     "kodi.binary.instance.inputstream"
 #define ADDON_INSTANCE_VERSION_INPUTSTREAM_DEPENDS    "addon-instance/Inputstream.h"
 
