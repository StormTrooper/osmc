From e2e54531dc0203844b59b656062fb0ae9100388a Mon Sep 17 00:00:00 2001
From: ronie <ronie@kodi.tv>
Date: Thu, 16 May 2019 21:24:13 +0200
Subject: [PATCH] [guilib] add ListItem.FileNameNoExtension infolabel

---
 xbmc/GUIInfoManager.cpp             | 15 +++++++++++++++
 xbmc/guilib/guiinfo/GUIInfoLabels.h |  1 +
 2 files changed, 16 insertions(+)

diff --git a/xbmc/GUIInfoManager.cpp b/xbmc/GUIInfoManager.cpp
index bc533ac54bd7..38e767924907 100644
--- a/xbmc/GUIInfoManager.cpp
+++ b/xbmc/GUIInfoManager.cpp
@@ -4620,6 +4620,15 @@ const infomap container_str[]  = {{ "property",         CONTAINER_PROPERTY },
 ///     item in a container.
 ///     <p>
 ///   }
+///   \table_row3{   <b>`ListItem.FileNameNoExtension`</b>,
+///                  \anchor ListItem_FileName_No_Extension
+///                  _string_,
+///     @return The filename without extension of the currently selected
+///     item in a container.
+///     <p><hr>
+///     @skinning_v19 **[New Infolabel]** \link ListItem_FileName_No_Extension `ListItem.FileNameNoExtension`\endlink
+///     <p>
+///   }
 ///   \table_row3{   <b>`ListItem.Date`</b>,
 ///                  \anchor ListItem_Date
 ///                  _string_,
@@ -5700,6 +5709,7 @@ const infomap listitem_labels[]= {{ "thumb",            LISTITEM_THUMB },
                                   { "filename",         LISTITEM_FILENAME },
                                   { "filenameandpath",  LISTITEM_FILENAME_AND_PATH },
                                   { "fileextension",    LISTITEM_FILE_EXTENSION },
+                                  { "filenamenoextension",  LISTITEM_FILENAME_NO_EXTENSION },
                                   { "date",             LISTITEM_DATE },
                                   { "datetime",         LISTITEM_DATETIME },
                                   { "size",             LISTITEM_SIZE },
@@ -9720,6 +9730,7 @@ std::string CGUIInfoManager::GetMultiInfoItemLabel(const CFileItem *item, int co
         return item->GetLabel2();
       case LISTITEM_FILENAME:
       case LISTITEM_FILE_EXTENSION:
+      case LISTITEM_FILENAME_NO_EXTENSION:
       {
         std::string strFile = URIUtils::GetFileName(item->GetPath());
         if (info.m_info == LISTITEM_FILE_EXTENSION)
@@ -9727,6 +9738,10 @@ std::string CGUIInfoManager::GetMultiInfoItemLabel(const CFileItem *item, int co
           std::string strExtension = URIUtils::GetExtension(strFile);
           return StringUtils::TrimLeft(strExtension, ".");
         }
+        else if (info.m_info == LISTITEM_FILENAME_NO_EXTENSION)
+        {
+          URIUtils::RemoveExtension(strFile);
+        }
         return strFile;
       }
       case LISTITEM_DATE:
diff --git a/xbmc/guilib/guiinfo/GUIInfoLabels.h b/xbmc/guilib/guiinfo/GUIInfoLabels.h
index d5c906b89c44..233b315edc71 100644
--- a/xbmc/guilib/guiinfo/GUIInfoLabels.h
+++ b/xbmc/guilib/guiinfo/GUIInfoLabels.h
@@ -872,6 +872,7 @@
 #define LISTITEM_HASREMINDERRULE    (LISTITEM_START + 184)
 #define LISTITEM_HASARCHIVE         (LISTITEM_START + 185)
 #define LISTITEM_ISPLAYABLE         (LISTITEM_START + 186)
+#define LISTITEM_FILENAME_NO_EXTENSION (LISTITEM_START + 187)
 
 #define LISTITEM_END                (LISTITEM_START + 2500)
 
