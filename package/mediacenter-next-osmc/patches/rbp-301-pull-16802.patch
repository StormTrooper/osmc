From 6d34db9900aebb5b839f9b9279a851f120e74ad6 Mon Sep 17 00:00:00 2001
From: Kostas Andrianos <gusandrianos@gmail.com>
Date: Thu, 31 Oct 2019 20:18:12 +0200
Subject: [PATCH] Always highlight the OK button when installing an add-on

---
 xbmc/addons/GUIDialogAddonInfo.cpp | 1 +
 xbmc/dialogs/GUIDialogSelect.cpp   | 8 +++++++-
 xbmc/dialogs/GUIDialogSelect.h     | 2 ++
 3 files changed, 10 insertions(+), 1 deletion(-)

diff --git a/xbmc/addons/GUIDialogAddonInfo.cpp b/xbmc/addons/GUIDialogAddonInfo.cpp
index 818fc87fcd2b..8b5643e68a60 100644
--- a/xbmc/addons/GUIDialogAddonInfo.cpp
+++ b/xbmc/addons/GUIDialogAddonInfo.cpp
@@ -518,6 +518,7 @@ bool CGUIDialogAddonInfo::ShowDependencyList(const std::vector<ADDON::Dependency
     for (auto& it : items)
       pDialog->Add(*it);
     pDialog->EnableButton(!reactivate, 186);
+    pDialog->SetButtonFocus(true);
     pDialog->Open();
 
     if (pDialog->IsButtonPressed())
diff --git a/xbmc/dialogs/GUIDialogSelect.cpp b/xbmc/dialogs/GUIDialogSelect.cpp
index 8e32c852e76d..db5e3b9df0bc 100644
--- a/xbmc/dialogs/GUIDialogSelect.cpp
+++ b/xbmc/dialogs/GUIDialogSelect.cpp
@@ -126,7 +126,7 @@ bool CGUIDialogSelect::OnMessage(CGUIMessage& message)
     {
       if (m_viewControl.HasControl(message.GetControlId()))
       {
-        if (m_vecList->IsEmpty())
+        if (m_vecList->IsEmpty() || m_focusToButton)
         {
           if (m_bButtonEnabled)
             SET_CONTROL_FOCUS(CONTROL_EXTRA_BUTTON, 0);
@@ -168,6 +168,7 @@ void CGUIDialogSelect::Reset()
   m_bButtonPressed = false;
   m_useDetails = false;
   m_multiSelection = false;
+  m_focusToButton = false;
   m_selectedItem = nullptr;
   m_vecList->Clear();
   m_selectedItems.clear();
@@ -279,6 +280,11 @@ void CGUIDialogSelect::SetMultiSelection(bool multiSelection)
   m_multiSelection = multiSelection;
 }
 
+void CGUIDialogSelect::SetButtonFocus(bool buttonFocus)
+{
+  m_focusToButton = buttonFocus;
+}
+
 CGUIControl *CGUIDialogSelect::GetFirstFocusableControl(int id)
 {
   if (m_viewControl.HasControl(id))
diff --git a/xbmc/dialogs/GUIDialogSelect.h b/xbmc/dialogs/GUIDialogSelect.h
index ed9572e1ae8f..d381c6bda190 100644
--- a/xbmc/dialogs/GUIDialogSelect.h
+++ b/xbmc/dialogs/GUIDialogSelect.h
@@ -41,6 +41,7 @@ class CGUIDialogSelect : public CGUIDialogBoxBase
   void SetSelected(const std::vector<std::string> &selectedLabels);
   void SetUseDetails(bool useDetails);
   void SetMultiSelection(bool multiSelection);
+  void SetButtonFocus(bool buttonFocus);
 
 protected:
   explicit CGUIDialogSelect(int windowid);
@@ -59,6 +60,7 @@ class CGUIDialogSelect : public CGUIDialogBoxBase
   CFileItemPtr m_selectedItem;
   bool m_useDetails;
   bool m_multiSelection;
+  bool m_focusToButton{};
 
   std::vector<int> m_selectedItems;
   std::unique_ptr<CFileItemList> m_vecList;
