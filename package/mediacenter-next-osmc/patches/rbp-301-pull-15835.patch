From 96563ff81584b08983e0f2d06ffe62fc11893570 Mon Sep 17 00:00:00 2001
From: James Hutchinson <jahutchinson99@googlemail.com>
Date: Fri, 29 Mar 2019 08:30:34 +0000
Subject: [PATCH] [AMLCodec] dont poll decoder rate when seeking

---
 xbmc/cores/VideoPlayer/DVDCodecs/Video/AMLCodec.cpp | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/xbmc/cores/VideoPlayer/DVDCodecs/Video/AMLCodec.cpp b/xbmc/cores/VideoPlayer/DVDCodecs/Video/AMLCodec.cpp
index 8e199b478a76..0a5c03ca299f 100644
--- a/xbmc/cores/VideoPlayer/DVDCodecs/Video/AMLCodec.cpp
+++ b/xbmc/cores/VideoPlayer/DVDCodecs/Video/AMLCodec.cpp
@@ -2405,7 +2405,13 @@ void CAMLCodec::SetVideoRate(int videoRate)
 
 unsigned int CAMLCodec::GetDecoderVideoRate()
 {
+  if (m_speed != DVD_PLAYSPEED_NORMAL || m_pollDevice < 0)
+    return 0;
+
   struct vdec_status vs;
   m_dll->codec_get_vdec_state(&am_private->vcodec, &vs);
-  return static_cast<unsigned int>(0.5 + (static_cast<float>(UNIT_FREQ) / static_cast<float>(vs.fps)));
+  if (vs.fps > 0)
+    return static_cast<unsigned int>(0.5 + (static_cast<float>(UNIT_FREQ) / static_cast<float>(vs.fps)));
+  else
+    return 0;
 }
