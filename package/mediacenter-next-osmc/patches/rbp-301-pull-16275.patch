From 58abbb6a2eec3d9106ad528a6485011198df4856 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Thu, 13 Jun 2019 14:22:31 +0200
Subject: [PATCH 01/23] [depends] refresh boblight patches

---
 .../target/boblight/01-fix_fpermissive.patch  |  4 +-
 .../target/boblight/02-fixandroid.patch       | 34 ++++++-------
 .../depends/target/boblight/03-fixtvos.patch  | 51 +++++++++----------
 tools/depends/target/boblight/Makefile        |  6 +--
 4 files changed, 46 insertions(+), 49 deletions(-)

diff --git a/tools/depends/target/boblight/01-fix_fpermissive.patch b/tools/depends/target/boblight/01-fix_fpermissive.patch
index 29727a67bb79..aab47886200c 100644
--- a/tools/depends/target/boblight/01-fix_fpermissive.patch
+++ b/tools/depends/target/boblight/01-fix_fpermissive.patch
@@ -1,5 +1,5 @@
---- src/util/miscorig.cpp	2014-11-27 18:31:54.778680630 +0000
-+++ src/util/misc.cpp	2014-11-27 18:32:21.986680437 +0000
+--- a/src/util/misc.cpp
++++ b/src/util/misc.cpp
 @@ -64,7 +64,7 @@
  //convert . or , to the current locale for correct conversion of ascii float
  void ConvertFloatLocale(std::string& strfloat)
diff --git a/tools/depends/target/boblight/02-fixandroid.patch b/tools/depends/target/boblight/02-fixandroid.patch
index 8ce63e5b12a8..ff4b5b107777 100644
--- a/tools/depends/target/boblight/02-fixandroid.patch
+++ b/tools/depends/target/boblight/02-fixandroid.patch
@@ -1,20 +1,5 @@
---- src/util/daemonizeorig.cpp	2014-11-27 18:36:30.474678137 +0000
-+++ src/util/daemonize.cpp	2014-11-27 18:36:44.226678082 +0000
-@@ -35,10 +35,12 @@
-   if (setsid() < 0)
-     fprintf(stderr, "setsid(): %s", GetErrno().c_str());
- 
-+#if !defined(__ANDROID__)
-   //route stdout and stderr to /dev/null
-   fclose(stdout);
-   stdout = fopen("/dev/null", "w");
-   fclose(stderr);
-   stderr = fopen("/dev/null", "w");
-+#endif
- }
- 
---- src/lib/boblightorig.h	2014-11-27 18:38:37.174677063 +0000
-+++ src/lib/boblight.h	2014-11-27 18:40:14.810676123 +0000
+--- a/src/lib/boblight.h
++++ b/src/lib/boblight.h
 @@ -61,7 +61,7 @@
      //gets a functionpointer from dlsym, and returns char* from dlerror if it didn't work
      #define BOBLIGHT_FUNCTION(returnvalue, name, arguments) \
@@ -33,3 +18,18 @@
  
        //generate dlsym lines
        #include "boblight-functions.h"
+--- a/src/util/daemonize.cpp
++++ b/src/util/daemonize.cpp
+@@ -35,10 +35,12 @@
+   if (setsid() < 0)
+     fprintf(stderr, "setsid(): %s", GetErrno().c_str());
+ 
++#if !defined(__ANDROID__)
+   //route stdout and stderr to /dev/null
+   fclose(stdout);
+   stdout = fopen("/dev/null", "w");
+   fclose(stderr);
+   stderr = fopen("/dev/null", "w");
++#endif
+ }
+ 
diff --git a/tools/depends/target/boblight/03-fixtvos.patch b/tools/depends/target/boblight/03-fixtvos.patch
index 646abeab9e41..13f8025568c1 100644
--- a/tools/depends/target/boblight/03-fixtvos.patch
+++ b/tools/depends/target/boblight/03-fixtvos.patch
@@ -1,30 +1,5 @@
-diff -uPr appletvos9.0_arm64-target/src/util/daemonize.cpp works/src/util/daemonize.cpp
---- src/util/daemonize.cpp	2015-12-18 18:20:26.000000000 +0100
-+++ src/util/daemonize.cpp	2015-12-13 16:15:19.000000000 +0100
-@@ -25,7 +25,7 @@
- void Daemonize()
- {
-   //fork a child process
--  pid_t pid = fork();
-+  pid_t pid = -1;//fork();
-   if (pid == -1)
-     fprintf(stderr, "fork(): %s", GetErrno().c_str());
-   else if (pid > 0)
-diff -uPr appletvos9.0_arm64-target/src/util/tcpsocket.cpp works/src/util/tcpsocket.cpp
---- src/util/tcpsocket.cpp	2014-11-27 19:26:33.000000000 +0100
-+++ src/util/tcpsocket.cpp	2015-12-18 18:19:24.000000000 +0100
-@@ -31,8 +31,6 @@
- #include "tcpsocket.h"
- #include "misc.h"
- 
--using namespace std;
--
- void CTcpData::SetData(uint8_t* data, int size, bool append)
- {
-   CopyData(reinterpret_cast<char*>(data), size, append);
-diff -uPr appletvos9.0_arm64-target/src/device/deviceltbl.cpp works/src/device/deviceltbl.cpp
---- src/device/deviceltbl.cpp	2014-11-27 19:26:33.000000000 +0100
-+++ src/device/deviceltbl.cpp	2015-12-13 16:14:49.000000000 +0100
+--- a/src/device/deviceltbl.cpp
++++ b/src/device/deviceltbl.cpp
 @@ -51,7 +51,7 @@
  
  bool CDeviceLtbl::WriteOutput()
@@ -43,3 +18,25 @@ diff -uPr appletvos9.0_arm64-target/src/device/deviceltbl.cpp works/src/device/d
  
    if (m_isopened)
      return true; //nothing to do here
+--- a/src/util/daemonize.cpp
++++ b/src/util/daemonize.cpp
+@@ -25,7 +25,7 @@
+ void Daemonize()
+ {
+   //fork a child process
+-  pid_t pid = fork();
++  pid_t pid = -1;//fork();
+   if (pid == -1)
+     fprintf(stderr, "fork(): %s", GetErrno().c_str());
+   else if (pid > 0)
+--- a/src/util/tcpsocket.cpp
++++ b/src/util/tcpsocket.cpp
+@@ -31,8 +31,6 @@
+ #include "tcpsocket.h"
+ #include "misc.h"
+ 
+-using namespace std;
+-
+ void CTcpData::SetData(uint8_t* data, int size, bool append)
+ {
+   CopyData(reinterpret_cast<char*>(data), size, append);
diff --git a/tools/depends/target/boblight/Makefile b/tools/depends/target/boblight/Makefile
index 91d269bc2b03..e34ffcc21d60 100644
--- a/tools/depends/target/boblight/Makefile
+++ b/tools/depends/target/boblight/Makefile
@@ -26,12 +26,12 @@ $(TARBALLS_LOCATION)/$(ARCHIVE):
 $(PLATFORM): $(TARBALLS_LOCATION)/$(ARCHIVE) $(DEPS)
 	rm -rf $(PLATFORM)/*; mkdir -p $(PLATFORM)
 	cd $(PLATFORM); $(ARCHIVE_TOOL) $(ARCHIVE_TOOL_FLAGS) $(TARBALLS_LOCATION)/$(ARCHIVE)
-	cd $(PLATFORM); patch -p0 < ../01-fix_fpermissive.patch
-	cd $(PLATFORM); patch -p0 < ../02-fixandroid.patch
+	cd $(PLATFORM); patch -p1 -i ../01-fix_fpermissive.patch
+	cd $(PLATFORM); patch -p1 -i ../02-fixandroid.patch
 	cd $(PLATFORM); autoreconf -vif
 	cd $(PLATFORM); $(CONFIGURE)
 ifeq ($(CPU),arm64)
-	cd $(PLATFORM); patch -p0 < ../03-fixtvos.patch
+	cd $(PLATFORM); patch -p1 -i ../03-fixtvos.patch
 	cd $(PLATFORM); sed -ie "s|-bind_at_load||" ./libtool
 	cd $(PLATFORM); sed -ie "s|-bind_at_load||" ./ltmain.sh
 endif

From a0280e5fcdd0e545e22bb44f194a35e32f3a70b5 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Thu, 13 Jun 2019 14:22:31 +0200
Subject: [PATCH 02/23] [depends] refresh bzip2 patches

---
 tools/depends/target/bzip2/Makefile       | 2 +-
 tools/depends/target/bzip2/Makefile.patch | 4 ++--
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/tools/depends/target/bzip2/Makefile b/tools/depends/target/bzip2/Makefile
index cf298aabb331..3541d3831cac 100644
--- a/tools/depends/target/bzip2/Makefile
+++ b/tools/depends/target/bzip2/Makefile
@@ -20,7 +20,7 @@ $(TARBALLS_LOCATION)/$(ARCHIVE):
 $(PLATFORM): $(TARBALLS_LOCATION)/$(ARCHIVE) $(DEPS)
 	rm -rf $(PLATFORM)/*; mkdir -p $(PLATFORM)
 	cd $(PLATFORM); $(ARCHIVE_TOOL) $(ARCHIVE_TOOL_FLAGS) $(TARBALLS_LOCATION)/$(ARCHIVE)
-	cd $(PLATFORM); patch -p1 <../Makefile.patch
+	cd $(PLATFORM); patch -p1 -i ../Makefile.patch
 
 $(LIBDYLIB): $(PLATFORM)
 	$(MAKE) -C $(PLATFORM) PREFIX=$(PREFIX) CC="$(CC)" CFLAGS="$(CFLAGS)" LDFLAGS="$(LDFLAGS)" AR="$(AR)"
diff --git a/tools/depends/target/bzip2/Makefile.patch b/tools/depends/target/bzip2/Makefile.patch
index 40dc70a2c275..5f65b0c8ae4d 100644
--- a/tools/depends/target/bzip2/Makefile.patch
+++ b/tools/depends/target/bzip2/Makefile.patch
@@ -1,5 +1,5 @@
---- Makefile	2008-02-14 14:39:18.000000000 +0200
-+++ ../Makefile	2009-08-30 15:59:16.000000000 +0300
+--- a/Makefile
++++ b/Makefile
 @@ -15,16 +15,16 @@
  SHELL=/bin/sh
  

From 827bf79b289052efea7ced30edf0b2ffacbe0e0d Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Thu, 13 Jun 2019 14:22:31 +0200
Subject: [PATCH 03/23] [depends] refresh flatbuffers patches

---
 .../native/flatbuffers/0001-Fix-compiler-warning.patch   | 9 +--------
 tools/depends/native/flatbuffers/Makefile                | 2 +-
 tools/depends/target/flatbuffers/Makefile                | 2 +-
 3 files changed, 3 insertions(+), 10 deletions(-)

diff --git a/tools/depends/native/flatbuffers/0001-Fix-compiler-warning.patch b/tools/depends/native/flatbuffers/0001-Fix-compiler-warning.patch
index c8f8b1414c5c..e03827c5cf99 100644
--- a/tools/depends/native/flatbuffers/0001-Fix-compiler-warning.patch
+++ b/tools/depends/native/flatbuffers/0001-Fix-compiler-warning.patch
@@ -1,12 +1,6 @@
----
- include/flatbuffers/util.h | 2 +-
- 1 file changed, 1 insertion(+), 1 deletion(-)
-
-diff --git a/include/flatbuffers/util.h b/include/flatbuffers/util.h
-index e654010..7cadd0b 100644
 --- a/include/flatbuffers/util.h
 +++ b/include/flatbuffers/util.h
-@@ -321,7 +321,7 @@ inline int FromUTF8(const char **in) {
+@@ -321,7 +321,7 @@
        break;
      }
    }
@@ -15,4 +9,3 @@ index e654010..7cadd0b 100644
    if (!len) return *(*in)++;
    // UTF-8 encoded values with a length are between 2 and 4 bytes.
    if (len < 2 || len > 4) { return -1; }
--- 
diff --git a/tools/depends/native/flatbuffers/Makefile b/tools/depends/native/flatbuffers/Makefile
index 7c362e82cf02..e6ee991c4d86 100644
--- a/tools/depends/native/flatbuffers/Makefile
+++ b/tools/depends/native/flatbuffers/Makefile
@@ -42,7 +42,7 @@ $(TARBALLS_LOCATION)/$(ARCHIVE):
 $(PLATFORM): $(TARBALLS_LOCATION)/$(ARCHIVE) $(DEPS)
 	rm -rf $(PLATFORM)/*; mkdir -p $(PLATFORM)
 	cd $(PLATFORM); $(ARCHIVE_TOOL) $(ARCHIVE_TOOL_FLAGS) $(TARBALLS_LOCATION)/$(ARCHIVE)
-	cd $(PLATFORM); patch -p1 < ../0001-Fix-compiler-warning.patch
+	cd $(PLATFORM); patch -p1 -i ../0001-Fix-compiler-warning.patch
 	mkdir -p $(BUILDDIR)
 	cd $(BUILDDIR); $(CMAKE) $(CMAKE_OPTIONS) ..
 
diff --git a/tools/depends/target/flatbuffers/Makefile b/tools/depends/target/flatbuffers/Makefile
index 2f017e441f06..1fbd916ecb68 100644
--- a/tools/depends/target/flatbuffers/Makefile
+++ b/tools/depends/target/flatbuffers/Makefile
@@ -49,7 +49,7 @@ ifeq ($(PREFIX),)
 endif
 	rm -rf $(PLATFORM)/*; mkdir -p $(PLATFORM)
 	cd $(PLATFORM); $(ARCHIVE_TOOL) $(ARCHIVE_TOOL_FLAGS) $(TARBALLS_LOCATION)/$(ARCHIVE)
-	cd $(PLATFORM); patch -p1 < ../../../native/flatbuffers/0001-Fix-compiler-warning.patch
+	cd $(PLATFORM); patch -p1 -i ../../../native/flatbuffers/0001-Fix-compiler-warning.patch
 	mkdir -p $(BUILDDIR)
 	cd $(BUILDDIR); $(CMAKE) $(CMAKE_OPTIONS) ..
 

From ba3a7d59510858cf050b253594a4a5cde875f958 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Thu, 13 Jun 2019 14:22:31 +0200
Subject: [PATCH 04/23] [depends] refresh fontconfig patches

---
 tools/depends/target/fontconfig/Makefile                  | 4 ++--
 tools/depends/target/fontconfig/fix-aarch64_atomics.patch | 7 +++----
 2 files changed, 5 insertions(+), 6 deletions(-)

diff --git a/tools/depends/target/fontconfig/Makefile b/tools/depends/target/fontconfig/Makefile
index 8f4f8cba11ed..8c78399c08a4 100644
--- a/tools/depends/target/fontconfig/Makefile
+++ b/tools/depends/target/fontconfig/Makefile
@@ -22,8 +22,8 @@ $(TARBALLS_LOCATION)/$(ARCHIVE):
 $(PLATFORM): $(TARBALLS_LOCATION)/$(ARCHIVE) $(DEPS)
 	rm -rf $(PLATFORM)/*; mkdir -p $(PLATFORM)
 	cd $(PLATFORM); $(ARCHIVE_TOOL) $(ARCHIVE_TOOL_FLAGS) $(TARBALLS_LOCATION)/$(ARCHIVE)
-	cd $(PLATFORM); patch -p1 < ../lconv.patch
-	cd $(PLATFORM); patch -p1 < ../fix-aarch64_atomics.patch
+	cd $(PLATFORM); patch -p1 -i ../lconv.patch
+	cd $(PLATFORM); patch -p1 -i ../fix-aarch64_atomics.patch
 	cd $(PLATFORM); $(AUTORECONF) -vif
 	cd $(PLATFORM); $(CONFIGURE)
 
diff --git a/tools/depends/target/fontconfig/fix-aarch64_atomics.patch b/tools/depends/target/fontconfig/fix-aarch64_atomics.patch
index 1d95acda1663..67ec51deeb76 100644
--- a/tools/depends/target/fontconfig/fix-aarch64_atomics.patch
+++ b/tools/depends/target/fontconfig/fix-aarch64_atomics.patch
@@ -1,6 +1,6 @@
---- a/src/fcatomic.h-org	2015-10-31 21:15:56.000000000 -0400
-+++ b/src/fcatomic.h	2015-10-31 21:19:10.000000000 -0400
-@@ -70,18 +70,18 @@ typedef LONG fc_atomic_int_t;
+--- a/src/fcatomic.h
++++ b/src/fcatomic.h
+@@ -70,18 +70,18 @@
  #elif !defined(FC_NO_MT) && defined(__APPLE__)
  
  #include <libkern/OSAtomic.h>
@@ -23,4 +23,3 @@
  #else
  #if __ppc64__ || __x86_64__
  #define fc_atomic_ptr_cmpexch(P,O,N)	OSAtomicCompareAndSwap64Barrier ((int64_t) (O), (int64_t) (N), (int64_t*) (P))
-

From 11ba33fb2edf137498a0c364d73069ab3e1d35e5 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Thu, 13 Jun 2019 14:22:31 +0200
Subject: [PATCH 05/23] [depends] refresh gettext patches

---
 tools/depends/native/gettext/01-gettext-tools-stpncpy.patch | 4 ++--
 tools/depends/native/gettext/Makefile                       | 2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/tools/depends/native/gettext/01-gettext-tools-stpncpy.patch b/tools/depends/native/gettext/01-gettext-tools-stpncpy.patch
index e5f486931081..a7541bffd858 100644
--- a/tools/depends/native/gettext/01-gettext-tools-stpncpy.patch
+++ b/tools/depends/native/gettext/01-gettext-tools-stpncpy.patch
@@ -1,5 +1,5 @@
---- gettext-0.17.orig/gettext-tools/gnulib-lib/stpncpy.c       2010-05-24 05:42:47.000000000 -0400
-+++ gettext-0.17/gettext-tools/gnulib-lib/stpncpy.c    2013-01-18 00:46:43.000000000 -0500
+--- a/gettext-tools/gnulib-lib/stpncpy.c
++++ b/gettext-tools/gnulib-lib/stpncpy.c
 @@ -24,7 +24,7 @@
  /* Specification.  */
  #include <string.h>
diff --git a/tools/depends/native/gettext/Makefile b/tools/depends/native/gettext/Makefile
index 751ed55a80df..bc9beb235ecb 100644
--- a/tools/depends/native/gettext/Makefile
+++ b/tools/depends/native/gettext/Makefile
@@ -34,7 +34,7 @@ $(PLATFORM): $(TARBALLS_LOCATION)/$(ARCHIVE) $(DEPS)
 	cd $(PLATFORM); sed -ie '/gets is a security hole/d' gettext-tools/libgettextpo/stdio.in.h
 	cd $(PLATFORM); sed -ie '/gets is a security hole/d' gettext-runtime/gnulib-lib/stdio.in.h
 	cd $(PLATFORM); sed -ie 's/SUBDIRS = doc intl gnulib-lib libgrep src libgettextpo po projects styles misc man m4 tests gnulib-tests examples/SUBDIRS = doc intl gnulib-lib libgrep src libgettextpo po projects styles misc man m4/' gettext-tools/Makefile.in
-	cd $(PLATFORM); patch -p1 < ../01-gettext-tools-stpncpy.patch
+	cd $(PLATFORM); patch -p1 -i ../01-gettext-tools-stpncpy.patch
 	cd $(PLATFORM); $(CONFIGURE)
 
 $(LIBDYLIB): $(PLATFORM)

From 21c887401dfc0a5e0ba1343599db74196b1f5bb2 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Thu, 13 Jun 2019 14:22:31 +0200
Subject: [PATCH 06/23] [depends] refresh gnutls patches

---
 tools/depends/target/gnutls/Makefile       |  2 +-
 tools/depends/target/gnutls/size-max.patch | 13 ++++++-------
 2 files changed, 7 insertions(+), 8 deletions(-)

diff --git a/tools/depends/target/gnutls/Makefile b/tools/depends/target/gnutls/Makefile
index 5eb41e45e4d7..d5e7dbb99d38 100644
--- a/tools/depends/target/gnutls/Makefile
+++ b/tools/depends/target/gnutls/Makefile
@@ -30,7 +30,7 @@ $(TARBALLS_LOCATION)/$(ARCHIVE):
 $(PLATFORM): $(TARBALLS_LOCATION)/$(ARCHIVE) $(DEPS)
 	rm -rf $(PLATFORM)/*; mkdir -p $(PLATFORM)
 	cd $(PLATFORM); $(ARCHIVE_TOOL) $(ARCHIVE_TOOL_FLAGS) $(TARBALLS_LOCATION)/$(ARCHIVE)
-	cd $(PLATFORM); patch -p0 < ../size-max.patch
+	cd $(PLATFORM); patch -p1 -i ../size-max.patch
 	cd $(PLATFORM); patch -p1 -i ../02-darwin-getentropy.patch
 	cd $(PLATFORM); $(AUTORECONF) -vif
 	cd $(PLATFORM); $(CONFIGURE)
diff --git a/tools/depends/target/gnutls/size-max.patch b/tools/depends/target/gnutls/size-max.patch
index 4cd927bf37b7..fd4acfd9776a 100644
--- a/tools/depends/target/gnutls/size-max.patch
+++ b/tools/depends/target/gnutls/size-max.patch
@@ -1,16 +1,15 @@
---- gl/read-file.c.orig     2014-11-24 10:06:35.473877332 +0100
-+++ gl/read-file.c  2014-11-24 10:03:34.005876607 +0100
+--- a/gl/read-file.c
++++ b/gl/read-file.c
 @@ -27,6 +27,7 @@
-
+ 
  /* Get SIZE_MAX.  */
  #include <stdint.h>
 +#include <limits.h>
-
+ 
  /* Get malloc, realloc, free. */
  #include <stdlib.h>
-
---- src/gl/read-file.c.orig	2014-11-24 10:06:35.473877332 +0100
-+++ src/gl/read-file.c	2014-11-24 10:03:34.005876607 +0100
+--- a/src/gl/read-file.c
++++ b/src/gl/read-file.c
 @@ -27,6 +27,7 @@
  
  /* Get SIZE_MAX.  */

From 715c24f6385ebc426202db300923559502ce9391 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Thu, 13 Jun 2019 14:22:31 +0200
Subject: [PATCH 07/23] [depends] refresh libbluray patches

---
 tools/depends/target/libbluray/Makefile   | 2 +-
 tools/depends/target/libbluray/tvos.patch | 8 ++++----
 2 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/tools/depends/target/libbluray/Makefile b/tools/depends/target/libbluray/Makefile
index 11793a776910..776c3f73ed08 100644
--- a/tools/depends/target/libbluray/Makefile
+++ b/tools/depends/target/libbluray/Makefile
@@ -27,7 +27,7 @@ $(PLATFORM): $(TARBALLS_LOCATION)/$(ARCHIVE) $(DEPS)
 	cd $(PLATFORM); ./bootstrap
 	cd $(PLATFORM); $(CONFIGURE)
 ifeq ($(TARGET_PLATFORM),appletvos)
-	cd $(PLATFORM); patch -p0 < ../tvos.patch
+	cd $(PLATFORM); patch -p1 -i ../tvos.patch
 endif
 
 $(LIBDYLIB): $(PLATFORM)
diff --git a/tools/depends/target/libbluray/tvos.patch b/tools/depends/target/libbluray/tvos.patch
index 7e453c706468..0c464c7606a3 100644
--- a/tools/depends/target/libbluray/tvos.patch
+++ b/tools/depends/target/libbluray/tvos.patch
@@ -1,6 +1,6 @@
---- src/libbluray/bdj/bdj.c.orig	2017-06-24 22:13:02.000000000 +0200
-+++ src/libbluray/bdj/bdj.c	2017-06-24 22:13:37.000000000 +0200
-@@ -239,7 +239,7 @@
+--- a/src/libbluray/bdj/bdj.c
++++ b/src/libbluray/bdj/bdj.c
+@@ -245,7 +245,7 @@
          return NULL;
      }
  
@@ -9,7 +9,7 @@
      {
          case -1:
              BD_DEBUG(DBG_BDJ | DBG_CRIT, "vfork failed\n");
-@@ -271,7 +271,7 @@
+@@ -277,7 +277,7 @@
  
              waitpid(java_home_pid, &exitcode, 0);
      }

From 4a510ebf991b56c8279c82643e0dd53de90776f6 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Thu, 13 Jun 2019 14:22:31 +0200
Subject: [PATCH 08/23] [depends] refresh libcdio patches

---
 tools/depends/target/libcdio/Makefile        | 4 ++--
 tools/depends/target/libcdio/configure.patch | 8 ++++----
 tools/depends/target/libcdio/cross.patch     | 4 ++--
 3 files changed, 8 insertions(+), 8 deletions(-)

diff --git a/tools/depends/target/libcdio/Makefile b/tools/depends/target/libcdio/Makefile
index bb22816196f6..57da8e5d1db2 100644
--- a/tools/depends/target/libcdio/Makefile
+++ b/tools/depends/target/libcdio/Makefile
@@ -22,8 +22,8 @@ $(TARBALLS_LOCATION)/$(ARCHIVE):
 $(PLATFORM): $(TARBALLS_LOCATION)/$(ARCHIVE) $(DEPS)
 	rm -rf $(PLATFORM)/*; mkdir -p $(PLATFORM)
 	cd $(PLATFORM); $(ARCHIVE_TOOL) $(ARCHIVE_TOOL_FLAGS) $(TARBALLS_LOCATION)/$(ARCHIVE)
-	cd $(PLATFORM); patch -p0 < ../configure.patch
-	cd $(PLATFORM); patch -p0 < ../cross.patch
+	cd $(PLATFORM); patch -p1 -i ../configure.patch
+	cd $(PLATFORM); patch -p1 -i ../cross.patch
 	cd $(PLATFORM); $(AUTORECONF) -vif
 	cd $(PLATFORM); $(CONFIGURE)
 
diff --git a/tools/depends/target/libcdio/configure.patch b/tools/depends/target/libcdio/configure.patch
index a4110ef9cba1..b0f727453130 100644
--- a/tools/depends/target/libcdio/configure.patch
+++ b/tools/depends/target/libcdio/configure.patch
@@ -1,8 +1,8 @@
---- configure.ac	2012-05-27 15:06:13.044747493 -0400
-+++ configure.ac	2012-05-27 15:05:52.364747505 -0400
-@@ -378,7 +378,7 @@
+--- a/configure.ac
++++ b/configure.ac
+@@ -407,7 +407,7 @@
       ;;
-      linux*|uclinux)
+      linux*)
          AC_CHECK_HEADERS(linux/version.h linux/major.h)
 -        AC_CHECK_HEADERS(linux/cdrom.h, [have_linux_cdrom_h="yes"])
 +        AC_CHECK_HEADERS(linux/cdrom.h, [have_linux_cdrom_h="no"])
diff --git a/tools/depends/target/libcdio/cross.patch b/tools/depends/target/libcdio/cross.patch
index d5e17cecda23..e1e564bfdd65 100644
--- a/tools/depends/target/libcdio/cross.patch
+++ b/tools/depends/target/libcdio/cross.patch
@@ -1,5 +1,5 @@
---- configure.ac	2013-03-10 19:25:36.396466337 -0400
-+++ configure.ac	2013-03-10 19:24:34.906466376 -0400
+--- a/configure.ac
++++ b/configure.ac
 @@ -269,37 +269,6 @@
  fi
  dnl empty_array_size

From 011902cde3eca1a4f7e92f7e85b4d98eaa6abdf2 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Thu, 13 Jun 2019 14:22:31 +0200
Subject: [PATCH 09/23] [depends] refresh libcdio-gplv3 patches

---
 tools/depends/target/libcdio-gplv3/osx2.patch | 159 +++++++++---------
 1 file changed, 76 insertions(+), 83 deletions(-)

diff --git a/tools/depends/target/libcdio-gplv3/osx2.patch b/tools/depends/target/libcdio-gplv3/osx2.patch
index 964e2d0fbad4..b75d99f85d0f 100644
--- a/tools/depends/target/libcdio-gplv3/osx2.patch
+++ b/tools/depends/target/libcdio-gplv3/osx2.patch
@@ -10,8 +10,6 @@ check_cdtext.sh: return should only be used inside functions
  test/check_cdtext.sh |  10 +-
  2 files changed, 291 insertions(+), 291 deletions(-)
 
-diff --git a/lib/driver/osx.c b/lib/driver/osx.c
-index c361fd9..e77ad74 100644
 --- a/lib/driver/osx.c
 +++ b/lib/driver/osx.c
 @@ -1,7 +1,7 @@
@@ -42,7 +40,7 @@ index c361fd9..e77ad74 100644
  
  #include <cdio/logging.h>
  #include <cdio/sector.h>
-@@ -55,14 +55,14 @@ typedef enum {
+@@ -55,14 +55,14 @@
    TR_UNKNOWN =      10  /**< Unspecified error */,
    TR_STREAMING =    11  /**< loss of streaming */,
  } transport_error_t;
@@ -59,7 +57,7 @@ index c361fd9..e77ad74 100644
  
  #include <CoreFoundation/CoreFoundation.h>
  #include <IOKit/IOKitLib.h>
-@@ -141,9 +141,9 @@ typedef enum {
+@@ -141,9 +141,9 @@
  
  #define MAX_SERVICE_NAME 1000
  typedef struct {
@@ -71,7 +69,7 @@ index c361fd9..e77ad74 100644
  
    access_mode_t access_mode;
  
-@@ -163,7 +163,7 @@ typedef struct {
+@@ -163,7 +163,7 @@
    SCSITaskInterface **scsi_task;
    MMCDeviceInterface **mmc;
    IOCFPlugInInterface **plugin;
@@ -80,7 +78,7 @@ index c361fd9..e77ad74 100644
    SCSI_Sense_Data sense;
    SCSITaskStatus status;
    UInt64 realized_len;
-@@ -172,7 +172,7 @@ typedef struct {
+@@ -172,7 +172,7 @@
  } _img_private_t;
  
  static bool read_toc_osx (void *p_user_data);
@@ -89,7 +87,7 @@ index c361fd9..e77ad74 100644
                                             track_t i_track);
  
  /**
-@@ -185,9 +185,9 @@ GetRegistryEntryProperties ( io_service_t service )
+@@ -185,9 +185,9 @@
  {
    IOReturn                      err     = kIOReturnSuccess;
    CFMutableDictionaryRef        dict    = 0;
@@ -102,7 +100,7 @@ index c361fd9..e77ad74 100644
    if ( err != kIOReturnSuccess )
      cdio_warn( "IORegistryEntryCreateCFProperties: 0x%08x", err );
  
-@@ -205,27 +205,27 @@ ProbeStorageDevices()
+@@ -205,27 +205,27 @@
    kern_return_t kern_result;
    io_iterator_t service_iterator;
    CFMutableDictionaryRef classes_to_match;
@@ -135,7 +133,7 @@ index c361fd9..e77ad74 100644
    next_service = IOIteratorNext( service_iterator );
    if( next_service != 0 )
      {
-@@ -234,7 +234,7 @@ ProbeStorageDevices()
+@@ -234,7 +234,7 @@
            IOServiceRequestProbe( next_service, 0 );
  
            IOObjectRelease( next_service );
@@ -144,7 +142,7 @@ index c361fd9..e77ad74 100644
          } while( ( next_service = IOIteratorNext( service_iterator ) ) != 0 );
      }
    IOObjectRelease( service_iterator );
-@@ -248,11 +248,11 @@ get_scsi(_img_private_t *p_env)
+@@ -248,11 +248,11 @@
    SInt32 score;
    kern_return_t err;
    HRESULT herr;
@@ -159,7 +157,7 @@ index c361fd9..e77ad74 100644
                                            &score);
  
    if (err != noErr) {
-@@ -269,24 +269,24 @@ get_scsi(_img_private_t *p_env)
+@@ -269,24 +269,24 @@
      IODestroyPlugInInterface(p_env->plugin);
      return false;
    }
@@ -190,7 +188,7 @@ index c361fd9..e77ad74 100644
      if (err == kIOReturnBusy)
        fprintf(stderr, "The volume is already mounted.\n");
      else if (err == kIOReturnExclusiveAccess)
-@@ -294,18 +294,18 @@ get_scsi(_img_private_t *p_env)
+@@ -294,18 +294,18 @@
                "to this device.\n");
      else
        fprintf(stderr, "I don't know why.\n");
@@ -214,7 +212,7 @@ index c361fd9..e77ad74 100644
    if (!p_env->scsi_task) {
      fprintf(stderr, "Could not create a SCSITask interface.\n");
      (*p_env->pp_scsiTaskDeviceInterface)->
-@@ -316,12 +316,12 @@ get_scsi(_img_private_t *p_env)
+@@ -316,12 +316,12 @@
      IODestroyPlugInInterface(p_env->plugin);
      return false;
    }
@@ -229,7 +227,7 @@ index c361fd9..e77ad74 100644
  init_osx(_img_private_t *p_env) {
    char *psz_devname;
    kern_return_t ret;
-@@ -344,36 +344,36 @@ init_osx(_img_private_t *p_env) {
+@@ -344,36 +344,36 @@
      ++psz_devname;
    else
      psz_devname = p_env->gen.source_name;
@@ -276,7 +274,7 @@ index c361fd9..e77ad74 100644
                                                &iterator );
        if( ret != KERN_SUCCESS )
          {
-@@ -381,13 +381,13 @@ init_osx(_img_private_t *p_env) {
+@@ -381,13 +381,13 @@
            IOObjectRelease( p_env->MediaClass_service );
            return false;
          }
@@ -292,7 +290,7 @@ index c361fd9..e77ad74 100644
    if ( 0 == p_env->MediaClass_service )     {
      cdio_warn( "search for kIOCDMediaClass/kIODVDMediaClass/kIOBDMediaClass came up empty" );
      return false;
-@@ -397,26 +397,26 @@ init_osx(_img_private_t *p_env) {
+@@ -397,26 +397,26 @@
       another scan. FIXME: this is hoaky and there's got to be a better
       variable to test or way to do.
     */
@@ -325,7 +323,7 @@ index c361fd9..e77ad74 100644
                  input. We'll figure out what the right CDB length should be.
  
    We return true if command completed successfully and false if not.
-@@ -424,11 +424,11 @@ init_osx(_img_private_t *p_env) {
+@@ -424,11 +424,11 @@
  #if 1
  
  /* process a complete scsi command. */
@@ -341,7 +339,7 @@ index c361fd9..e77ad74 100644
                   unsigned int i_buf, /*in/out*/ void *p_buf )
  {
    _img_private_t *p_env = p_user_data;
-@@ -442,13 +442,13 @@ run_mmc_cmd_osx( void *p_user_data,
+@@ -442,13 +442,13 @@
    p_env->gen.scsi_mmc_sense_valid = 0;
    memcpy(cmdbuf, p_cdb, i_cdb);
  
@@ -359,7 +357,7 @@ index c361fd9..e77ad74 100644
    if (!i_buf)
      dir = kSCSIDataTransfer_NoDataTransfer;
  
-@@ -460,51 +460,51 @@ run_mmc_cmd_osx( void *p_user_data,
+@@ -460,51 +460,51 @@
    buf.address = (IOVirtualAddress)p_buf;
    buf.length = i_buf;
  
@@ -422,7 +420,7 @@ index c361fd9..e77ad74 100644
      switch (key) {
      case 0:
        if (errno == 0)
-@@ -549,31 +549,31 @@ run_mmc_cmd_osx( void *p_user_data,
+@@ -549,31 +549,31 @@
  
  #if 0
  /**
@@ -462,7 +460,7 @@ index c361fd9..e77ad74 100644
    const _img_private_t *p_env = p_user_data;
    SCSITaskDeviceInterface **sc;
    SCSITaskInterface **cmd = NULL;
-@@ -603,16 +603,16 @@ run_mmc_cmd_osx( const void *p_user_data,
+@@ -603,16 +603,16 @@
    iov.address = (IOVirtualAddress) p_buf;
    iov.length = i_buf;
  
@@ -482,7 +480,7 @@ index c361fd9..e77ad74 100644
                                                    kSCSIDataTransfer_FromTargetToInitiator :
                                                    kSCSIDataTransfer_FromInitiatorToTarget);
    if (ioReturnValue != kIOReturnSuccess) {
-@@ -652,17 +652,17 @@ run_mmc_cmd_osx( const void *p_user_data,
+@@ -652,17 +652,17 @@
  static io_iterator_t
  GetDeviceIterator ( const char * deviceClass )
  {
@@ -505,7 +503,7 @@ index c361fd9..e77ad74 100644
  }
  
  /***************************************************************************
-@@ -677,27 +677,27 @@ GetFeaturesFlagsForDrive ( CFDictionaryRef dict,
+@@ -677,27 +677,27 @@
  {
    CFDictionaryRef propertiesDict = 0;
    CFNumberRef     flagsNumberRef = 0;
@@ -543,7 +541,7 @@ index c361fd9..e77ad74 100644
                             CFSTR ( kIOPropertySupportedDVDFeatures ) );
    if ( flagsNumberRef != 0 ) {
      CFNumberGetValue ( flagsNumberRef, kCFNumberLongType, i_dvdFlags );
-@@ -722,32 +722,32 @@ get_discmode_osx (void *p_user_data)
+@@ -722,32 +722,32 @@
  
    if ( propertiesDict == 0 ) return i_discmode;
  
@@ -585,7 +583,7 @@ index c361fd9..e77ad74 100644
    if (CDIO_DISC_MODE_CD_DATA == i_discmode) {
      /* Need to do more classification */
      return get_discmode_cd_generic(p_user_data);
-@@ -761,11 +761,11 @@ get_drive_service_osx(const _img_private_t *p_env)
+@@ -761,11 +761,11 @@
  {
    io_service_t  service;
    io_iterator_t service_iterator;
@@ -599,7 +597,7 @@ index c361fd9..e77ad74 100644
    service = IOIteratorNext( service_iterator );
    if( service == 0 ) return 0;
  
-@@ -774,21 +774,21 @@ get_drive_service_osx(const _img_private_t *p_env)
+@@ -774,21 +774,21 @@
        char psz_service[MAX_SERVICE_NAME];
        IORegistryEntryGetPath(service, kIOServicePlane, psz_service);
        psz_service[MAX_SERVICE_NAME-1] = '\0';
@@ -625,7 +623,7 @@ index c361fd9..e77ad74 100644
      } while( ( service = IOIteratorNext( service_iterator ) ) != 0 );
  
    IOObjectRelease( service_iterator );
-@@ -806,56 +806,56 @@ get_drive_cap_osx(const void *p_user_data,
+@@ -806,56 +806,56 @@
    uint32_t i_dvdFlags;
  
    io_service_t  service = get_drive_service_osx(p_env);
@@ -700,7 +698,7 @@ index c361fd9..e77ad74 100644
                       | CDIO_DRIVE_CAP_MISC_EJECT
                       | CDIO_DRIVE_CAP_MISC_LOCK
                       | CDIO_DRIVE_CAP_MISC_SELECT_SPEED
-@@ -868,7 +868,7 @@ get_drive_cap_osx(const void *p_user_data,
+@@ -868,7 +868,7 @@
  
      IOObjectRelease( service );
    }
@@ -709,7 +707,7 @@ index c361fd9..e77ad74 100644
    return;
  
   err_exit:
-@@ -878,7 +878,7 @@ get_drive_cap_osx(const void *p_user_data,
+@@ -878,7 +878,7 @@
  
  #if 1
  /****************************************************************************
@@ -718,7 +716,7 @@ index c361fd9..e77ad74 100644
   ****************************************************************************/
  
  static bool
-@@ -888,42 +888,42 @@ get_hwinfo_osx ( const CdIo_t *p_cdio, /*out*/ cdio_hwinfo_t *hw_info)
+@@ -888,42 +888,42 @@
    io_service_t  service = get_drive_service_osx(p_env);
  
    if ( service == 0 ) return false;
@@ -776,7 +774,7 @@ index c361fd9..e77ad74 100644
      if ( CFStringGetCString( revision,
                               (char *) &(hw_info->psz_revision),
                               sizeof(hw_info->psz_revision),
-@@ -931,11 +931,11 @@ get_hwinfo_osx ( const CdIo_t *p_cdio, /*out*/ cdio_hwinfo_t *hw_info)
+@@ -931,11 +931,11 @@
        CFRelease( revision );
    }
    return true;
@@ -790,7 +788,7 @@ index c361fd9..e77ad74 100644
  _free_osx (void *p_user_data) {
    _img_private_t *p_env = p_user_data;
    if (NULL == p_env) return;
-@@ -950,17 +950,17 @@ _free_osx (void *p_user_data) {
+@@ -950,17 +950,17 @@
    if (p_env->scsi_task)
      (*p_env->scsi_task)->Release(p_env->scsi_task);
  
@@ -813,7 +811,7 @@ index c361fd9..e77ad74 100644
      IODestroyPlugInInterface(p_env->plugin);
  
  }
-@@ -968,10 +968,10 @@ _free_osx (void *p_user_data) {
+@@ -968,10 +968,10 @@
  /**
     Reads i_blocks of data sectors from cd device into p_data starting
     from i_lsn.
@@ -826,7 +824,7 @@ index c361fd9..e77ad74 100644
                         uint16_t i_blocksize, uint32_t i_blocks)
  {
    _img_private_t *p_env = p_user_data;
-@@ -981,9 +981,9 @@ read_data_sectors_osx (void *p_user_data, void *p_data, lsn_t i_lsn,
+@@ -981,9 +981,9 @@
    {
      dk_cd_read_t cd_read;
      track_t i_track = cdio_get_track(p_env->gen.cdio, i_lsn);
@@ -838,7 +836,7 @@ index c361fd9..e77ad74 100644
      cd_read.sectorArea  = kCDSectorAreaUser;
      cd_read.buffer      = p_data;
  
-@@ -1001,9 +1001,9 @@ read_data_sectors_osx (void *p_user_data, void *p_data, lsn_t i_lsn,
+@@ -1001,9 +1001,9 @@
      default:
        return DRIVER_OP_ERROR;
      }
@@ -850,7 +848,7 @@ index c361fd9..e77ad74 100644
      if( ioctl( p_env->gen.fd, DKIOCCDREAD, &cd_read ) == -1 )
        {
          cdio_info( "could not read block %d, %s", i_lsn, strerror(errno) );
-@@ -1013,25 +1013,25 @@ read_data_sectors_osx (void *p_user_data, void *p_data, lsn_t i_lsn,
+@@ -1013,25 +1013,25 @@
    }
  }
  
@@ -882,7 +880,7 @@ index c361fd9..e77ad74 100644
    if (b_form2) {
      cd_read.offset       = i_lsn * kCDSectorSizeMode2;
      cd_read.bufferLength = kCDSectorSizeMode2 * i_blocks;
-@@ -1039,7 +1039,7 @@ read_mode1_sectors_osx (void *p_user_data, void *p_data, lsn_t i_lsn,
+@@ -1039,7 +1039,7 @@
      cd_read.offset       = i_lsn * kCDSectorSizeMode1;
      cd_read.bufferLength = kCDSectorSizeMode1 * i_blocks;
    }
@@ -891,7 +889,7 @@ index c361fd9..e77ad74 100644
     if( ioctl( p_env->gen.fd, DKIOCCDREAD, &cd_read ) == -1 )
    {
      cdio_info( "could not read block %d, %s", i_lsn, strerror(errno) );
-@@ -1051,7 +1051,7 @@ read_mode1_sectors_osx (void *p_user_data, void *p_data, lsn_t i_lsn,
+@@ -1051,7 +1051,7 @@
  /**
     Reads i_blocks of mode2 form2 sectors from cd device into data starting
     from lsn.
@@ -900,7 +898,7 @@ index c361fd9..e77ad74 100644
   */
  static driver_return_code_t
  read_mode2_sectors_osx (void *p_user_data, void *p_data, lsn_t i_lsn,
-@@ -1059,12 +1059,12 @@ read_mode2_sectors_osx (void *p_user_data, void *p_data, lsn_t i_lsn,
+@@ -1059,12 +1059,12 @@
  {
    _img_private_t *p_env = p_user_data;
    dk_cd_read_t cd_read;
@@ -916,7 +914,7 @@ index c361fd9..e77ad74 100644
    if (b_form2) {
      cd_read.offset       = i_lsn * kCDSectorSizeMode2Form2;
      cd_read.sectorType   = kCDSectorTypeMode2Form2;
-@@ -1074,7 +1074,7 @@ read_mode2_sectors_osx (void *p_user_data, void *p_data, lsn_t i_lsn,
+@@ -1074,7 +1074,7 @@
      cd_read.sectorType   = kCDSectorTypeMode2Form1;
      cd_read.bufferLength = kCDSectorSizeMode2Form1 * i_blocks;
    }
@@ -925,7 +923,7 @@ index c361fd9..e77ad74 100644
    if( ioctl( p_env->gen.fd, DKIOCCDREAD, &cd_read ) == -1 )
    {
      cdio_info( "could not read block %d, %s", i_lsn, strerror(errno) );
-@@ -1083,27 +1083,27 @@ read_mode2_sectors_osx (void *p_user_data, void *p_data, lsn_t i_lsn,
+@@ -1083,27 +1083,27 @@
    return DRIVER_OP_SUCCESS;
  }
  
@@ -960,7 +958,7 @@ index c361fd9..e77ad74 100644
    if( ioctl( env->gen.fd, DKIOCCDREAD, &cd_read ) == -1 )
    {
      cdio_info( "could not read block %d\n%s", lsn,
-@@ -1115,10 +1115,10 @@ read_audio_sectors_osx (void *user_data, void *p_data, lsn_t lsn,
+@@ -1115,10 +1115,10 @@
  
  /**
     Reads a single mode2 sector from cd device into p_data starting
@@ -973,7 +971,7 @@ index c361fd9..e77ad74 100644
                         bool b_form2)
  {
    return read_mode1_sectors_osx(p_user_data, p_data, i_lsn, b_form2, 1);
-@@ -1126,7 +1126,7 @@ read_mode1_sector_osx (void *p_user_data, void *p_data, lsn_t i_lsn,
+@@ -1126,7 +1126,7 @@
  
  /**
     Reads a single mode2 sector from cd device into p_data starting
@@ -982,7 +980,7 @@ index c361fd9..e77ad74 100644
   */
  static driver_return_code_t
  read_mode2_sector_osx (void *p_user_data, void *p_data, lsn_t i_lsn,
-@@ -1162,7 +1162,7 @@ _set_arg_osx (void *p_user_data, const char key[], const char value[])
+@@ -1162,7 +1162,7 @@
  }
  
  #if 0
@@ -991,7 +989,7 @@ index c361fd9..e77ad74 100644
  TestDevice(_img_private_t *p_env, io_service_t service)
  {
    SInt32                          score;
-@@ -1182,26 +1182,26 @@ TestDevice(_img_private_t *p_env, io_service_t service)
+@@ -1182,26 +1182,26 @@
      printf("IOCreatePlugInInterfaceForService returned %d\n", err);
      return;
    }
@@ -1025,7 +1023,7 @@ index c361fd9..e77ad74 100644
    ( *mmcInterface )->Release ( mmcInterface );
    IODestroyPlugInInterface ( plugInInterface );
  }
-@@ -1212,7 +1212,7 @@ TestDevice(_img_private_t *p_env, io_service_t service)
+@@ -1212,7 +1212,7 @@
    Return false if successful or true if an error.
  */
  static bool
@@ -1034,7 +1032,7 @@ index c361fd9..e77ad74 100644
  {
    _img_private_t *p_env = p_user_data;
    CFDictionaryRef propertiesDict = 0;
-@@ -1231,25 +1231,25 @@ read_toc_osx (void *p_user_data)
+@@ -1231,25 +1231,25 @@
    if ( data  != NULL ) {
      CFRange range;
      CFIndex buf_len;
@@ -1065,7 +1063,7 @@ index c361fd9..e77ad74 100644
  
    p_env->i_descriptors = CDTOCGetDescriptorCount ( p_env->pTOC );
  
-@@ -1259,9 +1259,9 @@ read_toc_osx (void *p_user_data)
+@@ -1259,9 +1259,9 @@
     */
    {
      int i, i_leadout = -1;
@@ -1077,7 +1075,7 @@ index c361fd9..e77ad74 100644
      p_env->pp_lba = malloc( p_env->i_descriptors * sizeof(int) );
      if( p_env->pp_lba == NULL )
        {
-@@ -1269,33 +1269,33 @@ read_toc_osx (void *p_user_data)
+@@ -1269,33 +1269,33 @@
          free( p_env->pTOC );
          return false;
        }
@@ -1117,7 +1115,7 @@ index c361fd9..e77ad74 100644
            continue;
  
          if( i_track == OSX_CDROM_LEADOUT_TRACK )
-@@ -1304,16 +1304,16 @@ read_toc_osx (void *p_user_data)
+@@ -1304,16 +1304,16 @@
          if( i_track > CDIO_CD_MAX_TRACKS || i_track < CDIO_CD_MIN_TRACK_NO )
            continue;
  
@@ -1141,7 +1139,7 @@ index c361fd9..e77ad74 100644
            p_env->i_last_session = i_session;
        }
  
-@@ -1327,15 +1327,15 @@ read_toc_osx (void *p_user_data)
+@@ -1327,15 +1327,15 @@
          if( i_track > CDIO_CD_MAX_TRACKS || i_track < CDIO_CD_MIN_TRACK_NO )
            continue;
  
@@ -1160,7 +1158,7 @@ index c361fd9..e77ad74 100644
      if( i_leadout == -1 )
        {
          cdio_warn( "CD leadout not found" );
-@@ -1343,9 +1343,9 @@ read_toc_osx (void *p_user_data)
+@@ -1343,9 +1343,9 @@
          free( (void *) p_env->pTOC );
          return false;
        }
@@ -1173,7 +1171,7 @@ index c361fd9..e77ad74 100644
         really have have MSF -> LSN -> LBA.
      */
      p_env->pp_lba[TOTAL_TRACKS] =
-@@ -1355,7 +1355,7 @@ read_toc_osx (void *p_user_data)
+@@ -1355,7 +1355,7 @@
  
    p_env->gen.toc_init   = true;
  
@@ -1182,7 +1180,7 @@ index c361fd9..e77ad74 100644
  
  }
  
-@@ -1412,29 +1412,29 @@ _eject_media_osx (void *user_data) {
+@@ -1412,29 +1412,29 @@
  #define EJECT_CMD "/usr/sbin/hdiutil eject %s"
        snprintf( sz_cmd, sizeof(sz_cmd), EJECT_CMD, psz_drive );
  #undef EJECT_CMD
@@ -1218,7 +1216,7 @@ index c361fd9..e77ad74 100644
    return DRIVER_OP_ERROR;
  }
  #else /* HAVE_DISKARBITRATION */
-@@ -1460,7 +1460,7 @@ static void media_eject_callback(DADiskRef disk, DADissenterRef dissenter, void
+@@ -1460,7 +1460,7 @@
        {
          CFStringRef status = DADissenterGetStatusString(dissenter);
          if (status)
@@ -1227,7 +1225,7 @@ index c361fd9..e77ad74 100644
                  size_t cstr_size = CFStringGetLength(status);
                  char *cstr = malloc(cstr_size);
                  if ( CFStringGetCString( status,
-@@ -1520,18 +1520,18 @@ _eject_media_osx (void *user_data) {
+@@ -1520,18 +1520,18 @@
    dacontext.completed = FALSE;
    dacontext.runloop   = CFRunLoopGetCurrent();
    dacontext.cancel    = CFRunLoopSourceCreate(kCFAllocatorDefault, 0, &cancelRunLoopSourceContext);
@@ -1249,7 +1247,7 @@ index c361fd9..e77ad74 100644
    if ((disk = DADiskCreateFromBSDName(kCFAllocatorDefault, dacontext.session, psz_drive)) != NULL)
      {
        if ((description = DADiskCopyDescription(disk)) != NULL)
-@@ -1559,7 +1559,7 @@ _eject_media_osx (void *user_data) {
+@@ -1559,7 +1559,7 @@
          }
        CFRelease(disk);
      }
@@ -1258,7 +1256,7 @@ index c361fd9..e77ad74 100644
    CFRunLoopSourceInvalidate(dacontext.cancel);
    CFRelease(dacontext.cancel);
    CFRelease(dacontext.session);
-@@ -1593,7 +1593,7 @@ _get_arg_osx (void *user_data, const char key[])
+@@ -1593,7 +1593,7 @@
      case _AM_NONE:
        return "no access method";
      }
@@ -1267,7 +1265,7 @@ index c361fd9..e77ad74 100644
    return NULL;
  }
  
-@@ -1636,10 +1636,10 @@ get_track_isrc_osx (const void *user_data, track_t i_track) {
+@@ -1636,10 +1636,10 @@
  }
  
  /**
@@ -1280,7 +1278,7 @@ index c361fd9..e77ad74 100644
  {
    _img_private_t *p_env = p_user_data;
    dk_cd_read_track_info_t cd_read;
-@@ -1649,15 +1649,15 @@ get_track_format_osx(void *p_user_data, track_t i_track)
+@@ -1649,15 +1649,15 @@
  
    if (i_track > p_env->i_last_track || i_track < p_env->gen.i_first_track)
      return TRACK_FORMAT_ERROR;
@@ -1299,7 +1297,7 @@ index c361fd9..e77ad74 100644
    if( ioctl( p_env->gen.fd, DKIOCCDREADTRACKINFO, &cd_read ) == -1 )
    {
      cdio_warn( "could not read trackinfo for track %d:\n%s", i_track,
-@@ -1665,7 +1665,7 @@ get_track_format_osx(void *p_user_data, track_t i_track)
+@@ -1665,7 +1665,7 @@
      return TRACK_FORMAT_ERROR;
    }
  
@@ -1308,7 +1306,7 @@ index c361fd9..e77ad74 100644
                a_track.trackMode, a_track.dataMode );
  
    if (a_track.trackMode == CDIO_CDROM_DATA_TRACK) {
-@@ -1691,7 +1691,7 @@ get_track_format_osx(void *p_user_data, track_t i_track)
+@@ -1691,7 +1691,7 @@
    FIXME: there's gotta be a better design for this and get_track_format?
  */
  static bool
@@ -1317,7 +1315,7 @@ index c361fd9..e77ad74 100644
  {
    _img_private_t *p_env = p_user_data;
    CDTrackInfo a_track;
-@@ -1704,15 +1704,15 @@ get_track_green_osx(void *p_user_data, track_t i_track)
+@@ -1704,15 +1704,15 @@
    else {
  
      dk_cd_read_track_info_t cd_read;
@@ -1337,7 +1335,7 @@ index c361fd9..e77ad74 100644
      if( ioctl( p_env->gen.fd, DKIOCCDREADTRACKINFO, &cd_read ) == -1 ) {
        cdio_warn( "could not read trackinfo for track %d:\n%s", i_track,
                   strerror(errno));
-@@ -1723,7 +1723,7 @@ get_track_green_osx(void *p_user_data, track_t i_track)
+@@ -1723,7 +1723,7 @@
  }
  
  /* Set CD-ROM drive speed */
@@ -1346,7 +1344,7 @@ index c361fd9..e77ad74 100644
  set_speed_osx (void *p_user_data, int i_speed)
  {
    const _img_private_t *p_env = p_user_data;
-@@ -1736,16 +1736,16 @@ set_speed_osx (void *p_user_data, int i_speed)
+@@ -1736,16 +1736,16 @@
  
  /**
    Close tray on CD-ROM.
@@ -1367,7 +1365,7 @@ index c361fd9..e77ad74 100644
  close_tray_osx (const char *psz_drive)
  {
  #ifdef HAVE_DARWIN_CDROM
-@@ -1754,7 +1754,7 @@ close_tray_osx (const char *psz_drive)
+@@ -1754,7 +1754,7 @@
  
    if ( !psz_drive) return DRIVER_OP_UNINIT;
  
@@ -1376,7 +1374,7 @@ index c361fd9..e77ad74 100644
       possibly someday we will.
     */
    snprintf( sz_cmd, sizeof(sz_cmd), CLOSE_TRAY_CMD );
-@@ -1763,25 +1763,25 @@ close_tray_osx (const char *psz_drive)
+@@ -1763,25 +1763,25 @@
      {
        char psz_result[0x200];
        int i_ret = fread( psz_result, 1, sizeof(psz_result) - 1, p_file );
@@ -1408,7 +1406,7 @@ index c361fd9..e77ad74 100644
    return DRIVER_OP_NO_DRIVER;
  #endif /*HAVE_DARWIN_CDROM*/
  }
-@@ -1802,46 +1802,46 @@ cdio_get_devices_osx(void)
+@@ -1802,46 +1802,46 @@
    CFMutableDictionaryRef classes_to_match;
    char        **drives = NULL;
    unsigned int  num_drives=0;
@@ -1465,7 +1463,7 @@ index c361fd9..e77ad74 100644
              IORegistryEntryCreateCFProperty( next_media,
                                               CFSTR( kIOBSDNameKey ),
                                               kCFAllocatorDefault,
-@@ -1851,13 +1851,13 @@ cdio_get_devices_osx(void)
+@@ -1851,13 +1851,13 @@
                IOObjectRelease( next_media );
                continue;
              }
@@ -1482,7 +1480,7 @@ index c361fd9..e77ad74 100644
            if( CFStringGetCString( str_bsd_path,
                                    (char*)&psz_buf + dev_path_length,
                                    sizeof(psz_buf) - dev_path_length,
-@@ -1867,7 +1867,7 @@ cdio_get_devices_osx(void)
+@@ -1867,7 +1867,7 @@
              }
            CFRelease( str_bsd_path );
            IOObjectRelease( next_media );
@@ -1491,7 +1489,7 @@ index c361fd9..e77ad74 100644
          } while( ( next_media = IOIteratorNext( media_iterator ) ) != 0 );
      }
    IOObjectRelease( media_iterator );
-@@ -1889,37 +1889,37 @@ cdio_get_default_device_osx(void)
+@@ -1889,37 +1889,37 @@
    kern_return_t kern_result;
    io_iterator_t media_iterator;
    CFMutableDictionaryRef classes_to_match;
@@ -1537,7 +1535,7 @@ index c361fd9..e77ad74 100644
        do
          {
            /* Skip other removable media, like USB flash memory keys:  */
-@@ -1937,10 +1937,10 @@ cdio_get_default_device_osx(void)
+@@ -1937,10 +1937,10 @@
                IOObjectRelease( next_media );
                continue;
              }
@@ -1550,7 +1548,7 @@ index c361fd9..e77ad74 100644
            if( CFStringGetCString( str_bsd_path,
                                    (char*)&psz_buf + dev_path_length,
                                    sizeof(psz_buf) - dev_path_length,
-@@ -1951,10 +1951,10 @@ cdio_get_default_device_osx(void)
+@@ -1951,10 +1951,10 @@
                IOObjectRelease( media_iterator );
                return strdup( psz_buf );
              }
@@ -1563,7 +1561,7 @@ index c361fd9..e77ad74 100644
          } while( ( next_media = IOIteratorNext( media_iterator ) ) != 0 );
      }
    IOObjectRelease( media_iterator );
-@@ -2039,10 +2039,10 @@ cdio_open_osx (const char *psz_orig_source)
+@@ -2039,10 +2039,10 @@
  
    if (NULL == psz_orig_source) {
      psz_source=cdio_get_default_device_osx();
@@ -1577,7 +1575,7 @@ index c361fd9..e77ad74 100644
  
      _set_arg_osx(_data, "source", psz_source);
      free(psz_source);
-@@ -2071,8 +2071,8 @@ cdio_open_osx (const char *psz_orig_source)
+@@ -2071,8 +2071,8 @@
      free(ret);
      return NULL;
    }
@@ -1588,7 +1586,7 @@ index c361fd9..e77ad74 100644
    return NULL;
  #endif /* HAVE_DARWIN_CDROM */
  
-@@ -2083,7 +2083,7 @@ cdio_have_osx (void)
+@@ -2083,7 +2083,7 @@
  {
  #ifdef HAVE_DARWIN_CDROM
    return true;
@@ -1597,8 +1595,6 @@ index c361fd9..e77ad74 100644
    return false;
  #endif /* HAVE_DARWIN_CDROM */
  }
-diff --git a/test/check_cdtext.sh b/test/check_cdtext.sh
-index e0793ee..dfbfc9a 100755
 --- a/test/check_cdtext.sh
 +++ b/test/check_cdtext.sh
 @@ -17,7 +17,7 @@
@@ -1610,7 +1606,7 @@ index e0793ee..dfbfc9a 100755
  fi
  
  . $srcdir/check_common_fn
-@@ -25,16 +25,16 @@ fi
+@@ -25,16 +25,16 @@
  CDTEXT_RAW=$srcdir/../example/cdtext-raw
  
  if test ! -x $CDTEXT_RAW ; then
@@ -1630,7 +1626,7 @@ index e0793ee..dfbfc9a 100755
  fi
  
  
-@@ -43,7 +43,7 @@ test_cdtext_raw() {
+@@ -43,7 +43,7 @@
    outfile="$2"
    rightfile="$3"
  
@@ -1639,6 +1635,3 @@ index e0793ee..dfbfc9a 100755
      if $DIFF $DIFF_OPTS "${outfile}" "${rightfile}" ; then
        $RM "${outfile}"
        return 0
--- 
-2.10.1
-

From a3ff61fccbdd1c94ed10b615b6a3ac9e6fd795b9 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Thu, 13 Jun 2019 14:22:31 +0200
Subject: [PATCH 10/23] [depends] refresh libgcrypt patches

---
 .../target/libgcrypt/01-gcrypt-android-select.patch       | 4 ++--
 tools/depends/target/libgcrypt/02-fix-armv7-neon.patch    | 4 ++--
 .../target/libgcrypt/03-remove-cipher-gcm-armv8.patch     | 4 ++--
 .../depends/target/libgcrypt/04-fix-o-flag-munging.patch  | 4 ++--
 tools/depends/target/libgcrypt/Makefile                   | 8 ++++----
 5 files changed, 12 insertions(+), 12 deletions(-)

diff --git a/tools/depends/target/libgcrypt/01-gcrypt-android-select.patch b/tools/depends/target/libgcrypt/01-gcrypt-android-select.patch
index a3483261835c..9521d503a690 100644
--- a/tools/depends/target/libgcrypt/01-gcrypt-android-select.patch
+++ b/tools/depends/target/libgcrypt/01-gcrypt-android-select.patch
@@ -1,5 +1,5 @@
---- src/gcrypt.h.in	2007-12-03 03:48:19.000000000 -0500
-+++ src/gcrypt.h.in	2013-01-21 00:31:48.772740461 -0500
+--- a/src/gcrypt.h.in
++++ b/src/gcrypt.h.in
 @@ -47,6 +47,10 @@
  
  @FALLBACK_SOCKLEN_T@
diff --git a/tools/depends/target/libgcrypt/02-fix-armv7-neon.patch b/tools/depends/target/libgcrypt/02-fix-armv7-neon.patch
index 6be8bb005c30..1f38a4ab758a 100644
--- a/tools/depends/target/libgcrypt/02-fix-armv7-neon.patch
+++ b/tools/depends/target/libgcrypt/02-fix-armv7-neon.patch
@@ -1,5 +1,5 @@
---- configure.ac.orig	2017-10-11 11:20:51.572217383 +0200
-+++ configure.ac	2017-10-11 11:23:40.384215754 +0200
+--- a/configure.ac
++++ b/configure.ac
 @@ -2083,10 +2083,6 @@
        arm*-*-*)
           # Build with the assembly implementation
diff --git a/tools/depends/target/libgcrypt/03-remove-cipher-gcm-armv8.patch b/tools/depends/target/libgcrypt/03-remove-cipher-gcm-armv8.patch
index fde0996602c8..3e525caec3f3 100644
--- a/tools/depends/target/libgcrypt/03-remove-cipher-gcm-armv8.patch
+++ b/tools/depends/target/libgcrypt/03-remove-cipher-gcm-armv8.patch
@@ -1,5 +1,5 @@
---- cipher/Makefile.am.orig	2017-10-11 11:32:12.196210815 +0200
-+++ cipher/Makefile.am	2017-10-11 11:32:54.668210405 +0200
+--- a/cipher/Makefile.am
++++ b/cipher/Makefile.am
 @@ -43,7 +43,6 @@
  cipher.c cipher-internal.h \
  cipher-cbc.c cipher-cfb.c cipher-ofb.c cipher-ctr.c cipher-aeswrap.c \
diff --git a/tools/depends/target/libgcrypt/04-fix-o-flag-munging.patch b/tools/depends/target/libgcrypt/04-fix-o-flag-munging.patch
index 69cde533f4d8..0949a37404bd 100644
--- a/tools/depends/target/libgcrypt/04-fix-o-flag-munging.patch
+++ b/tools/depends/target/libgcrypt/04-fix-o-flag-munging.patch
@@ -1,5 +1,5 @@
---- random/Makefile.am.orig	2017-10-27 12:01:31.000000000 +0200
-+++ random/Makefile.am	2017-10-27 12:01:44.000000000 +0200
+--- a/random/Makefile.am
++++ b/random/Makefile.am
 @@ -55,7 +55,7 @@
  
  # The rndjent module needs to be compiled without optimization.  */
diff --git a/tools/depends/target/libgcrypt/Makefile b/tools/depends/target/libgcrypt/Makefile
index b2191b5029a0..340e2333ba36 100644
--- a/tools/depends/target/libgcrypt/Makefile
+++ b/tools/depends/target/libgcrypt/Makefile
@@ -32,12 +32,12 @@ $(TARBALLS_LOCATION)/$(ARCHIVE):
 $(PLATFORM): $(TARBALLS_LOCATION)/$(ARCHIVE) $(DEPS)
 	rm -rf $(PLATFORM)/*; mkdir -p $(PLATFORM)
 	cd $(PLATFORM); $(ARCHIVE_TOOL) $(ARCHIVE_TOOL_FLAGS) $(TARBALLS_LOCATION)/$(ARCHIVE)
-	cd $(PLATFORM); patch -p0 < ../01-gcrypt-android-select.patch
-	cd $(PLATFORM); patch -p0 < ../02-fix-armv7-neon.patch
+	cd $(PLATFORM); patch -p1 -i ../01-gcrypt-android-select.patch
+	cd $(PLATFORM); patch -p1 -i ../02-fix-armv7-neon.patch
 ifneq ($(findstring arm64, $(CPU)), arm64)
-	cd $(PLATFORM); patch -p0 < ../03-remove-cipher-gcm-armv8.patch
+	cd $(PLATFORM); patch -p1 -i ../03-remove-cipher-gcm-armv8.patch
 endif
-	cd $(PLATFORM); patch -p0 < ../04-fix-o-flag-munging.patch
+	cd $(PLATFORM); patch -p1 -i ../04-fix-o-flag-munging.patch
 	# do not build the tests or docs
 	sed -ie "s|doc tests||" "$(PLATFORM)/Makefile.am"
 	sed -ie "s|\$$(doc) tests||" "$(PLATFORM)/Makefile.am"

From 88aeafd05df9f04c9ffbb2cc18f6cd744b05fa99 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Thu, 13 Jun 2019 14:22:31 +0200
Subject: [PATCH 11/23] [depends] refresh libsdl patches

---
 .../target/libsdl/01-SDL_SetWidthHeight.patch | 23 ++++++++-----------
 .../libsdl/02-OSX_interpretKeyEvents.patch    |  6 ++---
 .../target/libsdl/03-mavericks-compile.patch  |  4 ++--
 .../libsdl/04-fix_external_screen_crash.patch |  8 +++----
 tools/depends/target/libsdl/Makefile          |  8 +++----
 5 files changed, 22 insertions(+), 27 deletions(-)

diff --git a/tools/depends/target/libsdl/01-SDL_SetWidthHeight.patch b/tools/depends/target/libsdl/01-SDL_SetWidthHeight.patch
index 0e260235545c..1ecb5a397394 100644
--- a/tools/depends/target/libsdl/01-SDL_SetWidthHeight.patch
+++ b/tools/depends/target/libsdl/01-SDL_SetWidthHeight.patch
@@ -1,25 +1,20 @@
-Index: include/SDL_video.h
-===================================================================
---- include/SDL_video.h	(revision 4116)
-+++ include/SDL_video.h	(working copy)
-@@ -324,6 +324,11 @@
+--- a/include/SDL_video.h
++++ b/include/SDL_video.h
+@@ -323,6 +323,11 @@
+  */
  extern DECLSPEC SDL_Rect ** SDLCALL SDL_ListModes(SDL_PixelFormat *format, Uint32 flags);
  
- /**
++/**
 +* Alter the width and height of the current surface to the given sizes.
 +*/
 +extern DECLSPEC void SDLCALL SDL_SetWidthHeight(int width, int height);
 +
-+/**
+ /**
   * Set up a video mode with the specified width, height and bits-per-pixel.
   *
-  * If 'bpp' is 0, it is treated as the current display bits per pixel.
-
-Index: src/video/SDL_video.c
-===================================================================
---- src/video/SDL_video.c	(revision 4116)
-+++ src/video/SDL_video.c	(working copy)
-@@ -1956,3 +1956,11 @@
+--- a/src/video/SDL_video.c
++++ b/src/video/SDL_video.c
+@@ -1976,3 +1976,11 @@
  		return(0);
  	}
  }
diff --git a/tools/depends/target/libsdl/02-OSX_interpretKeyEvents.patch b/tools/depends/target/libsdl/02-OSX_interpretKeyEvents.patch
index 7c4c8071e237..0a6ef088b5bb 100644
--- a/tools/depends/target/libsdl/02-OSX_interpretKeyEvents.patch
+++ b/tools/depends/target/libsdl/02-OSX_interpretKeyEvents.patch
@@ -1,6 +1,6 @@
---- src/video/quartz/SDL_QuartzEvents.m	2009-10-13 07:07:14.000000000 +0800
-+++ src/video/quartz/SDL_QuartzEvents.m	2013-08-03 09:12:27.000000000 +0800
-@@ -280,7 +280,11 @@
+--- a/src/video/quartz/SDL_QuartzEvents.m
++++ b/src/video/quartz/SDL_QuartzEvents.m
+@@ -345,7 +345,11 @@
          the scancode/keysym.
      */
      if (SDL_TranslateUNICODE && state == SDL_PRESSED) {
diff --git a/tools/depends/target/libsdl/03-mavericks-compile.patch b/tools/depends/target/libsdl/03-mavericks-compile.patch
index 6b981125d65d..1c00140a7ff9 100644
--- a/tools/depends/target/libsdl/03-mavericks-compile.patch
+++ b/tools/depends/target/libsdl/03-mavericks-compile.patch
@@ -1,5 +1,5 @@
---- src/video/quartz/SDL_QuartzVideo.h	2012-01-19 07:30:06.000000000 +0100
-+++ src/video/quartz/SDL_QuartzVideo.h	2013-10-30 16:35:02.000000000 +0100
+--- a/src/video/quartz/SDL_QuartzVideo.h
++++ b/src/video/quartz/SDL_QuartzVideo.h
 @@ -91,7 +91,9 @@
      CGDirectDisplayID  display;            /* 0 == main display (only support single display) */
      const void         *mode;              /* current mode of the display */
diff --git a/tools/depends/target/libsdl/04-fix_external_screen_crash.patch b/tools/depends/target/libsdl/04-fix_external_screen_crash.patch
index b474e3a3b311..82bb364b7044 100644
--- a/tools/depends/target/libsdl/04-fix_external_screen_crash.patch
+++ b/tools/depends/target/libsdl/04-fix_external_screen_crash.patch
@@ -1,11 +1,11 @@
---- src/video/quartz/SDL_QuartzWindow.m.orig	2013-10-31 04:29:45.000000000 -0700
-+++ src/video/quartz/SDL_QuartzWindow.m	2013-10-31 04:30:05.000000000 -0700
+--- a/src/video/quartz/SDL_QuartzWindow.m
++++ b/src/video/quartz/SDL_QuartzWindow.m
 @@ -87,7 +87,7 @@
       SDL_VideoDevice *this = (SDL_VideoDevice*)current_video;
-
+     
      /* make sure pixels are fully opaque */
 -    if (! ( SDL_VideoSurface->flags & SDL_OPENGL ) )
 +    if ( SDL_VideoSurface && ! ( SDL_VideoSurface->flags & SDL_OPENGL ) )
          QZ_SetPortAlphaOpaque ();
-
+     
      /* save current visible SDL surface */
diff --git a/tools/depends/target/libsdl/Makefile b/tools/depends/target/libsdl/Makefile
index e53991565025..d77b5e1e6fc4 100644
--- a/tools/depends/target/libsdl/Makefile
+++ b/tools/depends/target/libsdl/Makefile
@@ -23,10 +23,10 @@ $(TARBALLS_LOCATION)/$(ARCHIVE):
 $(PLATFORM): $(TARBALLS_LOCATION)/$(ARCHIVE) $(DEPS)
 	rm -rf $(PLATFORM); mkdir -p $(PLATFORM)
 	cd $(PLATFORM); $(ARCHIVE_TOOL) $(ARCHIVE_TOOL_FLAGS) $(TARBALLS_LOCATION)/$(ARCHIVE)
-	cd $(PLATFORM); patch -p0 < ../01-SDL_SetWidthHeight.patch
-	cd $(PLATFORM); patch -p0 < ../02-OSX_interpretKeyEvents.patch
-	cd $(PLATFORM); patch -p0 < ../03-mavericks-compile.patch
-	cd $(PLATFORM); patch -p0 < ../04-fix_external_screen_crash.patch
+	cd $(PLATFORM); patch -p1 -i ../01-SDL_SetWidthHeight.patch
+	cd $(PLATFORM); patch -p1 -i ../02-OSX_interpretKeyEvents.patch
+	cd $(PLATFORM); patch -p1 -i ../03-mavericks-compile.patch
+	cd $(PLATFORM); patch -p1 -i ../04-fix_external_screen_crash.patch
 	cd $(PLATFORM); ./autogen.sh
 	cd $(PLATFORM); $(CONFIGURE)
 

From 967249a90fa218f04eab6cdcb4d2f6af8f1edcc1 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Thu, 13 Jun 2019 14:22:31 +0200
Subject: [PATCH 12/23] [depends] refresh libusb patches

---
 tools/depends/target/libusb/no-Werror.patch | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/tools/depends/target/libusb/no-Werror.patch b/tools/depends/target/libusb/no-Werror.patch
index def6d2127e8d..0bbaebb02e67 100644
--- a/tools/depends/target/libusb/no-Werror.patch
+++ b/tools/depends/target/libusb/no-Werror.patch
@@ -1,5 +1,5 @@
---- x86_64-linux-gnu-debug/Makefile.in 2006-03-04 03:54:03.000000000 +0100
-+++ 2/Makefile.in      2017-08-05 23:16:06.385493550 +0200
+--- a/Makefile.in
++++ b/Makefile.in
 @@ -257,7 +257,7 @@
  # gnu strictness chokes on README being autogenerated
  AUTOMAKE_OPTIONS = 1.4 foreign

From 37d17eb5a43e8737a7ab1ba2ffa9c015a1c1d331 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Thu, 13 Jun 2019 14:22:31 +0200
Subject: [PATCH 13/23] [depends] refresh mariadb patches

---
 tools/depends/target/mariadb/01-android.patch | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/tools/depends/target/mariadb/01-android.patch b/tools/depends/target/mariadb/01-android.patch
index 65ca2d31537a..1087cd5dd8ff 100644
--- a/tools/depends/target/mariadb/01-android.patch
+++ b/tools/depends/target/mariadb/01-android.patch
@@ -50,7 +50,7 @@
  
 --- a/libmariadb/CMakeLists.txt
 +++ b/libmariadb/CMakeLists.txt
-@@ -291,7 +291,6 @@ ELSE()
+@@ -291,7 +291,6 @@
    IF(ICONV_INCLUDE_DIR)
       INCLUDE_DIRECTORIES(BEFORE ${ICONV_INCLUDE_DIR}) 
    ENDIF()

From b645a4ee8727906959050bfd68c55354dd8ef9fd Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Thu, 13 Jun 2019 14:22:31 +0200
Subject: [PATCH 14/23] [depends] refresh nettle patches

---
 tools/depends/target/nettle/01-disable_testsuite.patch | 8 ++++----
 tools/depends/target/nettle/Makefile                   | 2 +-
 2 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/tools/depends/target/nettle/01-disable_testsuite.patch b/tools/depends/target/nettle/01-disable_testsuite.patch
index 97b1d47f97e4..b734d306be0d 100644
--- a/tools/depends/target/nettle/01-disable_testsuite.patch
+++ b/tools/depends/target/nettle/01-disable_testsuite.patch
@@ -1,8 +1,8 @@
---- Makefile.in.orig	2015-04-11 15:11:40.000000000 +0200
-+++ Makefile.in	2015-04-11 15:11:47.000000000 +0200
-@@ -16,7 +16,7 @@
+--- a/Makefile.in
++++ b/Makefile.in
+@@ -17,7 +17,7 @@
  
- OPT_ASM_SOURCES = @OPT_ASM_SOURCES@
+ OPT_NETTLE_SOURCES = @OPT_NETTLE_SOURCES@
  
 -SUBDIRS = tools testsuite examples
 +SUBDIRS = tools examples
diff --git a/tools/depends/target/nettle/Makefile b/tools/depends/target/nettle/Makefile
index 4808ee036d87..a559b1c33d10 100644
--- a/tools/depends/target/nettle/Makefile
+++ b/tools/depends/target/nettle/Makefile
@@ -25,7 +25,7 @@ $(TARBALLS_LOCATION)/$(ARCHIVE):
 $(PLATFORM): $(TARBALLS_LOCATION)/$(ARCHIVE) $(DEPS)
 	rm -rf $(PLATFORM)/*; mkdir -p $(PLATFORM)
 	cd $(PLATFORM); $(ARCHIVE_TOOL) $(ARCHIVE_TOOL_FLAGS) $(TARBALLS_LOCATION)/$(ARCHIVE)
-	cd $(PLATFORM); patch -p0 < ../01-disable_testsuite.patch
+	cd $(PLATFORM); patch -p1 -i ../01-disable_testsuite.patch
 	cd $(PLATFORM); $(CONFIGURE) CCPIC=" "
 
 $(LIBDYLIB): $(PLATFORM)

From aad58c5bdd7a5ed321eeee3505887fcb978c459f Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Thu, 13 Jun 2019 14:22:31 +0200
Subject: [PATCH 15/23] [depends] refresh python27 patches

---
 tools/depends/target/python27/Makefile | 22 +++++++++++-----------
 1 file changed, 11 insertions(+), 11 deletions(-)

diff --git a/tools/depends/target/python27/Makefile b/tools/depends/target/python27/Makefile
index 5016342cc768..b38fc0dc1454 100644
--- a/tools/depends/target/python27/Makefile
+++ b/tools/depends/target/python27/Makefile
@@ -33,18 +33,18 @@ $(PLATFORM): $(TARBALLS_LOCATION)/$(ARCHIVE) $(DEPS)
 	echo $(NATIVEPREFIX)
 	rm -rf $(PLATFORM)/*; mkdir -p $(PLATFORM)
 	cd $(PLATFORM); $(ARCHIVE_TOOL) $(ARCHIVE_TOOL_FLAGS) $(TARBALLS_LOCATION)/$(ARCHIVE)
-	cd $(PLATFORM); patch -p1 < ../crosscompile.patch
-	cd $(PLATFORM); patch -p1 < ../setup.patch
-	cd $(PLATFORM); patch -p1 < ../fix-datetime.patch
-	cd $(PLATFORM); patch -p1 < ../android.patch
-	cd $(PLATFORM); patch -p1 < ../no-export-path.patch
-	cd $(PLATFORM); patch -p1 < ../fix-ffi.patch
-	cd $(PLATFORM); patch -p1 < ../android-binmodule.patch
-	cd $(PLATFORM); patch -p1 < ../no-abort.patch
-	cd $(PLATFORM); patch -p1 < ../android-nl_langinfo.patch
+	cd $(PLATFORM); patch -p1 -i ../crosscompile.patch
+	cd $(PLATFORM); patch -p1 -i ../setup.patch
+	cd $(PLATFORM); patch -p1 -i ../fix-datetime.patch
+	cd $(PLATFORM); patch -p1 -i ../android.patch
+	cd $(PLATFORM); patch -p1 -i ../no-export-path.patch
+	cd $(PLATFORM); patch -p1 -i ../fix-ffi.patch
+	cd $(PLATFORM); patch -p1 -i ../android-binmodule.patch
+	cd $(PLATFORM); patch -p1 -i ../no-abort.patch
+	cd $(PLATFORM); patch -p1 -i ../android-nl_langinfo.patch
 ifeq ($(OS),ios)
-	cd $(PLATFORM); patch -p1 < ../make-fork-optional.patch
-	cd $(PLATFORM); patch -p1 < ../urllib.patch
+	cd $(PLATFORM); patch -p1 -i ../make-fork-optional.patch
+	cd $(PLATFORM); patch -p1 -i ../urllib.patch
 	cd $(PLATFORM); sed -ie 's|MACHDEP="unknown"|MACHDEP="darwin"|' configure.ac
 endif
 	cp modules.setup $(PLATFORM)/Modules/Setup.dist

From dc3477509b169e8858479225adf44d91151937a0 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Thu, 13 Jun 2019 14:22:31 +0200
Subject: [PATCH 16/23] [depends] refresh pythonmodule-pil patches

---
 .../depends/target/pythonmodule-pil/Makefile  |  2 +-
 .../pillow-crosscompile.patch                 | 29 +++++++++----------
 2 files changed, 15 insertions(+), 16 deletions(-)

diff --git a/tools/depends/target/pythonmodule-pil/Makefile b/tools/depends/target/pythonmodule-pil/Makefile
index addd67498c75..10ce08718543 100644
--- a/tools/depends/target/pythonmodule-pil/Makefile
+++ b/tools/depends/target/pythonmodule-pil/Makefile
@@ -40,7 +40,7 @@ $(TARBALLS_LOCATION)/$(ARCHIVE):
 $(PLATFORM): $(TARBALLS_LOCATION)/$(ARCHIVE) $(DEPS)
 	rm -rf $(PLATFORM)/*; mkdir -p $(PLATFORM)
 	cd $(PLATFORM); $(ARCHIVE_TOOL) $(ARCHIVE_TOOL_FLAGS) $(TARBALLS_LOCATION)/$(ARCHIVE)
-	cd $(PLATFORM); patch -p0 < ../pillow-crosscompile.patch
+	cd $(PLATFORM); patch -p1 -i ../pillow-crosscompile.patch
 
 $(LIBDYLIB): $(PLATFORM)
 	mkdir -p $(PLATFORM)/output
diff --git a/tools/depends/target/pythonmodule-pil/pillow-crosscompile.patch b/tools/depends/target/pythonmodule-pil/pillow-crosscompile.patch
index 86e1a914f700..7a3b1a440ad6 100644
--- a/tools/depends/target/pythonmodule-pil/pillow-crosscompile.patch
+++ b/tools/depends/target/pythonmodule-pil/pillow-crosscompile.patch
@@ -1,5 +1,5 @@
---- setup.py.orig	2015-10-01 22:39:00.000000000 +0200
-+++ setup.py	2015-10-25 12:28:22.023743244 +0100
+--- a/setup.py
++++ b/setup.py
 @@ -156,6 +156,16 @@
  
          _add_directory(include_dirs, "libImaging")
@@ -17,7 +17,7 @@
          #
          # add configured kits
  
-@@ -187,10 +196,11 @@
+@@ -187,10 +197,11 @@
                  for d in os.environ[k].split(os.path.pathsep):
                      _add_directory(library_dirs, d)
  
@@ -30,7 +30,7 @@
  
          #
          # add platform directories
-@@ -202,14 +212,14 @@
+@@ -202,14 +213,14 @@
  
          elif sys.platform == "darwin":
              # attempt to make sure we pick freetype2 over other versions
@@ -51,7 +51,7 @@
  
              # if Homebrew is installed, use its lib and include directories
              import subprocess
-@@ -234,15 +244,15 @@
+@@ -234,15 +245,15 @@
                  _add_directory(library_dirs, os.path.join(ft_prefix, 'lib'))
                  _add_directory(
                      include_dirs, os.path.join(ft_prefix, 'include'))
@@ -71,7 +71,7 @@
                  # 32 bit build on 64 bit machine.
                  _add_directory(library_dirs, "/usr/lib/i386-linux-gnu")
              else:
-@@ -252,43 +262,43 @@
+@@ -252,43 +263,43 @@
                          continue
  
                      if platform_ in ["x86_64", "64bit"]:
@@ -138,7 +138,7 @@
                          break
                  else:
                      raise ValueError(
-@@ -297,18 +307,18 @@
+@@ -297,18 +308,18 @@
              # XXX Kludge. Above /\ we brute force support multiarch. Here we
              # try Barry's more general approach. Afterward, something should
              # work ;-)
@@ -153,21 +153,20 @@
 -        elif sys.platform.startswith("netbsd"):
 -            _add_directory(library_dirs, "/usr/pkg/lib")
 -            _add_directory(include_dirs, "/usr/pkg/include")
--
--        elif sys.platform.startswith("sunos5"):
--                    _add_directory(library_dirs, "/opt/local/lib")
--                    _add_directory(include_dirs, "/opt/local/include")
 +        #elif sys.platform.startswith("netbsd"):
 +            #_add_directory(library_dirs, "/usr/pkg/lib")
 +            #_add_directory(include_dirs, "/usr/pkg/include")
-+
+ 
+-        elif sys.platform.startswith("sunos5"):
+-                    _add_directory(library_dirs, "/opt/local/lib")
+-                    _add_directory(include_dirs, "/opt/local/include")
 +        #elif sys.platform.startswith("sunos5"):
 +                    #_add_directory(library_dirs, "/opt/local/lib")
 +                    #_add_directory(include_dirs, "/opt/local/include")
  
          # FIXME: check /opt/stuff directories here?
  
-@@ -350,11 +360,11 @@
+@@ -350,11 +361,11 @@
                  _add_directory(include_dirs, tcl_dir)
  
          # standard locations
@@ -183,7 +182,7 @@
  
          # on Windows, look for the OpenJPEG libraries in the location that
          # the official installer puts them
-@@ -389,12 +399,7 @@
+@@ -389,12 +400,7 @@
          feature = self.feature
  
          if feature.want('zlib'):
@@ -197,7 +196,7 @@
  
          if feature.want('jpeg'):
              if _find_include_file(self, "jpeglib.h"):
-@@ -552,7 +557,7 @@
+@@ -552,7 +558,7 @@
  
          if feature.freetype:
              exts.append(Extension(

From 9faa6c11d745c797709fd2693c03d51b8d8a2fa8 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Thu, 13 Jun 2019 14:22:31 +0200
Subject: [PATCH 17/23] [depends] refresh pythonmodule-pycryptodome patches

---
 .../target/pythonmodule-pycryptodome/01-nosetuptool.patch   | 4 ++--
 .../pythonmodule-pycryptodome/02-android-dlopen.patch       | 4 ++--
 .../03-obey-crosscompileflags.patch                         | 4 ++--
 tools/depends/target/pythonmodule-pycryptodome/Makefile     | 6 +++---
 4 files changed, 9 insertions(+), 9 deletions(-)

diff --git a/tools/depends/target/pythonmodule-pycryptodome/01-nosetuptool.patch b/tools/depends/target/pythonmodule-pycryptodome/01-nosetuptool.patch
index 078b0659331b..412a9c5d08d0 100644
--- a/tools/depends/target/pythonmodule-pycryptodome/01-nosetuptool.patch
+++ b/tools/depends/target/pythonmodule-pycryptodome/01-nosetuptool.patch
@@ -1,5 +1,5 @@
---- setup_o.py	2017-01-18 17:54:03.361747272 +0100
-+++ setup.py	2017-01-18 17:54:33.337935416 +0100
+--- a/setup.py
++++ b/setup.py
 @@ -20,10 +20,10 @@
  # SOFTWARE.
  # ===================================================================
diff --git a/tools/depends/target/pythonmodule-pycryptodome/02-android-dlopen.patch b/tools/depends/target/pythonmodule-pycryptodome/02-android-dlopen.patch
index 2253426e7c72..dd9a20667fb9 100644
--- a/tools/depends/target/pythonmodule-pycryptodome/02-android-dlopen.patch
+++ b/tools/depends/target/pythonmodule-pycryptodome/02-android-dlopen.patch
@@ -1,5 +1,5 @@
---- lib/Crypto/Util/_raw_api_o.py	2017-01-19 07:49:10.126996702 +0100
-+++ lib/Crypto/Util/_raw_api.py	2017-01-19 11:16:23.126321052 +0100
+--- a/lib/Crypto/Util/_raw_api.py
++++ b/lib/Crypto/Util/_raw_api.py
 @@ -101,11 +101,14 @@
      def load_lib(name, cdecl):
          import platform
diff --git a/tools/depends/target/pythonmodule-pycryptodome/03-obey-crosscompileflags.patch b/tools/depends/target/pythonmodule-pycryptodome/03-obey-crosscompileflags.patch
index e1bb1b3b3b8b..5b098c2b24ce 100644
--- a/tools/depends/target/pythonmodule-pycryptodome/03-obey-crosscompileflags.patch
+++ b/tools/depends/target/pythonmodule-pycryptodome/03-obey-crosscompileflags.patch
@@ -1,5 +1,5 @@
---- setup.py.orig	2017-10-27 15:26:56.000000000 +0200
-+++ setup.py	2017-10-27 15:28:34.000000000 +0200
+--- a/setup.py
++++ b/setup.py
 @@ -266,6 +266,16 @@
          # Disable any assembly in libtomcrypt files
          self.compiler.define_macro("LTC_NO_ASM")
diff --git a/tools/depends/target/pythonmodule-pycryptodome/Makefile b/tools/depends/target/pythonmodule-pycryptodome/Makefile
index 2c53295eb42b..583b2d92f90b 100644
--- a/tools/depends/target/pythonmodule-pycryptodome/Makefile
+++ b/tools/depends/target/pythonmodule-pycryptodome/Makefile
@@ -37,11 +37,11 @@ $(TARBALLS_LOCATION)/$(ARCHIVE):
 $(PLATFORM): $(TARBALLS_LOCATION)/$(ARCHIVE) $(DEPS)
 	rm -rf $(PLATFORM)/*; mkdir -p $(PLATFORM)
 	cd $(PLATFORM); $(ARCHIVE_TOOL) $(ARCHIVE_TOOL_FLAGS) $(TARBALLS_LOCATION)/$(ARCHIVE)
-	cd $(PLATFORM); patch -p0 < ../01-nosetuptool.patch
+	cd $(PLATFORM); patch -p1 -i ../01-nosetuptool.patch
 ifeq ($(OS),android)
-	cd $(PLATFORM); patch -p0 < ../02-android-dlopen.patch
+	cd $(PLATFORM); patch -p1 -i ../02-android-dlopen.patch
 endif
-	cd $(PLATFORM); patch -p0 < ../03-obey-crosscompileflags.patch
+	cd $(PLATFORM); patch -p1 -i ../03-obey-crosscompileflags.patch
 
 $(LIBDYLIB): $(PLATFORM)
 	mkdir -p $(PLATFORM)/output

From 8bff74b6c35696bf73e5d6be28f77a57ed932ea0 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Thu, 13 Jun 2019 14:22:31 +0200
Subject: [PATCH 18/23] [depends] refresh rapidjson patches

---
 .../target/rapidjson/0001-remove_custom_cxx_flags.patch  | 9 +++------
 tools/depends/target/rapidjson/Makefile                  | 2 +-
 2 files changed, 4 insertions(+), 7 deletions(-)

diff --git a/tools/depends/target/rapidjson/0001-remove_custom_cxx_flags.patch b/tools/depends/target/rapidjson/0001-remove_custom_cxx_flags.patch
index 51434ff52eee..c923c763801d 100644
--- a/tools/depends/target/rapidjson/0001-remove_custom_cxx_flags.patch
+++ b/tools/depends/target/rapidjson/0001-remove_custom_cxx_flags.patch
@@ -1,8 +1,6 @@
-diff --git a/CMakeLists.txt b/CMakeLists.txt
-index ceda71b..efb259e 100644
 --- a/CMakeLists.txt
 +++ b/CMakeLists.txt
-@@ -50,7 +50,6 @@ if(CCACHE_FOUND)
+@@ -50,7 +50,6 @@
  endif(CCACHE_FOUND)
  
  if ("${CMAKE_CXX_COMPILER_ID}" STREQUAL "GNU")
@@ -10,7 +8,7 @@ index ceda71b..efb259e 100644
      if (RAPIDJSON_BUILD_CXX11)
          if (CMAKE_CXX_COMPILER_VERSION VERSION_LESS "4.7.0")
              set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++0x")
-@@ -73,7 +72,6 @@ if ("${CMAKE_CXX_COMPILER_ID}" STREQUAL "GNU")
+@@ -73,7 +72,6 @@
          endif()
      endif()
  elseif (CMAKE_CXX_COMPILER_ID MATCHES "Clang")
@@ -18,7 +16,7 @@ index ceda71b..efb259e 100644
      if (RAPIDJSON_BUILD_CXX11)
          set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++11")
      endif()
-@@ -88,7 +86,6 @@ elseif (CMAKE_CXX_COMPILER_ID MATCHES "Clang")
+@@ -88,7 +86,6 @@
          endif()
      endif()
  elseif ("${CMAKE_CXX_COMPILER_ID}" STREQUAL "MSVC")
@@ -26,4 +24,3 @@ index ceda71b..efb259e 100644
      set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} /EHsc")
  endif()
  
-
diff --git a/tools/depends/target/rapidjson/Makefile b/tools/depends/target/rapidjson/Makefile
index b54af9190c16..0939ed57579c 100644
--- a/tools/depends/target/rapidjson/Makefile
+++ b/tools/depends/target/rapidjson/Makefile
@@ -42,7 +42,7 @@ endif
 	rm -rf $(PLATFORM); mkdir -p $(PLATFORM)
 	cd $(PLATFORM); $(ARCHIVE_TOOL) $(ARCHIVE_TOOL_FLAGS) $(TARBALLS_LOCATION)/$(ARCHIVE)
 	cd $(PLATFORM); rm -rf build; mkdir -p build
-	cd $(PLATFORM); patch -p1 < ../0001-remove_custom_cxx_flags.patch
+	cd $(PLATFORM); patch -p1 -i ../0001-remove_custom_cxx_flags.patch
 	cd $(PLATFORM)/build; $(CMAKE) $(CMAKE_OPTIONS) ..
 
 .installed-$(PLATFORM): $(PLATFORM)

From 99a0843b3a60860aa7046ac02a5d9fccf78633f4 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Thu, 13 Jun 2019 14:22:31 +0200
Subject: [PATCH 19/23] [depends] refresh samba patches

---
 tools/depends/target/samba/Makefile           | 12 +++---
 .../samba/samba30-3.0.37-CVE-2010-2063.patch  |  8 ++--
 .../samba/samba30-3.0.37-configure.in.patch   | 41 +++++++++---------
 ...mba30-3.0.37-silence-receive-warning.patch |  4 +-
 .../samba/samba30-3.0.37-vfs_default.c.patch  |  4 +-
 .../target/samba/samba30-3.0.37-wle-fix.patch | 10 ++---
 .../depends/target/samba/samba_android.patch  | 43 ++++++++-----------
 7 files changed, 54 insertions(+), 68 deletions(-)

diff --git a/tools/depends/target/samba/Makefile b/tools/depends/target/samba/Makefile
index 2161a13832a8..f8f4c4fda043 100644
--- a/tools/depends/target/samba/Makefile
+++ b/tools/depends/target/samba/Makefile
@@ -55,12 +55,12 @@ $(TARBALLS_LOCATION)/$(ARCHIVE):
 $(PLATFORM): $(TARBALLS_LOCATION)/$(ARCHIVE) $(DEPS)
 	rm -rf $(PLATFORM); mkdir -p $(PLATFORM)
 	cd $(PLATFORM); $(ARCHIVE_TOOL) $(ARCHIVE_TOOL_FLAGS) $(TARBALLS_LOCATION)/$(ARCHIVE)
-	cd $(PLATFORM); patch -p1 < ../samba30-3.0.37-configure.in.patch
-	cd $(PLATFORM); patch -p1 < ../samba30-3.0.37-CVE-2010-2063.patch
-	cd $(PLATFORM); patch -p1 < ../samba30-3.0.37-silence-receive-warning.patch
-	cd $(PLATFORM); patch -p1 < ../samba30-3.0.37-vfs_default.c.patch
-	cd $(PLATFORM); patch -p1 < ../samba30-3.0.37-wle-fix.patch
-	cd $(PLATFORM); patch -p0 < ../samba_android.patch
+	cd $(PLATFORM); patch -p1 -i ../samba30-3.0.37-configure.in.patch
+	cd $(PLATFORM); patch -p1 -i ../samba30-3.0.37-CVE-2010-2063.patch
+	cd $(PLATFORM); patch -p1 -i ../samba30-3.0.37-silence-receive-warning.patch
+	cd $(PLATFORM); patch -p1 -i ../samba30-3.0.37-vfs_default.c.patch
+	cd $(PLATFORM); patch -p1 -i ../samba30-3.0.37-wle-fix.patch
+	cd $(PLATFORM); patch -p1 -i ../samba_android.patch
 	$(ANDROID_OFF_T_FIX)
 	cd $(PLATFORM)/source && ./autogen.sh
 	cd $(PLATFORM)/source; $(CONFIGURE)
diff --git a/tools/depends/target/samba/samba30-3.0.37-CVE-2010-2063.patch b/tools/depends/target/samba/samba30-3.0.37-CVE-2010-2063.patch
index b4657de2c031..a432c88afefa 100644
--- a/tools/depends/target/samba/samba30-3.0.37-CVE-2010-2063.patch
+++ b/tools/depends/target/samba/samba30-3.0.37-CVE-2010-2063.patch
@@ -1,8 +1,6 @@
-diff --git a/source/smbd/process.c b/source/smbd/process.c
-index e861e16..6499bc7 100644
 --- a/source/smbd/process.c
 +++ b/source/smbd/process.c
-@@ -1159,6 +1159,7 @@ int chain_reply(char *inbuf,char *outbuf,int size,int bufsize)
+@@ -1159,6 +1159,7 @@
  {
  	static char *orig_inbuf;
  	static char *orig_outbuf;
@@ -10,7 +8,7 @@ index e861e16..6499bc7 100644
  	int smb_com1, smb_com2 = CVAL(inbuf,smb_vwv0);
  	unsigned smb_off2 = SVAL(inbuf,smb_vwv1);
  	char *inbuf2, *outbuf2;
-@@ -1178,6 +1179,13 @@ int chain_reply(char *inbuf,char *outbuf,int size,int bufsize)
+@@ -1178,6 +1179,13 @@
  		/* this is the first part of the chain */
  		orig_inbuf = inbuf;
  		orig_outbuf = outbuf;
@@ -24,7 +22,7 @@ index e861e16..6499bc7 100644
  	}
  
  	/*
-@@ -1192,6 +1200,11 @@ int chain_reply(char *inbuf,char *outbuf,int size,int bufsize)
+@@ -1192,6 +1200,11 @@
  	SSVAL(outbuf,smb_vwv1,smb_offset(outbuf+outsize,outbuf));
  	SCVAL(outbuf,smb_vwv0,smb_com2);
  
diff --git a/tools/depends/target/samba/samba30-3.0.37-configure.in.patch b/tools/depends/target/samba/samba30-3.0.37-configure.in.patch
index 3af1e125fcc2..6843081cce5a 100644
--- a/tools/depends/target/samba/samba30-3.0.37-configure.in.patch
+++ b/tools/depends/target/samba/samba30-3.0.37-configure.in.patch
@@ -1,6 +1,6 @@
---- samba-3.0.25borig/source/configure.in	2007-05-23 08:29:20.000000000 -0700
-+++ samba3025bfinal/source/configure.in	2007-07-24 12:15:13.000000000 -0700
-@@ -1374,31 +1374,40 @@
+--- a/source/configure.in
++++ b/source/configure.in
+@@ -1388,31 +1388,40 @@
  #
  case "$host_os" in
      *linux*)
@@ -24,12 +24,26 @@
 -       int libc_minor = __GLIBC_MINOR__;
 +                            int libc_major = __GLIBC__;
 +                            int libc_minor = __GLIBC_MINOR__;
-+
+ 
+-       if (libc_major < 2)
+-              exit(1);
+-       if ((libc_major == 2) && (libc_minor <= 3))
+-              exit(1);
 +                            if (libc_major < 2)
 +                                   return 1;
 +                            if ((libc_major == 2) && (libc_minor <= 3))
 +                                   return 1;
-+#endif
+ #endif
+-       exit(0);
+-}
+-], [linux_getgrouplist_ok=yes], [linux_getgrouplist_ok=no])
+-       if test x"$linux_getgrouplist_ok" = x"yes"; then
+-          AC_DEFINE(HAVE_GETGROUPLIST, 1, [Have good getgrouplist])
+-       fi
+-       ;;
+-    *)
+-       AC_CHECK_FUNCS(getgrouplist)
+-       ;;
 +                            return 0;
 +                     }
 +
@@ -43,22 +57,7 @@
 +           AC_DEFINE(HAVE_GETGROUPLIST, 1, [Have good getgrouplist])
 +        fi
 +
- 
--       if (libc_major < 2)
--              exit(1);
--       if ((libc_major == 2) && (libc_minor <= 3))
--              exit(1);
--#endif
--       exit(0);
--}
--], [linux_getgrouplist_ok=yes], [linux_getgrouplist_ok=no])
--       if test x"$linux_getgrouplist_ok" = x"yes"; then
--          AC_DEFINE(HAVE_GETGROUPLIST, 1, [Have good getgrouplist])
--       fi
--       ;;
--    *)
--       AC_CHECK_FUNCS(getgrouplist)
--       ;;
++
  esac
  
  #
diff --git a/tools/depends/target/samba/samba30-3.0.37-silence-receive-warning.patch b/tools/depends/target/samba/samba30-3.0.37-silence-receive-warning.patch
index 92b84336c833..b2080431eb6e 100644
--- a/tools/depends/target/samba/samba30-3.0.37-silence-receive-warning.patch
+++ b/tools/depends/target/samba/samba30-3.0.37-silence-receive-warning.patch
@@ -1,5 +1,5 @@
---- samba-3.0.37-clean/source/libsmb/clientgen.c	2009-09-30 05:21:56.000000000 -0700
-+++ samba-3.0.37/source/libsmb/clientgen.c	2010-11-18 21:56:06.874516928 -0800
+--- a/source/libsmb/clientgen.c
++++ b/source/libsmb/clientgen.c
 @@ -108,7 +108,7 @@
  
  	/* If the server is not responding, note that now */
diff --git a/tools/depends/target/samba/samba30-3.0.37-vfs_default.c.patch b/tools/depends/target/samba/samba30-3.0.37-vfs_default.c.patch
index 7a640ecb8554..ec592483de47 100644
--- a/tools/depends/target/samba/samba30-3.0.37-vfs_default.c.patch
+++ b/tools/depends/target/samba/samba30-3.0.37-vfs_default.c.patch
@@ -1,5 +1,5 @@
---- samba-3.0.25borig/source/modules/vfs_default.c	2007-04-09 10:30:58.000000000 -0700
-+++ samba3025bfinal/source/modules/vfs_default.c	2007-07-24 12:18:07.000000000 -0700
+--- a/source/modules/vfs_default.c
++++ b/source/modules/vfs_default.c
 @@ -813,10 +813,11 @@
  
  	START_PROFILE(syscall_linux_setlease);
diff --git a/tools/depends/target/samba/samba30-3.0.37-wle-fix.patch b/tools/depends/target/samba/samba30-3.0.37-wle-fix.patch
index 8a41f455a309..688280ef23b7 100644
--- a/tools/depends/target/samba/samba30-3.0.37-wle-fix.patch
+++ b/tools/depends/target/samba/samba30-3.0.37-wle-fix.patch
@@ -1,6 +1,5 @@
-diff -r -u samba-3.0.37-clean/source/libsmb/asn1.c samba-3.0.37/source/libsmb/asn1.c
---- samba-3.0.37-clean/source/libsmb/asn1.c	2009-09-30 05:21:56.000000000 -0700
-+++ samba-3.0.37/source/libsmb/asn1.c	2010-11-18 12:40:06.981517350 -0800
+--- a/source/libsmb/asn1.c
++++ b/source/libsmb/asn1.c
 @@ -261,6 +261,36 @@
  	return asn1_read(data, v, 1);
  }
@@ -38,9 +37,8 @@ diff -r -u samba-3.0.37-clean/source/libsmb/asn1.c samba-3.0.37/source/libsmb/as
  /* start reading a nested asn1 structure */
  BOOL asn1_start_tag(ASN1_DATA *data, uint8 tag)
  {
-diff -r -u samba-3.0.37-clean/source/libsmb/clispnego.c samba-3.0.37/source/libsmb/clispnego.c
---- samba-3.0.37-clean/source/libsmb/clispnego.c	2009-09-30 05:21:56.000000000 -0700
-+++ samba-3.0.37/source/libsmb/clispnego.c	2010-11-18 12:52:54.833518134 -0800
+--- a/source/libsmb/clispnego.c
++++ b/source/libsmb/clispnego.c
 @@ -135,9 +135,16 @@
  
  	asn1_start_tag(&data,ASN1_APPLICATION(0));
diff --git a/tools/depends/target/samba/samba_android.patch b/tools/depends/target/samba/samba_android.patch
index 45c9773bceaa..62600f71b695 100644
--- a/tools/depends/target/samba/samba_android.patch
+++ b/tools/depends/target/samba/samba_android.patch
@@ -1,6 +1,5 @@
-diff -ruN source/lib/fault.c source/lib/fault.c
---- source/lib/fault.c	2009-09-30 08:21:56.000000000 -0400
-+++ source/lib/fault.c	2013-01-14 20:14:16.393077102 -0500
+--- a/source/lib/fault.c
++++ b/source/lib/fault.c
 @@ -136,7 +136,7 @@
  #endif
  #endif
@@ -10,9 +9,8 @@ diff -ruN source/lib/fault.c source/lib/fault.c
  	/* On Linux we lose the ability to dump core when we change our user
  	 * ID. We know how to dump core safely, so let's make sure we have our
  	 * dumpable flag set.
-diff -ruN source/lib/iconv.c source/lib/iconv.c
---- source/lib/iconv.c	2009-09-30 08:21:56.000000000 -0400
-+++ source/lib/iconv.c	2013-01-14 20:33:18.813076383 -0500
+--- a/source/lib/iconv.c
++++ b/source/lib/iconv.c
 @@ -20,7 +20,10 @@
  */
  
@@ -45,9 +43,8 @@ diff -ruN source/lib/iconv.c source/lib/iconv.c
  static size_t iconv_swab(void *cd, const char **inbuf, size_t *inbytesleft,
  			 char **outbuf, size_t *outbytesleft)
  {
-diff -ruN source/lib/replace/system/passwd.h source/lib/replace/system/passwd.h
---- source/lib/replace/system/passwd.h	2009-09-30 08:21:56.000000000 -0400
-+++ source/lib/replace/system/passwd.h	2013-01-14 20:21:58.013076811 -0500
+--- a/source/lib/replace/system/passwd.h
++++ b/source/lib/replace/system/passwd.h
 @@ -62,6 +62,8 @@
  
  #ifdef REPLACE_GETPASS
@@ -57,16 +54,14 @@ diff -ruN source/lib/replace/system/passwd.h source/lib/replace/system/passwd.h
  #endif
  
  #ifndef NGROUPS_MAX
-diff -ruN source/lib/system.c source/lib/system.c
---- source/lib/system.c	2009-09-30 08:21:56.000000000 -0400
-+++ source/lib/system.c	2013-01-14 20:27:18.453076610 -0500
+--- a/source/lib/system.c
++++ b/source/lib/system.c
 @@ -476,7 +476,10 @@
  #if defined(HAVE_EXPLICIT_LARGEFILE_SUPPORT) && defined(HAVE_SEEKDIR64)
  	seekdir64(dirp, offset);
  #else
--	seekdir(dirp, offset);
 +#if !defined(ANDROID)
-+	seekdir(dirp, offset);
+ 	seekdir(dirp, offset);
 +#endif
 +	return;
  #endif
@@ -140,9 +135,8 @@ diff -ruN source/lib/system.c source/lib/system.c
  	unix_to_unicode(retval.pw_dir, pwret->pw_dir, sizeof(retval.pw_dir));
  	unix_to_unicode(retval.pw_shell, pwret->pw_shell, sizeof(retval.pw_shell));
  
-diff -ruN source/lib/util_pw.c source/lib/util_pw.c
---- source/lib/util_pw.c	2009-09-30 08:21:56.000000000 -0400
-+++ source/lib/util_pw.c	2013-01-14 20:17:49.293076968 -0500
+--- a/source/lib/util_pw.c
++++ b/source/lib/util_pw.c
 @@ -32,7 +32,9 @@
  	ret->pw_passwd = talloc_strdup(ret, from->pw_passwd);
  	ret->pw_uid = from->pw_uid;
@@ -153,9 +147,8 @@ diff -ruN source/lib/util_pw.c source/lib/util_pw.c
  	ret->pw_dir = talloc_strdup(ret, from->pw_dir);
  	ret->pw_shell = talloc_strdup(ret, from->pw_shell);
  	return ret;
-diff -ruN source/libads/dns.c source/libads/dns.c
---- source/libads/dns.c	2009-09-30 08:21:56.000000000 -0400
-+++ source/libads/dns.c	2013-01-14 20:14:16.393077102 -0500
+--- a/source/libads/dns.c
++++ b/source/libads/dns.c
 @@ -38,6 +38,15 @@
  
  #define MAX_DNS_PACKET_SIZE 0xffff
@@ -172,9 +165,8 @@ diff -ruN source/libads/dns.c source/libads/dns.c
  #ifdef NS_HFIXEDSZ	/* Bind 8/9 interface */
  #if !defined(C_IN)	/* AIX 5.3 already defines C_IN */
  #  define C_IN		ns_c_in
-diff -ruN source/passdb/passdb.c source/passdb/passdb.c
---- source/passdb/passdb.c	2009-09-30 08:21:56.000000000 -0400
-+++ source/passdb/passdb.c	2013-01-14 20:18:18.533076949 -0500
+--- a/source/passdb/passdb.c
++++ b/source/passdb/passdb.c
 @@ -143,7 +143,9 @@
  	/* Basic properties based upon the Unix account information */
  	
@@ -185,9 +177,8 @@ diff -ruN source/passdb/passdb.c source/passdb/passdb.c
  	pdb_set_domain (user, get_global_sam_name(), PDB_DEFAULT);
  #if 0
  	/* This can lead to a primary group of S-1-22-2-XX which 
-diff -ruN source/passdb/pdb_interface.c source/passdb/pdb_interface.c
---- source/passdb/pdb_interface.c	2009-09-30 08:21:56.000000000 -0400
-+++ source/passdb/pdb_interface.c	2013-01-14 20:14:16.393077102 -0500
+--- a/source/passdb/pdb_interface.c
++++ b/source/passdb/pdb_interface.c
 @@ -1380,8 +1380,8 @@
  	}
  

From fea924bac22b88ad95464de6483903044ae0979c Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Thu, 13 Jun 2019 14:22:31 +0200
Subject: [PATCH 20/23] [depends] refresh samba-gplv3 patches

---
 tools/depends/target/samba-gplv3/Makefile     |  10 +-
 .../target/samba-gplv3/configureEndian.patch  |   4 +-
 .../target/samba-gplv3/crt_extensions.patch   |   6 +-
 .../target/samba-gplv3/no_fork_and_exec.patch | 118 +++++++--------
 .../target/samba-gplv3/samba_android.patch    | 141 ++++++++----------
 5 files changed, 135 insertions(+), 144 deletions(-)

diff --git a/tools/depends/target/samba-gplv3/Makefile b/tools/depends/target/samba-gplv3/Makefile
index c31c19bdd4f1..88625c214f9c 100644
--- a/tools/depends/target/samba-gplv3/Makefile
+++ b/tools/depends/target/samba-gplv3/Makefile
@@ -46,16 +46,16 @@ $(PLATFORM): $(TARBALLS_LOCATION)/$(ARCHIVE) $(DEPS)
 	rm -rf $(PLATFORM); mkdir -p $(PLATFORM)
 	cd $(PLATFORM); $(ARCHIVE_TOOL) $(ARCHIVE_TOOL_FLAGS) $(TARBALLS_LOCATION)/$(ARCHIVE)
 	cd $(PLATFORM); patch -p1 -i ../autotools41.patch
-	cd $(PLATFORM); patch -p0 -i ../configureEndian.patch
+	cd $(PLATFORM); patch -p1 -i ../configureEndian.patch
 	cd $(PLATFORM); chmod +x source3/autogen.sh source3/script/*.sh librpc/build_idl.sh
 	cd $(PLATFORM)/source3; ./autogen.sh
 ifeq ($(OS),android)
-	cd $(PLATFORM); patch -p0 < ../samba_android.patch
-	cd $(PLATFORM); patch -p1 < ../samba_off64_t.patch
+	cd $(PLATFORM); patch -p1 -i ../samba_android.patch
+	cd $(PLATFORM); patch -p1 -i ../samba_off64_t.patch
 endif
 ifeq ($(OS), ios)
-	cd $(PLATFORM); patch -p0 < ../no_fork_and_exec.patch
-	cd $(PLATFORM); patch -p0 < ../crt_extensions.patch
+	cd $(PLATFORM); patch -p1 -i ../no_fork_and_exec.patch
+	cd $(PLATFORM); patch -p1 -i ../crt_extensions.patch
 endif
 ifeq (darwin, $(findstring darwin, $(HOST)))
 	sed -ie "s|ifndef HAVE_CLOCK_GETTIME|if !defined(HAVE_CLOCK_GETTIME) \&\& !defined(CLOCK_REALTIME)|" "$(PLATFORM)/lib/replace/system/time.h"
diff --git a/tools/depends/target/samba-gplv3/configureEndian.patch b/tools/depends/target/samba-gplv3/configureEndian.patch
index b50179219f04..999b71836989 100644
--- a/tools/depends/target/samba-gplv3/configureEndian.patch
+++ b/tools/depends/target/samba-gplv3/configureEndian.patch
@@ -1,5 +1,5 @@
---- lib/ccan/libccan.m4
-+++ lib/ccan/libccan.m4
+--- a/lib/ccan/libccan.m4
++++ b/lib/ccan/libccan.m4
 @@ -121,16 +121,9 @@
  	     [whether we can compile with __attribute__((used))])
  fi
diff --git a/tools/depends/target/samba-gplv3/crt_extensions.patch b/tools/depends/target/samba-gplv3/crt_extensions.patch
index 3b327cf4a61e..51c80488dfad 100644
--- a/tools/depends/target/samba-gplv3/crt_extensions.patch
+++ b/tools/depends/target/samba-gplv3/crt_extensions.patch
@@ -1,6 +1,6 @@
---- lib/replace/replace.h	2017-09-25 19:50:26.000000000 +0200
-+++ lib/replace/replace.h	2017-09-25 19:48:25.000000000 +0200
-@@ -197,7 +197,7 @@
+--- a/lib/replace/replace.h
++++ b/lib/replace/replace.h
+@@ -257,7 +257,7 @@
  
  #if !HAVE_DECL_ENVIRON
  #ifdef __APPLE__
diff --git a/tools/depends/target/samba-gplv3/no_fork_and_exec.patch b/tools/depends/target/samba-gplv3/no_fork_and_exec.patch
index 4c5a1aebac7f..739d0e83f17f 100644
--- a/tools/depends/target/samba-gplv3/no_fork_and_exec.patch
+++ b/tools/depends/target/samba-gplv3/no_fork_and_exec.patch
@@ -1,5 +1,5 @@
---- lib/util/become_daemon.c
-+++ lib/util/become_daemon.c
+--- a/lib/util/become_daemon.c
++++ b/lib/util/become_daemon.c
 @@ -80,7 +80,7 @@
  {
  	pid_t newpid;
@@ -9,8 +9,8 @@
  		if (newpid) {
  #if HAVE_SYSTEMD
  			sd_notifyf(0, "READY=0\nSTATUS=Starting process...\nMAINPID=%lu", (unsigned long) newpid);
---- lib/util/fault.c
-+++ lib/util/fault.c
+--- a/lib/util/fault.c
++++ b/lib/util/fault.c
 @@ -131,7 +131,7 @@
  			snprintf(pidstr, sizeof(pidstr), "%d", (int) getpid());
  			all_string_sub(cmdstring, "%d", pidstr, sizeof(cmdstring));
@@ -20,8 +20,8 @@
  
  			if (result == -1)
  				DEBUG(0, ("smb_panic(): fork failed in panic action: %s\n",
---- source3/lib/server_prefork.c
-+++ source3/lib/server_prefork.c
+--- a/source3/lib/server_prefork.c
++++ b/source3/lib/server_prefork.c
 @@ -106,7 +106,7 @@
  		pfp->pool[i].allowed_clients = 1;
  		pfp->pool[i].started = now;
@@ -40,59 +40,8 @@
  		switch (pid) {
  		case -1:
  			DEBUG(1, ("Failed to prefork child n. %d !\n", j));
---- source3/lib/system.orig	2015-12-12 17:58:30.000000000 +0100
-+++ source3/lib/system.c	2015-12-12 17:58:45.000000000 +0100
-@@ -1198,7 +1198,7 @@
- 		goto err_exit;
- 	}
- 
--	entry->child_pid = fork();
-+	entry->child_pid = -1;
- 
- 	if (entry->child_pid == -1) {
- 		DEBUG(0, ("sys_popen: fork failed: %s\n", strerror(errno)));
-@@ -1229,7 +1229,7 @@
- 		for (p = popen_chain; p; p = p->next)
- 			close(p->fd);
- 
--		ret = execv(argl[0], argl);
-+		ret = -1;
- 		if (ret == -1) {
- 			DEBUG(0, ("sys_popen: ERROR executing command "
- 				  "'%s': %s\n", command, strerror(errno)));
---- source3/lib/util.c.orig	2015-12-12 18:01:38.000000000 +0100
-+++ source3/lib/util.c	2015-12-12 18:01:58.000000000 +0100
-@@ -795,7 +795,7 @@
- 	cmd = lp_panic_action(talloc_tos());
- 	if (cmd && *cmd) {
- 		DEBUG(0, ("smb_panic(): calling panic action [%s]\n", cmd));
--		result = system(cmd);
-+		result = -1;
- 
- 		if (result == -1)
- 			DEBUG(0, ("smb_panic(): fork failed in panic action: %s\n",
---- source3/lib/sock_exec.c.orig	2015-12-12 18:06:28.000000000 +0100
-+++ source3/lib/sock_exec.c	2015-12-12 18:06:41.000000000 +0100
-@@ -101,7 +101,7 @@
- 		DEBUG(0,("socketpair_tcp failed (%s)\n", strerror(errno)));
- 		return -1;
- 	}
--	if (fork() == 0) {
-+	if (-1 == 0) {
- 		close(fd[0]);
- 		close(0);
- 		close(1);
-@@ -111,7 +111,7 @@
- 		if (dup(fd[1]) == -1) {
- 			exit(1);
- 		}
--		exit(system(prog));
-+		exit(-1);
- 	}
- 	close(fd[1]);
- 	return fd[0];
---- source3/lib/smbrun.c.orig	2015-12-12 18:00:04.000000000 +0100
-+++ source3/lib/smbrun.c	2015-12-12 18:00:57.000000000 +0100
+--- a/source3/lib/smbrun.c
++++ b/source3/lib/smbrun.c
 @@ -97,7 +97,7 @@
  
  	saved_handler = CatchChildLeaveStatus();
@@ -131,3 +80,54 @@
  
  	/* not reached */
  	exit(82);
+--- a/source3/lib/sock_exec.c
++++ b/source3/lib/sock_exec.c
+@@ -101,7 +101,7 @@
+ 		DEBUG(0,("socketpair_tcp failed (%s)\n", strerror(errno)));
+ 		return -1;
+ 	}
+-	if (fork() == 0) {
++	if (-1 == 0) {
+ 		close(fd[0]);
+ 		close(0);
+ 		close(1);
+@@ -111,7 +111,7 @@
+ 		if (dup(fd[1]) == -1) {
+ 			exit(1);
+ 		}
+-		exit(system(prog));
++		exit(-1);
+ 	}
+ 	close(fd[1]);
+ 	return fd[0];
+--- a/source3/lib/system.c
++++ b/source3/lib/system.c
+@@ -1198,7 +1198,7 @@
+ 		goto err_exit;
+ 	}
+ 
+-	entry->child_pid = fork();
++	entry->child_pid = -1;
+ 
+ 	if (entry->child_pid == -1) {
+ 		DEBUG(0, ("sys_popen: fork failed: %s\n", strerror(errno)));
+@@ -1229,7 +1229,7 @@
+ 		for (p = popen_chain; p; p = p->next)
+ 			close(p->fd);
+ 
+-		ret = execv(argl[0], argl);
++		ret = -1;
+ 		if (ret == -1) {
+ 			DEBUG(0, ("sys_popen: ERROR executing command "
+ 				  "'%s': %s\n", command, strerror(errno)));
+--- a/source3/lib/util.c
++++ b/source3/lib/util.c
+@@ -795,7 +795,7 @@
+ 	cmd = lp_panic_action(talloc_tos());
+ 	if (cmd && *cmd) {
+ 		DEBUG(0, ("smb_panic(): calling panic action [%s]\n", cmd));
+-		result = system(cmd);
++		result = -1;
+ 
+ 		if (result == -1)
+ 			DEBUG(0, ("smb_panic(): fork failed in panic action: %s\n",
diff --git a/tools/depends/target/samba-gplv3/samba_android.patch b/tools/depends/target/samba-gplv3/samba_android.patch
index 60bdcfa7f994..11dd621c06df 100644
--- a/tools/depends/target/samba-gplv3/samba_android.patch
+++ b/tools/depends/target/samba-gplv3/samba_android.patch
@@ -1,5 +1,24 @@
---- lib/replace/system/network.h
-+++ lib/replace/system/network.h
+--- a/lib/addns/dnsquery.c
++++ b/lib/addns/dnsquery.c
+@@ -41,6 +41,16 @@
+ 
+ #define MAX_DNS_PACKET_SIZE 0xffff
+ 
++#if defined(ANDROID)
++#  define NS_HFIXEDSZ   12
++#  define C_IN          1
++#  define T_A           1
++#  define ns_t_srv      33
++#  define ns_t_aaaa     28
++#  define NS_PACKETSZ	512
++#  define T_NS          2
++#endif
++
+ #ifdef NS_HFIXEDSZ	/* Bind 8/9 interface */
+ #if !defined(C_IN)	/* AIX 5.3 already defines C_IN */
+ #  define C_IN		ns_c_in
+--- a/lib/replace/system/network.h
++++ b/lib/replace/system/network.h
 @@ -128,7 +128,7 @@
  struct hostent *rep_gethostbyname(const char *name);
  #endif
@@ -9,9 +28,8 @@
  #include <ifaddrs.h>
  #endif
  
-diff -ru lib/util/charset/iconv.c lib/util/charset/iconv.c
---- lib/util/charset/iconv.c	2013-01-29 09:49:31.000000000 +0100
-+++ lib/util/charset/iconv.c	2015-03-28 08:30:53.191217266 +0100
+--- a/lib/util/charset/iconv.c
++++ b/lib/util/charset/iconv.c
 @@ -24,6 +24,11 @@
  #include "system/filesys.h"
  #include "charset_proto.h"
@@ -27,7 +45,7 @@ diff -ru lib/util/charset/iconv.c lib/util/charset/iconv.c
 @@ -546,6 +551,19 @@
  	return 0;
  }
-
+ 
 +#if defined(ANDROID)
 +void swab(const void *from, void*to, ssize_t n)
 +{
@@ -44,9 +62,8 @@ diff -ru lib/util/charset/iconv.c lib/util/charset/iconv.c
  static size_t iconv_swab(void *cd, const char **inbuf, size_t *inbytesleft,
  			 char **outbuf, size_t *outbytesleft)
  {
-diff -ru lib/util/util_pw.c lib/util/util_pw.c
---- lib/util/util_pw.c	2013-01-29 09:49:31.000000000 +0100
-+++ lib/util/util_pw.c	2015-03-28 08:30:53.843217274 +0100
+--- a/lib/util/util_pw.c
++++ b/lib/util/util_pw.c
 @@ -40,7 +40,9 @@
  	ret->pw_passwd = talloc_strdup(ret, from->pw_passwd);
  	ret->pw_uid = from->pw_uid;
@@ -57,9 +74,8 @@ diff -ru lib/util/util_pw.c lib/util/util_pw.c
  	ret->pw_dir = talloc_strdup(ret, from->pw_dir);
  	ret->pw_shell = talloc_strdup(ret, from->pw_shell);
  
-diff -ru nsswitch/libwbclient/wbc_pwd.c nsswitch/libwbclient/wbc_pwd.c
---- nsswitch/libwbclient/wbc_pwd.c	2013-01-29 09:49:31.000000000 +0100
-+++ nsswitch/libwbclient/wbc_pwd.c	2015-03-28 08:30:53.847217275 +0100
+--- a/nsswitch/libwbclient/wbc_pwd.c
++++ b/nsswitch/libwbclient/wbc_pwd.c
 @@ -45,7 +45,9 @@
  	struct passwd *pw = (struct passwd *)ptr;
  	free(pw->pw_name);
@@ -83,9 +99,8 @@ diff -ru nsswitch/libwbclient/wbc_pwd.c nsswitch/libwbclient/wbc_pwd.c
  	pw->pw_shell = strdup(p->pw_shell);
  	if (pw->pw_shell == NULL) {
  		goto fail;
-diff -ru nsswitch/libwbclient/wbc_sid.c nsswitch/libwbclient/wbc_sid.c
---- nsswitch/libwbclient/wbc_sid.c	2013-01-29 09:49:31.000000000 +0100
-+++ nsswitch/libwbclient/wbc_sid.c	2015-03-28 08:30:53.847217275 +0100
+--- a/nsswitch/libwbclient/wbc_sid.c
++++ b/nsswitch/libwbclient/wbc_sid.c
 @@ -957,9 +957,11 @@
  
  		wbcFreeMemory(name);
@@ -98,8 +113,8 @@ diff -ru nsswitch/libwbclient/wbc_sid.c nsswitch/libwbclient/wbc_sid.c
  	}
  
  	wbc_status = WBC_ERR_SUCCESS;
---- nsswitch/winbind_struct_protocol.h
-+++ nsswitch/winbind_struct_protocol.h
+--- a/nsswitch/winbind_struct_protocol.h
++++ b/nsswitch/winbind_struct_protocol.h
 @@ -186,6 +186,10 @@
  	WINBINDD_NUM_CMDS
  };
@@ -111,10 +126,32 @@ diff -ru nsswitch/libwbclient/wbc_sid.c nsswitch/libwbclient/wbc_sid.c
  typedef struct winbindd_pw {
  	fstring pw_name;
  	fstring pw_passwd;
-diff -ru source3/configure source3/configure
---- source3/configure	2013-01-29 10:21:59.000000000 +0100
-+++ source3/configure	2015-03-28 08:43:34.903227582 +0100
-@@ -22424,7 +22424,7 @@
+--- a/source3/Makefile.in
++++ b/source3/Makefile.in
+@@ -2427,8 +2427,6 @@
+ 		@SONAMEFLAG@`basename $@`
+ 
+ $(LIBSMBCLIENT_SHARED_TARGET): $(LIBSMBCLIENT_SHARED_TARGET_SONAME)
+-	@rm -f $@
+-	@ln -s `basename $(LIBSMBCLIENT_SHARED_TARGET_SONAME)` $@
+ 
+ $(LIBSMBCLIENT_STATIC_TARGET): $(BINARY_PREREQS) $(LIBSMBCLIENT_OBJ1)
+ 	@echo Linking non-shared library $@
+@@ -2445,11 +2443,6 @@
+ installlibsmbclient:: installdirs libsmbclient
+ 	@$(SHELL) $(srcdir)/script/installdirs.sh $(INSTALLPERMS_BIN) $(DESTDIR) $(LIBDIR)
+ 	-$(INSTALLLIBCMD_SH) $(LIBSMBCLIENT_SHARED_TARGET_SONAME) $(DESTDIR)$(LIBDIR)
+-	@rm -f $(DESTDIR)$(LIBDIR)/`basename $(LIBSMBCLIENT_SHARED_TARGET)`
+-	-if test -r $(LIBSMBCLIENT_SHARED_TARGET_SONAME) ; then \
+-		ln -f -s `basename $(LIBSMBCLIENT_SHARED_TARGET_SONAME)` \
+-			$(DESTDIR)$(LIBDIR)/`basename $(LIBSMBCLIENT_SHARED_TARGET)` ; \
+-	fi
+ 	-$(INSTALLLIBCMD_A) $(LIBSMBCLIENT_STATIC_TARGET) $(DESTDIR)$(LIBDIR)
+ 	@$(SHELL) $(srcdir)/script/installdirs.sh $(INSTALLPERMS_BIN) $(DESTDIR) ${prefix}/include
+ 	-$(INSTALLCMD) -m $(INSTALLPERMS_DATA) $(LIBSMBCLIENT_HEADERS) $(DESTDIR)${prefix}/include
+--- a/source3/configure
++++ b/source3/configure
+@@ -22426,7 +22426,7 @@
  LIBSMBCLIENT_SOVER=0
  LIBSMBCLIENT_FULLVER=$LIBSMBCLIENT_SOVER
  
@@ -123,7 +160,7 @@ diff -ru source3/configure source3/configure
  LIBSMBCLIENT_SHARED_TARGET_FULLVER=$LIBSMBCLIENT_SHARED_TARGET.$LIBSMBCLIENT_FULLVER
  
  
-@@ -37580,19 +37580,19 @@
+@@ -37582,19 +37582,19 @@
  if test "x$ac_cv_lib_pthread_pthread_attr_init" = xyes; then :
  
  	     PTHREAD_CFLAGS="-D_REENTRANT -D_POSIX_PTHREAD_SEMANTICS"
@@ -147,7 +184,7 @@ diff -ru source3/configure source3/configure
  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
  /* end confdefs.h.  */
  
-@@ -37625,7 +37625,7 @@
+@@ -37627,7 +37627,7 @@
  if test "x$ac_cv_lib_pthreads_pthread_attr_init" = xyes; then :
  
  	     PTHREAD_CFLAGS="-D_THREAD_SAFE"
@@ -156,9 +193,8 @@ diff -ru source3/configure source3/configure
  fi
  
  fi
-diff -ru source3/lib/dumpcore.c source3/lib/dumpcore.c
---- source3/lib/dumpcore.c
-+++ source3/lib/dumpcore.c
+--- a/source3/lib/dumpcore.c
++++ b/source3/lib/dumpcore.c
 @@ -320,7 +320,7 @@
  	umask(~(0700));
  	dbgflush();
@@ -168,52 +204,8 @@ diff -ru source3/lib/dumpcore.c source3/lib/dumpcore.c
  	/* On Linux we lose the ability to dump core when we change our user
  	 * ID. We know how to dump core safely, so let's make sure we have our
  	 * dumpable flag set.
-diff -ru lib/addns/dnsquery.c lib/addns/dnsquery.c
---- lib/addns/dnsquery.c
-+++ lib/addns/dnsquery.c
-@@ -41,6 +41,16 @@
- 
- #define MAX_DNS_PACKET_SIZE 0xffff
- 
-+#if defined(ANDROID)
-+#  define NS_HFIXEDSZ   12
-+#  define C_IN          1
-+#  define T_A           1
-+#  define ns_t_srv      33
-+#  define ns_t_aaaa     28
-+#  define NS_PACKETSZ	512
-+#  define T_NS          2
-+#endif
-+
- #ifdef NS_HFIXEDSZ	/* Bind 8/9 interface */
- #if !defined(C_IN)	/* AIX 5.3 already defines C_IN */
- #  define C_IN		ns_c_in
-diff -ru source3/passdb/passdb.c source3/passdb/passdb.c
---- source3/Makefile.in
-+++ source3/Makefile.in
-@@ -2426,8 +2426,6 @@
- 		@SONAMEFLAG@`basename $@`
- 
- $(LIBSMBCLIENT_SHARED_TARGET): $(LIBSMBCLIENT_SHARED_TARGET_SONAME)
--	@rm -f $@
--	@ln -s `basename $(LIBSMBCLIENT_SHARED_TARGET_SONAME)` $@
- 
- $(LIBSMBCLIENT_STATIC_TARGET): $(BINARY_PREREQS) $(LIBSMBCLIENT_OBJ1)
- 	@echo Linking non-shared library $@
-@@ -2444,11 +2442,6 @@
- installlibsmbclient:: installdirs libsmbclient
- 	@$(SHELL) $(srcdir)/script/installdirs.sh $(INSTALLPERMS_BIN) $(DESTDIR) $(LIBDIR)
- 	-$(INSTALLLIBCMD_SH) $(LIBSMBCLIENT_SHARED_TARGET_SONAME) $(DESTDIR)$(LIBDIR)
--	@rm -f $(DESTDIR)$(LIBDIR)/`basename $(LIBSMBCLIENT_SHARED_TARGET)`
--	-if test -r $(LIBSMBCLIENT_SHARED_TARGET_SONAME) ; then \
--		ln -f -s `basename $(LIBSMBCLIENT_SHARED_TARGET_SONAME)` \
--			$(DESTDIR)$(LIBDIR)/`basename $(LIBSMBCLIENT_SHARED_TARGET)` ; \
--	fi
- 	-$(INSTALLLIBCMD_A) $(LIBSMBCLIENT_STATIC_TARGET) $(DESTDIR)$(LIBDIR)
- 	@$(SHELL) $(srcdir)/script/installdirs.sh $(INSTALLPERMS_BIN) $(DESTDIR) ${prefix}/include
- 	-$(INSTALLCMD) -m $(INSTALLPERMS_DATA) $(LIBSMBCLIENT_HEADERS) $(DESTDIR)${prefix}/include
---- source3/passdb/passdb.c	2013-01-29 09:49:31.000000000 +0100
-+++ source3/passdb/passdb.c	2015-03-28 08:30:54.543217284 +0100
+--- a/source3/passdb/passdb.c
++++ b/source3/passdb/passdb.c
 @@ -163,6 +163,7 @@
  
  	fullname = NULL;
@@ -237,9 +229,8 @@ diff -ru source3/passdb/passdb.c source3/passdb/passdb.c
  	}
  	TALLOC_FREE(fullname);
  
-diff -ru source3/passdb/pdb_interface.c source3/passdb/pdb_interface.c
---- source3/passdb/pdb_interface.c	2013-01-29 09:49:31.000000000 +0100
-+++ source3/passdb/pdb_interface.c	2015-03-28 08:30:54.547217284 +0100
+--- a/source3/passdb/pdb_interface.c
++++ b/source3/passdb/pdb_interface.c
 @@ -1570,6 +1570,7 @@
  	}
  

From 590b554666790d723e6c1664163315109be036d7 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Thu, 13 Jun 2019 14:22:31 +0200
Subject: [PATCH 21/23] [depends] refresh sqlite3 patches

---
 tools/depends/target/sqlite3/Makefile        |  2 +-
 tools/depends/target/sqlite3/sqlite3.c.patch | 11 +++++------
 2 files changed, 6 insertions(+), 7 deletions(-)

diff --git a/tools/depends/target/sqlite3/Makefile b/tools/depends/target/sqlite3/Makefile
index 39e533464529..640042f9d8b2 100644
--- a/tools/depends/target/sqlite3/Makefile
+++ b/tools/depends/target/sqlite3/Makefile
@@ -26,7 +26,7 @@ $(PLATFORM): $(TARBALLS_LOCATION)/$(ARCHIVE) $(DEPS)
 	cd $(PLATFORM); $(ARCHIVE_TOOL) $(ARCHIVE_TOOL_FLAGS) $(TARBALLS_LOCATION)/$(ARCHIVE)
 # seems MAP_POPULATE is broken on aarch64
 ifneq ($(OS),android)
-	cd $(PLATFORM); patch -p1 < ../sqlite3.c.patch
+	cd $(PLATFORM); patch -p1 -i ../sqlite3.c.patch
 endif
 	# do not build the program sqlite3
 	sed -ie "s|bin_PROGRAMS = sqlite3||" "$(PLATFORM)/Makefile.am";
diff --git a/tools/depends/target/sqlite3/sqlite3.c.patch b/tools/depends/target/sqlite3/sqlite3.c.patch
index 54ebf3129992..9def81e5223c 100644
--- a/tools/depends/target/sqlite3/sqlite3.c.patch
+++ b/tools/depends/target/sqlite3/sqlite3.c.patch
@@ -1,20 +1,19 @@
-diff --git a/sqlite3.c b/sqlite3.c
-index 1344938..c437252 100644
 --- a/sqlite3.c
 +++ b/sqlite3.c
-@@ -30750,7 +30750,11 @@ static void unixRemapfile(
+@@ -37359,8 +37359,12 @@
+ #if HAVE_MREMAP
      pNew = osMremap(pOrig, nReuse, nNew, MREMAP_MAYMOVE);
      zErr = "mremap";
- #else
++#else
 +#if defined(MAP_POPULATE)
 +    pNew = osMmap(pReq, nNew-nReuse, flags, MAP_SHARED | MAP_POPULATE, h, nReuse);
-+#else
+ #else
      pNew = osMmap(pReq, nNew-nReuse, flags, MAP_SHARED, h, nReuse);
 +#endif
      if( pNew!=MAP_FAILED ){
        if( pNew!=pReq ){
          osMunmap(pNew, nNew - nReuse);
-@@ -30769,7 +30773,11 @@ static void unixRemapfile(
+@@ -37379,7 +37383,11 @@
  
    /* If pNew is still NULL, try to create an entirely new mapping. */
    if( pNew==0 ){

From 3ed3717530c51c4410fc7e20c09b73c196d7b071 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Thu, 13 Jun 2019 14:22:31 +0200
Subject: [PATCH 22/23] [depends] refresh taglib patches

---
 tools/depends/target/taglib/ID3v2Lookup.patch  | 4 +---
 tools/depends/target/taglib/remove-boost.patch | 4 +---
 2 files changed, 2 insertions(+), 6 deletions(-)

diff --git a/tools/depends/target/taglib/ID3v2Lookup.patch b/tools/depends/target/taglib/ID3v2Lookup.patch
index b31cf6a089c7..297802d9ff57 100644
--- a/tools/depends/target/taglib/ID3v2Lookup.patch
+++ b/tools/depends/target/taglib/ID3v2Lookup.patch
@@ -8,11 +8,9 @@ This looks for an ID3v2 tag until reaching the first valid MPEG frame in O(n) ti
  taglib/mpeg/mpegfile.cpp | 45 +++++++++++++++++++++++++++++----------------
  1 file changed, 29 insertions(+), 16 deletions(-)
 
-diff --git a/taglib/mpeg/mpegfile.cpp b/taglib/mpeg/mpegfile.cpp
-index af7253f..c634eeb 100644
 --- a/taglib/mpeg/mpegfile.cpp
 +++ b/taglib/mpeg/mpegfile.cpp
-@@ -488,28 +488,41 @@ long MPEG::File::findID3v2()
+@@ -488,28 +488,41 @@
    const ByteVector headerID = ID3v2::Header::fileIdentifier();
  
    seek(0);
diff --git a/tools/depends/target/taglib/remove-boost.patch b/tools/depends/target/taglib/remove-boost.patch
index f2d8b81abdfa..aeb5452b9048 100644
--- a/tools/depends/target/taglib/remove-boost.patch
+++ b/tools/depends/target/taglib/remove-boost.patch
@@ -7,11 +7,9 @@ Subject: [PATCH] Remove the CMake check for Boost I missed out on.
  ConfigureChecks.cmake | 7 -------
  1 file changed, 7 deletions(-)
 
-diff --git a/ConfigureChecks.cmake b/ConfigureChecks.cmake
-index f69b438..e39d97b 100644
 --- a/ConfigureChecks.cmake
 +++ b/ConfigureChecks.cmake
-@@ -34,13 +34,6 @@ if(NOT ${SIZEOF_DOUBLE} EQUAL 8)
+@@ -34,13 +34,6 @@
    message(FATAL_ERROR "TagLib requires that double is 64-bit wide.")
  endif()
  

From d32a1cfd78e8651f804b413168ba1ec3230005d3 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Thu, 13 Jun 2019 14:22:31 +0200
Subject: [PATCH 23/23] [depends] refresh zlib patches

---
 tools/depends/native/zlib/Makefile                 | 2 +-
 tools/depends/native/zlib/visibility.patch         | 4 ++--
 tools/depends/target/zlib/Makefile                 | 4 ++--
 tools/depends/target/zlib/remove_fixe_ar_osx.patch | 4 ++--
 tools/depends/target/zlib/visibility.patch         | 4 ++--
 5 files changed, 9 insertions(+), 9 deletions(-)

diff --git a/tools/depends/native/zlib/Makefile b/tools/depends/native/zlib/Makefile
index 2bd153be7529..d4750b565419 100644
--- a/tools/depends/native/zlib/Makefile
+++ b/tools/depends/native/zlib/Makefile
@@ -21,7 +21,7 @@ $(TARBALLS_LOCATION)/$(ARCHIVE):
 $(PLATFORM): $(TARBALLS_LOCATION)/$(ARCHIVE) $(DEPS)
 	rm -rf $(PLATFORM); mkdir -p $(PLATFORM)
 	cd $(PLATFORM); $(ARCHIVE_TOOL) $(ARCHIVE_TOOL_FLAGS) $(TARBALLS_LOCATION)/$(ARCHIVE)
-	cd $(PLATFORM); patch -p0 < ../visibility.patch
+	cd $(PLATFORM); patch -p1 -i ../visibility.patch
 	cd $(PLATFORM); $(CONFIGURE)
 
 $(LIBDYLIB): $(PLATFORM)
diff --git a/tools/depends/native/zlib/visibility.patch b/tools/depends/native/zlib/visibility.patch
index af49fbffd7ce..0b4ac78a74b2 100644
--- a/tools/depends/native/zlib/visibility.patch
+++ b/tools/depends/native/zlib/visibility.patch
@@ -1,5 +1,5 @@
---- zconf.h.in	2013-01-23 21:22:22.512584179 -0500
-+++ zconf.h.in	2013-01-23 21:21:56.312584196 -0500
+--- a/zconf.h.in
++++ b/zconf.h.in
 @@ -348,7 +348,11 @@
  #endif
  
diff --git a/tools/depends/target/zlib/Makefile b/tools/depends/target/zlib/Makefile
index 7034bab7331e..89c33814d9f7 100644
--- a/tools/depends/target/zlib/Makefile
+++ b/tools/depends/target/zlib/Makefile
@@ -19,8 +19,8 @@ $(TARBALLS_LOCATION)/$(ARCHIVE):
 $(PLATFORM): $(TARBALLS_LOCATION)/$(ARCHIVE) $(DEPS)
 	rm -rf $(PLATFORM); mkdir -p $(PLATFORM)
 	cd $(PLATFORM); $(ARCHIVE_TOOL) $(ARCHIVE_TOOL_FLAGS) $(TARBALLS_LOCATION)/$(ARCHIVE)
-	cd $(PLATFORM); patch -p0 < ../visibility.patch
-	cd $(PLATFORM); patch -p0 < ../remove_fixe_ar_osx.patch
+	cd $(PLATFORM); patch -p1 -i ../visibility.patch
+	cd $(PLATFORM); patch -p1 -i ../remove_fixe_ar_osx.patch
 	cd $(PLATFORM); $(CONFIGURE)
 
 $(LIBDYLIB): $(PLATFORM)
diff --git a/tools/depends/target/zlib/remove_fixe_ar_osx.patch b/tools/depends/target/zlib/remove_fixe_ar_osx.patch
index 8eb2412fce76..1eaabff3ba7c 100644
--- a/tools/depends/target/zlib/remove_fixe_ar_osx.patch
+++ b/tools/depends/target/zlib/remove_fixe_ar_osx.patch
@@ -1,5 +1,5 @@
---- configure	2012-05-02 06:17:08.000000000 +0200
-+++ configure.new	2017-04-26 18:42:06.000000000 +0200
+--- a/configure
++++ b/configure
 @@ -241,12 +241,7 @@
               SHAREDLIBV=libz.$VER$shared_ext
               SHAREDLIBM=libz.$VER1$shared_ext
diff --git a/tools/depends/target/zlib/visibility.patch b/tools/depends/target/zlib/visibility.patch
index 8c5159e6df45..3257f7fedb64 100644
--- a/tools/depends/target/zlib/visibility.patch
+++ b/tools/depends/target/zlib/visibility.patch
@@ -1,5 +1,5 @@
---- zconf.h.in	2013-01-23 21:22:22.512584179 -0500
-+++ zconf.h.in	2013-01-23 21:21:56.312584196 -0500
+--- a/zconf.h.in
++++ b/zconf.h.in
 @@ -374,7 +374,11 @@
  #endif
  
