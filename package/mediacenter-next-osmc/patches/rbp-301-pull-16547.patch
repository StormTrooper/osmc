From f75cead0860bf95a1f8b6f11fe537df83e634757 Mon Sep 17 00:00:00 2001
From: Alwin Esch <alwin.esch@web.de>
Date: Sun, 1 Sep 2019 09:39:45 +0200
Subject: [PATCH] [cmake] check present "CPU" variable on PrepareEnv, if empty
 use CMAKE_SYSTEM_PROCESSOR

---
 cmake/scripts/common/PrepareEnv.cmake | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/cmake/scripts/common/PrepareEnv.cmake b/cmake/scripts/common/PrepareEnv.cmake
index ad691dc6847a..ed0c11e02a23 100644
--- a/cmake/scripts/common/PrepareEnv.cmake
+++ b/cmake/scripts/common/PrepareEnv.cmake
@@ -34,6 +34,14 @@ endif()
 
 set(PLATFORM_TAG ${CORE_SYSTEM_NAME})
 
+# The CPU variable is given either by ./tools/depends or by the
+# ./cmake/scripts/common/ArchSetup.cmake (which refers to the Kodi building
+# itself). However, this file is only used by addons, so CPU can not always
+# be defined, so in this case, if empty, the base CPU will be used.
+if(NOT CPU)
+  set(CPU ${CMAKE_SYSTEM_PROCESSOR})
+endif()
+
 if(CORE_SYSTEM_NAME STREQUAL android)
   if (CPU MATCHES "v7a")
     set(PLATFORM_TAG ${PLATFORM_TAG}-armv7)
