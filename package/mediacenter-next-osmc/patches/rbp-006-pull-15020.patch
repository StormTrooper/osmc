From 49665e6355740aa06aa49649009ffa8bd9b2477c Mon Sep 17 00:00:00 2001
From: peak3d <pfau@peak3d.de>
Date: Sat, 8 Dec 2018 17:49:53 +0100
Subject: [PATCH] [DemuxClient] Call SetStreamProps only if OpenStream succeeds

---
 xbmc/cores/VideoPlayer/DVDDemuxers/DVDDemuxClient.cpp   | 7 +++++--
 xbmc/cores/VideoPlayer/DVDInputStreams/DVDInputStream.h | 2 +-
 2 files changed, 6 insertions(+), 3 deletions(-)

diff --git a/xbmc/cores/VideoPlayer/DVDDemuxers/DVDDemuxClient.cpp b/xbmc/cores/VideoPlayer/DVDDemuxers/DVDDemuxClient.cpp
index ac6e04b548b6..f999fa679f31 100644
--- a/xbmc/cores/VideoPlayer/DVDDemuxers/DVDDemuxClient.cpp
+++ b/xbmc/cores/VideoPlayer/DVDDemuxers/DVDDemuxClient.cpp
@@ -639,13 +639,16 @@ void CDVDDemuxClient::OpenStream(int id)
 {
   // OpenStream may change some parameters
   // in this case we need to reset our stream properties
-  if (m_IDemux && m_IDemux->OpenStream(id))
+  if (m_IDemux)
   {
+    bool bOpenStream = m_IDemux->OpenStream(id);
+
     CDemuxStream *stream(m_IDemux->GetStream(id));
     if (stream && stream->type == STREAM_VIDEO)
       m_videoStreamPlaying = id;
 
-    SetStreamProps(stream, m_streams, true);
+    if (bOpenStream)
+      SetStreamProps(stream, m_streams, true);
   }
 }
 
diff --git a/xbmc/cores/VideoPlayer/DVDInputStreams/DVDInputStream.h b/xbmc/cores/VideoPlayer/DVDInputStreams/DVDInputStream.h
index 03da2a160c0e..8dc39442c959 100644
--- a/xbmc/cores/VideoPlayer/DVDInputStreams/DVDInputStream.h
+++ b/xbmc/cores/VideoPlayer/DVDInputStreams/DVDInputStream.h
@@ -125,7 +125,7 @@ class CDVDInputStream
     virtual CDemuxStream* GetStream(int iStreamId) const = 0;
     virtual std::vector<CDemuxStream*> GetStreams() const = 0;
     virtual void EnableStream(int iStreamId, bool enable) {};
-    virtual bool OpenStream(int iStreamId) { return true; };
+    virtual bool OpenStream(int iStreamId) { return false; };
     virtual int GetNrOfStreams() const = 0;
     virtual void SetSpeed(int iSpeed) = 0;
     virtual bool SeekTime(double time, bool backward = false, double* startpts = NULL) = 0;
