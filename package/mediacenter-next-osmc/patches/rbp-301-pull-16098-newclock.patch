From d66f52565840cb8011131c9c8eddf3b0ceccd8f8 Mon Sep 17 00:00:00 2001
From: Greg McCarthy <greg@gjmccarthy.co.uk>
Date: Thu, 31 Oct 2019 14:12:51 +0000
Subject: [PATCH] Update code for cpuinfo

---
 xbmc/cores/VideoPlayer/DVDCodecs/Video/DVDVideoCodecFFmpeg.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/xbmc/cores/VideoPlayer/DVDCodecs/Video/DVDVideoCodecFFmpeg.cpp b/xbmc/cores/VideoPlayer/DVDCodecs/Video/DVDVideoCodecFFmpeg.cpp
index 96ddb2c4d4..7e34c70e27 100644
--- a/xbmc/cores/VideoPlayer/DVDCodecs/Video/DVDVideoCodecFFmpeg.cpp
+++ b/xbmc/cores/VideoPlayer/DVDCodecs/Video/DVDVideoCodecFFmpeg.cpp
@@ -362,7 +362,7 @@ bool CDVDVideoCodecFFmpeg::Open(CDVDStreamInfo &hints, CDVDCodecOptions &options
     {
       m_decoderState = STATE_HW_SINGLE;
 #ifdef TARGET_RASPBERRY_PI
-      int num_threads = g_cpuInfo.getCPUCount() * 3 / 2;
+      int num_threads = CServiceBroker::GetCPUInfo()->GetCPUCount() * 3 / 2;
       num_threads = std::max(1, std::min(num_threads, 16));
       if (pCodec->id == AV_CODEC_ID_HEVC)
         num_threads = 8;
diff --git a/xbmc/cores/VideoPlayer/VideoRenderers/RenderManager.cpp b/xbmc/cores/VideoPlayer/VideoRenderers/RenderManager.cpp
index dc33061fb2..27f0635e38 100644
--- a/xbmc/cores/VideoPlayer/VideoRenderers/RenderManager.cpp
+++ b/xbmc/cores/VideoPlayer/VideoRenderers/RenderManager.cpp
@@ -739,7 +739,7 @@ void CRenderManager::Render(bool clear, DWORD flags, DWORD alpha, bool gui)
                                      missedvblanks,
                                      clockspeed * 100);
       }
-      cpu = g_cpuInfo.GetCoresUsageString();
+      cpu = CServiceBroker::GetCPUInfo()->GetCoresUsageString();

       std::vector<std::string> infos = { audio, video, player, vsync, cpu };
       m_debugRenderer.SetInfo(infos);
-- 
2.16.4

