From f38e9becfb0b218ccacc456617d37a6b59dd17d1 Mon Sep 17 00:00:00 2001
From: Greg McCarthy <greg@gjmccarthy.co.uk>
Date: Fri, 19 Jul 2019 15:54:04 +0100
Subject: [PATCH] Update all-009

---
 xbmc/addons/Addon.cpp | 15 ++++++++++++++-
 1 file changed, 14 insertions(+), 1 deletion(-)

diff --git a/xbmc/addons/Addon.cpp b/xbmc/addons/Addon.cpp
index 354b44643b..e92501487f 100644
--- a/xbmc/addons/Addon.cpp
+++ b/xbmc/addons/Addon.cpp
@@ -17,6 +17,7 @@
 #include "AddonManager.h"
 #include "addons/settings/AddonSettings.h"
 #include "filesystem/Directory.h"
+#include "filesystem/SpecialProtocol.h"
 #include "filesystem/File.h"
 #include "RepositoryUpdater.h"
 #include "settings/Settings.h"
@@ -365,7 +366,19 @@ std::string CAddon::LibPath() const
     if (libName.empty())
       return "";
   }
-  return URIUtils::AddFileToFolder(m_addonInfo->Path(), libName);
+
+  std::string strLibPath = URIUtils::AddFileToFolder(m_addonInfo->Path(), libName);
+
+  // Check if add-on library has been installed to the binaries path instead
+  std::string strSharePath = CSpecialProtocol::TranslatePath("special://xbmc/");
+  const bool bIsInSharePath = StringUtils::StartsWith(strLibPath, strSharePath);
+  if (bIsInSharePath && !CFile::Exists(strLibPath))
+  {
+    std::string strBinPath = CSpecialProtocol::TranslatePath("special://xbmcbin/");
+    strLibPath.replace(0, strSharePath.length(), strBinPath);
+  }
+
+  return strLibPath;
 }
 
 AddonVersion CAddon::GetDependencyVersion(const std::string &dependencyID) const
-- 
2.16.4

