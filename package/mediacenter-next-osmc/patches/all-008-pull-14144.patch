From 641b5964b3f133f55588e95a2e4788e3b6927c39 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Fri, 6 Jul 2018 09:00:00 +0200
Subject: [PATCH 1/6] [cleanup] silence ignored qualifiers warnings

---
 xbmc/platform/linux/peripherals/PeripheralBusUSBLibUdev.cpp | 2 +-
 xbmc/platform/linux/peripherals/PeripheralBusUSBLibUdev.h   | 2 +-
 xbmc/settings/DisplaySettings.h                             | 2 +-
 xbmc/view/ViewStateSettings.cpp                             | 4 ++--
 4 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/xbmc/platform/linux/peripherals/PeripheralBusUSBLibUdev.cpp b/xbmc/platform/linux/peripherals/PeripheralBusUSBLibUdev.cpp
index 62ab671ed988..a63fdfcd7255 100644
--- a/xbmc/platform/linux/peripherals/PeripheralBusUSBLibUdev.cpp
+++ b/xbmc/platform/linux/peripherals/PeripheralBusUSBLibUdev.cpp
@@ -176,7 +176,7 @@ bool CPeripheralBusUSB::PerformDeviceScan(PeripheralScanResults &results)
   return true;
 }
 
-const PeripheralType CPeripheralBusUSB::GetType(int iDeviceClass)
+PeripheralType CPeripheralBusUSB::GetType(int iDeviceClass)
 {
   switch (iDeviceClass)
   {
diff --git a/xbmc/platform/linux/peripherals/PeripheralBusUSBLibUdev.h b/xbmc/platform/linux/peripherals/PeripheralBusUSBLibUdev.h
index cbc781ce3713..6487eac837e1 100644
--- a/xbmc/platform/linux/peripherals/PeripheralBusUSBLibUdev.h
+++ b/xbmc/platform/linux/peripherals/PeripheralBusUSBLibUdev.h
@@ -44,7 +44,7 @@ namespace PERIPHERALS
     bool PerformDeviceScan(PeripheralScanResults &results) override;
 
   protected:
-    static const PeripheralType GetType(int iDeviceClass);
+    static PeripheralType GetType(int iDeviceClass);
 
     void Process(void) override;
     bool WaitForUpdate(void);
diff --git a/xbmc/settings/DisplaySettings.h b/xbmc/settings/DisplaySettings.h
index 46cb1db7477d..1eea3ead39d6 100644
--- a/xbmc/settings/DisplaySettings.h
+++ b/xbmc/settings/DisplaySettings.h
@@ -78,7 +78,7 @@ class CDisplaySettings : public ISettingCallback, public ISubSettings,
 
   const RESOLUTION_INFO& GetCurrentResolutionInfo() const { return GetResolutionInfo(m_currentResolution); }
   RESOLUTION_INFO& GetCurrentResolutionInfo() { return GetResolutionInfo(m_currentResolution); }
-  const RESOLUTION GetResFromString(const std::string &strResolution) { return GetResolutionFromString(strResolution); }
+  RESOLUTION GetResFromString(const std::string &strResolution) { return GetResolutionFromString(strResolution); }
 
   void ApplyCalibrations();
   void UpdateCalibrations();
diff --git a/xbmc/view/ViewStateSettings.cpp b/xbmc/view/ViewStateSettings.cpp
index a2596ffc6888..902900eb2209 100644
--- a/xbmc/view/ViewStateSettings.cpp
+++ b/xbmc/view/ViewStateSettings.cpp
@@ -123,7 +123,7 @@ bool CViewStateSettings::Load(const TiXmlNode *settings)
   if (pElement != NULL)
   {
     int settingLevel;
-    if (XMLUtils::GetInt(pElement, XML_SETTINGLEVEL, settingLevel, (const int)SettingLevel::Basic, (const int)SettingLevel::Expert))
+    if (XMLUtils::GetInt(pElement, XML_SETTINGLEVEL, settingLevel, static_cast<int>(SettingLevel::Basic), static_cast<int>(SettingLevel::Expert)))
       m_settingLevel = (SettingLevel)settingLevel;
     else
       m_settingLevel = SettingLevel::Standard;
@@ -132,7 +132,7 @@ bool CViewStateSettings::Load(const TiXmlNode *settings)
     if (pEventLogNode != NULL)
     {
       int eventLevel;
-      if (XMLUtils::GetInt(pEventLogNode, XML_EVENTLOG_LEVEL, eventLevel, (const int)EventLevel::Basic, (const int)EventLevel::Error))
+      if (XMLUtils::GetInt(pEventLogNode, XML_EVENTLOG_LEVEL, eventLevel, static_cast<int>(EventLevel::Basic), static_cast<int>(EventLevel::Error)))
         m_eventLevel = (EventLevel)eventLevel;
       else
         m_eventLevel = EventLevel::Basic;

From b5069cec5e44bf554be74700adfd596f9403f451 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Fri, 6 Jul 2018 09:00:00 +0200
Subject: [PATCH 2/6] [cleanup] silence sign compare warnings

---
 xbmc/cores/VideoPlayer/VideoRenderers/HwDecRender/VaapiEGL.cpp | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/xbmc/cores/VideoPlayer/VideoRenderers/HwDecRender/VaapiEGL.cpp b/xbmc/cores/VideoPlayer/VideoRenderers/HwDecRender/VaapiEGL.cpp
index 7be487a521a8..476073804580 100644
--- a/xbmc/cores/VideoPlayer/VideoRenderers/HwDecRender/VaapiEGL.cpp
+++ b/xbmc/cores/VideoPlayer/VideoRenderers/HwDecRender/VaapiEGL.cpp
@@ -512,7 +512,7 @@ bool CVaapi2Texture::Map(CVaapiRenderPicture* pic)
   if (surface.num_objects > m_drmFDs.size())
     throw std::logic_error("Too many fds returned by vaExportSurfaceHandle");
 
-  for (int object = 0; object < surface.num_objects; object++)
+  for (uint32_t object = 0; object < surface.num_objects; object++)
   {
     m_drmFDs[object].attach(surface.objects[object].fd);
   }
@@ -538,7 +538,7 @@ bool CVaapi2Texture::Map(CVaapiRenderPicture* pic)
     m_bits = 8;
   }
 
-  for (int layerNo = 0; layerNo < surface.num_layers; layerNo++)
+  for (uint32_t layerNo = 0; layerNo < surface.num_layers; layerNo++)
   {
     int plane = 0;
     auto const& layer = surface.layers[layerNo];
@@ -719,7 +719,7 @@ bool CVaapi2Texture::TestEsh(VADisplay vaDpy, EGLDisplay eglDisplay, std::uint32
       result = true;
     }
 
-    for (int object = 0; object < drmPrimeSurface.num_objects; object++)
+    for (uint32_t object = 0; object < drmPrimeSurface.num_objects; object++)
     {
       close(drmPrimeSurface.objects[object].fd);
     }

From 09158df58a97a9a997f3ac2f4f929d374c96ac2b Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Fri, 6 Jul 2018 09:00:00 +0200
Subject: [PATCH 3/6] [cleanup] replace deprecated av_codec_next with
 av_codec_iterate

---
 xbmc/addons/PVRClient.cpp | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/xbmc/addons/PVRClient.cpp b/xbmc/addons/PVRClient.cpp
index ddd439ed024d..9006354338e1 100644
--- a/xbmc/addons/PVRClient.cpp
+++ b/xbmc/addons/PVRClient.cpp
@@ -1731,9 +1731,10 @@ class CCodecIds
   CCodecIds(void)
   {
     // get ids and names
-    AVCodec* codec = NULL;
+    const AVCodec* codec = nullptr;
+    void* i = nullptr;
     xbmc_codec_t tmp;
-    while ((codec = av_codec_next(codec)))
+    while ((codec = av_codec_iterate(&i)))
     {
       if (av_codec_is_decoder(codec))
       {

From 7a4bed3b3069f4b9692f033b2cdafd6d74d076cc Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Fri, 6 Jul 2018 09:00:00 +0200
Subject: [PATCH 4/6] [cleanup] silence catch polymorphic type by value warning

---
 xbmc/FileItem.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/xbmc/FileItem.cpp b/xbmc/FileItem.cpp
index 92b3db11abe3..ae456a967d43 100644
--- a/xbmc/FileItem.cpp
+++ b/xbmc/FileItem.cpp
@@ -2882,7 +2882,7 @@ bool CFileItemList::Load(int windowID)
       return true;
     }
   }
-  catch(std::out_of_range ex)
+  catch(const std::out_of_range&)
   {
     CLog::Log(LOGERROR, "Corrupt archive: %s", CURL::GetRedacted(path).c_str());
   }

From 33c2becd48b5395478af73143061d60f94361a10 Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Fri, 6 Jul 2018 09:00:00 +0200
Subject: [PATCH 5/6] [fix] strncpy requires size + 1 buffer

---
 xbmc/cdrip/CDDARipJob.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/xbmc/cdrip/CDDARipJob.cpp b/xbmc/cdrip/CDDARipJob.cpp
index 09df8aa1f251..95f063406f13 100644
--- a/xbmc/cdrip/CDDARipJob.cpp
+++ b/xbmc/cdrip/CDDARipJob.cpp
@@ -227,7 +227,7 @@ CEncoder* CCDDARipJob::SetupEncoder(CFile& reader)
 
 std::string CCDDARipJob::SetupTempFile()
 {
-  char tmp[MAX_PATH];
+  char tmp[MAX_PATH + 1];
 #if defined(TARGET_WINDOWS)
   using namespace KODI::PLATFORM::WINDOWS;
   wchar_t tmpW[MAX_PATH];

From bc7bac10556cd0e23694b8afe5163565eb6d114c Mon Sep 17 00:00:00 2001
From: Rechi <Rechi@users.noreply.github.com>
Date: Fri, 6 Jul 2018 09:00:00 +0200
Subject: [PATCH 6/6] [fix] sprintf writing into too small buffer

---
 xbmc/utils/ScraperParser.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/xbmc/utils/ScraperParser.cpp b/xbmc/utils/ScraperParser.cpp
index ac0fb72e9887..3c54d51bf60b 100644
--- a/xbmc/utils/ScraperParser.cpp
+++ b/xbmc/utils/ScraperParser.cpp
@@ -285,7 +285,7 @@ void CScraperParser::ParseExpression(const std::string& input, std::string& dest
 
       if (iOptional > -1) // check that required param is there
       {
-        char temp[4];
+        char temp[12];
         sprintf(temp,"\\%i",iOptional);
         std::string szParam = reg.GetReplaceString(temp);
         CRegExp reg2;
